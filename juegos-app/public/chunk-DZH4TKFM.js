import{$ as ha,R as sa,S as ia,T as Fe,U as oa,V as aa,W as ua,X as Vt,Y as ca,Z as At,_ as la,a as Xo,aa as da,b as Yr,ba as fa,d as Zo,da as ma,e as ta,ea as Me,fa as ga,ga as pa,h as ke,ha as ya,ia as _a,j as ea,ja as wa,ka as qt,l as na,la as va,ma as Ia,pa as Ea,q as ra}from"./chunk-KEGUUP3A.js";import{f as w}from"./chunk-X6YOYRVK.js";var Bl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ct={},p,_s=_s||{},T=Bl||self;function zn(e){var t=typeof e;return t=t!="object"?t:e?Array.isArray(e)?"array":t:"null",t=="array"||t=="object"&&typeof e.length=="number"}function Ye(e){var t=typeof e;return t=="object"&&e!=null||t=="function"}function Ul(e){return Object.prototype.hasOwnProperty.call(e,Jr)&&e[Jr]||(e[Jr]=++Gl)}var Jr="closure_uid_"+(1e9*Math.random()>>>0),Gl=0;function $l(e,t,n){return e.call.apply(e.bind,arguments)}function zl(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var s=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(s,r),e.apply(t,s)}}return function(){return e.apply(t,arguments)}}function Y(e,t,n){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?Y=$l:Y=zl,Y.apply(null,arguments)}function Dn(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var r=n.slice();return r.push.apply(r,arguments),e.apply(this,r)}}function z(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(r,s,i){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return t.prototype[s].apply(r,o)}}function Dt(){this.s=this.s,this.o=this.o}var jl=0;Dt.prototype.s=!1;Dt.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),jl!=0)&&Ul(this)};Dt.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Fa=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if(typeof e=="string")return typeof t!="string"||t.length!=1?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function ws(e){let t=e.length;if(0<t){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function Ta(e,t){for(let n=1;n<arguments.length;n++){let r=arguments[n];if(zn(r)){let s=e.length||0,i=r.length||0;e.length=s+i;for(let o=0;o<i;o++)e[s+o]=r[o]}else e.push(r)}}function J(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}J.prototype.h=function(){this.defaultPrevented=!0};var Kl=function(){if(!T.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let n=()=>{};T.addEventListener("test",n,t),T.removeEventListener("test",n,t)}catch{}return e}();function Ge(e){return/^[\s\xa0]*$/.test(e)}function jn(){var e=T.navigator;return e&&(e=e.userAgent)?e:""}function ft(e){return jn().indexOf(e)!=-1}function vs(e){return vs[" "](e),e}vs[" "]=function(){};function Ql(e,t){var n=Fh;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}var Wl=ft("Opera"),le=ft("Trident")||ft("MSIE"),Ma=ft("Edge"),ns=Ma||le,Oa=ft("Gecko")&&!(jn().toLowerCase().indexOf("webkit")!=-1&&!ft("Edge"))&&!(ft("Trident")||ft("MSIE"))&&!ft("Edge"),Hl=jn().toLowerCase().indexOf("webkit")!=-1&&!ft("Edge");function La(){var e=T.document;return e?e.documentMode:void 0}var rs;t:{if(bn="",Nn=function(){var e=jn();if(Oa)return/rv:([^\);]+)(\)|;)/.exec(e);if(Ma)return/Edge\/([\d\.]+)/.exec(e);if(le)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e);if(Hl)return/WebKit\/(\S+)/.exec(e);if(Wl)return/(?:Version)[ \/]?(\S+)/.exec(e)}(),Nn&&(bn=Nn?Nn[1]:""),le&&(kn=La(),kn!=null&&kn>parseFloat(bn))){rs=String(kn);break t}rs=bn}var bn,Nn,kn,ss;T.document&&le?(Xr=La(),ss=Xr||parseInt(rs,10)||void 0):ss=void 0;var Xr,Yl=ss;function $e(e,t){if(J.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(Oa){t:{try{vs(t.nodeName);var s=!0;break t}catch{}s=!1}s||(t=null)}}else n=="mouseover"?t=e.fromElement:n=="mouseout"&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=e.clientX!==void 0?e.clientX:e.pageX,this.clientY=e.clientY!==void 0?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=typeof e.pointerType=="string"?e.pointerType:Jl[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&$e.$.h.call(this)}}z($e,J);var Jl={2:"touch",3:"pen",4:"mouse"};$e.prototype.h=function(){$e.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var Je="closure_listenable_"+(1e6*Math.random()|0),Xl=0;function Zl(e,t,n,r,s){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=s,this.key=++Xl,this.fa=this.ia=!1}function Kn(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function Is(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function th(e,t){for(let n in e)t.call(void 0,e[n],n,e)}function qa(e){let t={};for(let n in e)t[n]=e[n];return t}var Aa="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ba(e,t){let n,r;for(let s=1;s<arguments.length;s++){r=arguments[s];for(n in r)e[n]=r[n];for(let i=0;i<Aa.length;i++)n=Aa[i],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function Qn(e){this.src=e,this.g={},this.h=0}Qn.prototype.add=function(e,t,n,r,s){var i=e.toString();e=this.g[i],e||(e=this.g[i]=[],this.h++);var o=os(e,t,r,s);return-1<o?(t=e[o],n||(t.ia=!1)):(t=new Zl(t,this.src,i,!!r,s),t.ia=n,e.push(t)),t};function is(e,t){var n=t.type;if(n in e.g){var r=e.g[n],s=Fa(r,t),i;(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(Kn(t),e.g[n].length==0&&(delete e.g[n],e.h--))}}function os(e,t,n,r){for(var s=0;s<e.length;++s){var i=e[s];if(!i.fa&&i.listener==t&&i.capture==!!n&&i.la==r)return s}return-1}var Es="closure_lm_"+(1e6*Math.random()|0),Zr={};function Ua(e,t,n,r,s){if(r&&r.once)return $a(e,t,n,r,s);if(Array.isArray(t)){for(var i=0;i<t.length;i++)Ua(e,t[i],n,r,s);return null}return n=Ss(n),e&&e[Je]?e.O(t,n,Ye(r)?!!r.capture:!!r,s):Ga(e,t,n,!1,r,s)}function Ga(e,t,n,r,s,i){if(!t)throw Error("Invalid event type");var o=Ye(s)?!!s.capture:!!s,a=As(e);if(a||(e[Es]=a=new Qn(e)),n=a.add(t,n,r,o,i),n.proxy)return n;if(r=eh(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)Kl||(s=o),s===void 0&&(s=!1),e.addEventListener(t.toString(),r,s);else if(e.attachEvent)e.attachEvent(ja(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function eh(){function e(n){return t.call(e.src,e.listener,n)}let t=nh;return e}function $a(e,t,n,r,s){if(Array.isArray(t)){for(var i=0;i<t.length;i++)$a(e,t[i],n,r,s);return null}return n=Ss(n),e&&e[Je]?e.P(t,n,Ye(r)?!!r.capture:!!r,s):Ga(e,t,n,!0,r,s)}function za(e,t,n,r,s){if(Array.isArray(t))for(var i=0;i<t.length;i++)za(e,t[i],n,r,s);else r=Ye(r)?!!r.capture:!!r,n=Ss(n),e&&e[Je]?(e=e.i,t=String(t).toString(),t in e.g&&(i=e.g[t],n=os(i,n,r,s),-1<n&&(Kn(i[n]),Array.prototype.splice.call(i,n,1),i.length==0&&(delete e.g[t],e.h--)))):e&&(e=As(e))&&(t=e.g[t.toString()],e=-1,t&&(e=os(t,n,r,s)),(n=-1<e?t[e]:null)&&Ts(n))}function Ts(e){if(typeof e!="number"&&e&&!e.fa){var t=e.src;if(t&&t[Je])is(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(ja(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=As(t))?(is(n,e),n.h==0&&(n.src=null,t[Es]=null)):Kn(e)}}}function ja(e){return e in Zr?Zr[e]:Zr[e]="on"+e}function nh(e,t){if(e.fa)e=!0;else{t=new $e(t,this);var n=e.listener,r=e.la||e.src;e.ia&&Ts(e),e=n.call(r,t)}return e}function As(e){return e=e[Es],e instanceof Qn?e:null}var ts="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ss(e){return typeof e=="function"?e:(e[ts]||(e[ts]=function(t){return e.handleEvent(t)}),e[ts])}function $(){Dt.call(this),this.i=new Qn(this),this.S=this,this.J=null}z($,Dt);$.prototype[Je]=!0;$.prototype.removeEventListener=function(e,t,n,r){za(this,e,t,n,r)};function W(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,typeof t=="string")t=new J(t,e);else if(t instanceof J)t.target=t.target||e;else{var s=t;t=new J(r,e),Ba(t,s)}if(s=!0,n)for(var i=n.length-1;0<=i;i--){var o=t.g=n[i];s=Fn(o,r,!0,t)&&s}if(o=t.g=e,s=Fn(o,r,!0,t)&&s,s=Fn(o,r,!1,t)&&s,n)for(i=0;i<n.length;i++)o=t.g=n[i],s=Fn(o,r,!1,t)&&s}$.prototype.N=function(){if($.$.N.call(this),this.i){var e=this.i,t;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)Kn(n[r]);delete e.g[t],e.h--}}this.J=null};$.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)};$.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};function Fn(e,t,n,r){if(t=e.i.g[String(t)],!t)return!0;t=t.concat();for(var s=!0,i=0;i<t.length;++i){var o=t[i];if(o&&!o.fa&&o.capture==n){var a=o.listener,u=o.la||o.src;o.ia&&is(e.i,o),s=a.call(u,r)!==!1&&s}}return s&&!r.defaultPrevented}var Rs=T.JSON.stringify,as=class{constructor(t,n){this.i=t,this.j=n,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}};function rh(){var e=Ps;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var us=class{constructor(){this.h=this.g=null}add(t,n){let r=Ka.get();r.set(t,n),this.h?this.h.next=r:this.g=r,this.h=r}},Ka=new as(()=>new cs,e=>e.reset()),cs=class{constructor(){this.next=this.g=this.h=null}set(t,n){this.h=t,this.g=n,this.next=null}reset(){this.next=this.g=this.h=null}};function sh(e){var t=1;e=e.split(":");let n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function ih(e){T.setTimeout(()=>{throw e},0)}var ze,je=!1,Ps=new us,Qa=()=>{let e=T.Promise.resolve(void 0);ze=()=>{e.then(oh)}},oh=()=>{for(var e;e=rh();){try{e.h.call(e.g)}catch(n){ih(n)}var t=Ka;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}je=!1};function Wn(e,t){$.call(this),this.h=e||1,this.g=t||T,this.j=Y(this.qb,this),this.l=Date.now()}z(Wn,$);p=Wn.prototype;p.ga=!1;p.T=null;p.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),W(this,"tick"),this.ga&&(Cs(this),this.start()))}};p.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Cs(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}p.N=function(){Wn.$.N.call(this),Cs(this),delete this.g};function xs(e,t,n){if(typeof e=="function")n&&(e=Y(e,n));else if(e&&typeof e.handleEvent=="function")e=Y(e.handleEvent,e);else throw Error("Invalid listener argument");return 2147483647<Number(t)?-1:T.setTimeout(e,t||0)}function Wa(e){e.g=xs(()=>{e.g=null,e.i&&(e.i=!1,Wa(e))},e.j);let t=e.h;e.h=null,e.m.apply(null,t)}var ls=class extends Dt{constructor(t,n){super(),this.m=t,this.j=n,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Wa(this)}N(){super.N(),this.g&&(T.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function Ke(e){Dt.call(this),this.h=e,this.g={}}z(Ke,Dt);var Sa=[];function Ha(e,t,n,r){Array.isArray(n)||(n&&(Sa[0]=n.toString()),n=Sa);for(var s=0;s<n.length;s++){var i=Ua(t,n[s],r||e.handleEvent,!1,e.h||e);if(!i)break;e.g[i.key]=i}}function Ya(e){Is(e.g,function(t,n){this.g.hasOwnProperty(n)&&Ts(t)},e),e.g={}}Ke.prototype.N=function(){Ke.$.N.call(this),Ya(this)};Ke.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Hn(){this.g=!0}Hn.prototype.Ea=function(){this.g=!1};function ah(e,t,n,r,s,i){e.info(function(){if(e.g)if(i)for(var o="",a=i.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&h[1]=="type"?o+(l+"="+c+"&"):o+(l+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+t+`
`+n+`
`+o})}function uh(e,t,n,r,s,i,o){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+t+`
`+n+`
`+i+" "+o})}function ue(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+lh(e,n)+(r?" "+r:"")})}function ch(e,t){e.info(function(){return"TIMEOUT: "+t})}Hn.prototype.info=function(){};function lh(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if(i!="noop"&&i!="stop"&&i!="close")for(var o=1;o<s.length;o++)s[o]=""}}}}return Rs(n)}catch{return t}}var $t={},Ra=null;function Yn(){return Ra=Ra||new $}$t.Ta="serverreachability";function Ja(e){J.call(this,$t.Ta,e)}z(Ja,J);function Qe(e){let t=Yn();W(t,new Ja(t))}$t.STAT_EVENT="statevent";function Xa(e,t){J.call(this,$t.STAT_EVENT,e),this.stat=t}z(Xa,J);function tt(e){let t=Yn();W(t,new Xa(t,e))}$t.Ua="timingevent";function Za(e,t){J.call(this,$t.Ua,e),this.size=t}z(Za,J);function Xe(e,t){if(typeof e!="function")throw Error("Fn must not be null and must be a function");return T.setTimeout(function(){e()},t)}var Jn={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},tu={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Vs(){}Vs.prototype.h=null;function Pa(e){return e.h||(e.h=e.i())}function eu(){}var Ze={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Ds(){J.call(this,"d")}z(Ds,J);function bs(){J.call(this,"c")}z(bs,J);var hs;function Xn(){}z(Xn,Vs);Xn.prototype.g=function(){return new XMLHttpRequest};Xn.prototype.i=function(){return{}};hs=new Xn;function tn(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new Ke(this),this.P=hh,e=ns?125:void 0,this.V=new Wn(e),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new nu}function nu(){this.i=null,this.g="",this.h=!1}var hh=45e3,ru={},ds={};p=tn.prototype;p.setTimeout=function(e){this.P=e};function fs(e,t,n){e.L=1,e.A=tr(Rt(t)),e.u=n,e.S=!0,su(e,null)}function su(e,t){e.G=Date.now(),en(e),e.B=Rt(e.A);var n=e.B,r=e.W;Array.isArray(r)||(r=[String(r)]),du(n.i,"t",r),e.o=0,n=e.l.J,e.h=new nu,e.g=Nu(e.l,n?t:null,!e.u),0<e.O&&(e.M=new ls(Y(e.Pa,e,e.g),e.O)),Ha(e.U,e.g,"readystatechange",e.nb),t=e.I?qa(e.I):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.B,e.v,e.u,t)):(e.v="GET",e.g.ha(e.B,e.v,null,t)),Qe(),ah(e.j,e.v,e.B,e.m,e.W,e.u)}p.nb=function(e){e=e.target;let t=this.M;t&&mt(e)==3?t.l():this.Pa(e)};p.Pa=function(e){try{if(e==this.g)t:{let l=mt(this.g);var t=this.g.Ia();let h=this.g.da();if(!(3>l)&&(l!=3||ns||this.g&&(this.h.h||this.g.ja()||Da(this.g)))){this.J||l!=4||t==7||(t==8||0>=h?Qe(3):Qe(2)),Zn(this);var n=this.g.da();this.ca=n;e:if(iu(this)){var r=Da(this.g);e="";var s=r.length,i=mt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Bt(this),Ue(this);var o="";break e}this.h.i=new T.TextDecoder}for(t=0;t<s;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:i&&t==s-1});r.length=0,this.h.g+=e,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=n==200,uh(this.j,this.v,this.B,this.m,this.W,l,n),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Ge(a)){var c=a;break e}}c=null}if(n=c)ue(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ms(this,n);else{this.i=!1,this.s=3,tt(12),Bt(this),Ue(this);break t}}this.S?(ou(this,l,o),ns&&this.i&&l==3&&(Ha(this.U,this.V,"tick",this.mb),this.V.start())):(ue(this.j,this.m,o,null),ms(this,o)),l==4&&Bt(this),this.i&&!this.J&&(l==4?xu(this.l,this):(this.i=!1,en(this)))}else bh(this.g),n==400&&0<o.indexOf("Unknown SID")?(this.s=3,tt(12)):(this.s=0,tt(13)),Bt(this),Ue(this)}}}catch{}finally{}};function iu(e){return e.g?e.v=="GET"&&e.L!=2&&e.l.Ha:!1}function ou(e,t,n){let r=!0,s;for(;!e.J&&e.o<n.length;)if(s=dh(e,n),s==ds){t==4&&(e.s=4,tt(14),r=!1),ue(e.j,e.m,null,"[Incomplete Response]");break}else if(s==ru){e.s=4,tt(15),ue(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}else ue(e.j,e.m,s,null),ms(e,s);iu(e)&&e.o!=0&&(e.h.g=e.h.g.slice(e.o),e.o=0),t!=4||n.length!=0||e.h.h||(e.s=1,tt(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.ba&&(e.ba=!0,t=e.l,t.g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),Ls(t),t.M=!0,tt(11))):(ue(e.j,e.m,n,"[Invalid Chunked Response]"),Bt(e),Ue(e))}p.mb=function(){if(this.g){var e=mt(this.g),t=this.g.ja();this.o<t.length&&(Zn(this),ou(this,e,t),this.i&&e!=4&&en(this))}};function dh(e,t){var n=e.o,r=t.indexOf(`
`,n);return r==-1?ds:(n=Number(t.substring(n,r)),isNaN(n)?ru:(r+=1,r+n>t.length?ds:(t=t.slice(r,r+n),e.o=r+n,t)))}p.cancel=function(){this.J=!0,Bt(this)};function en(e){e.Y=Date.now()+e.P,au(e,e.P)}function au(e,t){if(e.C!=null)throw Error("WatchDog timer not null");e.C=Xe(Y(e.lb,e),t)}function Zn(e){e.C&&(T.clearTimeout(e.C),e.C=null)}p.lb=function(){this.C=null;let e=Date.now();0<=e-this.Y?(ch(this.j,this.B),this.L!=2&&(Qe(),tt(17)),Bt(this),this.s=2,Ue(this)):au(this,this.Y-e)};function Ue(e){e.l.H==0||e.J||xu(e.l,e)}function Bt(e){Zn(e);var t=e.M;t&&typeof t.sa=="function"&&t.sa(),e.M=null,Cs(e.V),Ya(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function ms(e,t){try{var n=e.l;if(n.H!=0&&(n.g==e||gs(n.i,e))){if(!e.K&&gs(n.i,e)&&n.H==3){try{var r=n.Ja.g.parse(t)}catch{r=null}if(Array.isArray(r)&&r.length==3){var s=r;if(s[0]==0){t:if(!n.u){if(n.g)if(n.g.G+3e3<e.G)Bn(n),rr(n);else break t;Os(n),tt(18)}}else n.Fa=s[1],0<n.Fa-n.V&&37500>s[2]&&n.G&&n.A==0&&!n.v&&(n.v=Xe(Y(n.ib,n),6e3));if(1>=gu(n.i)&&n.oa){try{n.oa()}catch{}n.oa=void 0}}else Ut(n,11)}else if((e.K||n.g==e)&&Bn(n),!Ge(t))for(s=n.Ja.g.parse(t),t=0;t<s.length;t++){let c=s[t];if(n.V=c[0],c=c[1],n.H==2)if(c[0]=="c"){n.K=c[1],n.pa=c[2];let l=c[3];l!=null&&(n.ra=l,n.l.info("VER="+n.ra));let h=c[4];h!=null&&(n.Ga=h,n.l.info("SVER="+n.Ga));let f=c[5];f!=null&&typeof f=="number"&&0<f&&(r=1.5*f,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;let g=e.g;if(g){let P=g.g?g.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(P){var i=r.i;i.g||P.indexOf("spdy")==-1&&P.indexOf("quic")==-1&&P.indexOf("h2")==-1||(i.j=i.l,i.g=new Set,i.h&&(Ns(i,i.h),i.h=null))}if(r.F){let S=g.g?g.g.getResponseHeader("X-HTTP-Session-Id"):null;S&&(r.Da=S,k(r.I,r.F,S))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms")),r=n;var o=e;if(r.wa=bu(r,r.J?r.pa:null,r.Y),o.K){pu(r.i,o);var a=o,u=r.L;u&&a.setTimeout(u),a.C&&(Zn(a),en(a)),r.g=o}else Pu(r);0<n.j.length&&sr(n)}else c[0]!="stop"&&c[0]!="close"||Ut(n,7);else n.H==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?Ut(n,7):Ms(n):c[0]!="noop"&&n.h&&n.h.Aa(c),n.A=0)}}Qe(4)}catch{}}function fh(e){if(e.Z&&typeof e.Z=="function")return e.Z();if(typeof Map<"u"&&e instanceof Map||typeof Set<"u"&&e instanceof Set)return Array.from(e.values());if(typeof e=="string")return e.split("");if(zn(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}t=[],n=0;for(r in e)t[n++]=e[r];return t}function mh(e){if(e.ta&&typeof e.ta=="function")return e.ta();if(!e.Z||typeof e.Z!="function"){if(typeof Map<"u"&&e instanceof Map)return Array.from(e.keys());if(!(typeof Set<"u"&&e instanceof Set)){if(zn(e)||typeof e=="string"){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(let r in e)t[n++]=r;return t}}}function uu(e,t){if(e.forEach&&typeof e.forEach=="function")e.forEach(t,void 0);else if(zn(e)||typeof e=="string")Array.prototype.forEach.call(e,t,void 0);else for(var n=mh(e),r=fh(e),s=r.length,i=0;i<s;i++)t.call(void 0,r[i],n&&n[i],e)}var cu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function gh(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),s=null;if(0<=r){var i=e[n].substring(0,r);s=e[n].substring(r+1)}else i=e[n];t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}function Gt(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof Gt){this.h=e.h,Ln(this,e.j),this.s=e.s,this.g=e.g,qn(this,e.m),this.l=e.l;var t=e.i,n=new We;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),Ca(this,n),this.o=e.o}else e&&(t=String(e).match(cu))?(this.h=!1,Ln(this,t[1]||"",!0),this.s=qe(t[2]||""),this.g=qe(t[3]||"",!0),qn(this,t[4]),this.l=qe(t[5]||"",!0),Ca(this,t[6]||"",!0),this.o=qe(t[7]||"")):(this.h=!1,this.i=new We(null,this.h))}Gt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Be(t,xa,!0),":");var n=this.g;return(n||t=="file")&&(e.push("//"),(t=this.s)&&e.push(Be(t,xa,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n=this.m,n!=null&&e.push(":",String(n))),(n=this.l)&&(this.g&&n.charAt(0)!="/"&&e.push("/"),e.push(Be(n,n.charAt(0)=="/"?_h:yh,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Be(n,vh)),e.join("")};function Rt(e){return new Gt(e)}function Ln(e,t,n){e.j=n?qe(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function qn(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Ca(e,t,n){t instanceof We?(e.i=t,Ih(e.i,e.h)):(n||(t=Be(t,wh)),e.i=new We(t,e.h))}function k(e,t,n){e.i.set(t,n)}function tr(e){return k(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function qe(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Be(e,t,n){return typeof e=="string"?(e=encodeURI(e).replace(t,ph),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function ph(e){return e=e.charCodeAt(0),"%"+(e>>4&15).toString(16)+(e&15).toString(16)}var xa=/[#\/\?@]/g,yh=/[#\?:]/g,_h=/[#\?]/g,wh=/[#\?@]/g,vh=/#/g;function We(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function bt(e){e.g||(e.g=new Map,e.h=0,e.i&&gh(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}p=We.prototype;p.add=function(e,t){bt(this),this.i=null,e=he(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this};function lu(e,t){bt(e),t=he(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function hu(e,t){return bt(e),t=he(e,t),e.g.has(t)}p.forEach=function(e,t){bt(this),this.g.forEach(function(n,r){n.forEach(function(s){e.call(t,s,r,this)},this)},this)};p.ta=function(){bt(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){let s=e[r];for(let i=0;i<s.length;i++)n.push(t[r])}return n};p.Z=function(e){bt(this);let t=[];if(typeof e=="string")hu(this,e)&&(t=t.concat(this.g.get(he(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t};p.set=function(e,t){return bt(this),this.i=null,e=he(this,e),hu(this,e)&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this};p.get=function(e,t){return e?(e=this.Z(e),0<e.length?String(e[0]):t):t};function du(e,t,n){lu(e,t),0<n.length&&(e.i=null,e.g.set(he(e,t),ws(n)),e.h+=n.length)}p.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];let i=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var s=i;o[r]!==""&&(s+="="+encodeURIComponent(String(o[r]))),e.push(s)}}return this.i=e.join("&")};function he(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Ih(e,t){t&&!e.j&&(bt(e),e.i=null,e.g.forEach(function(n,r){var s=r.toLowerCase();r!=s&&(lu(this,r),du(this,s,n))},e)),e.j=t}var Eh=class{constructor(e,t){this.g=e,this.map=t}};function fu(e){this.l=e||Th,T.PerformanceNavigationTiming?(e=T.performance.getEntriesByType("navigation"),e=0<e.length&&(e[0].nextHopProtocol=="hq"||e[0].nextHopProtocol=="h2")):e=!!(T.g&&T.g.Ka&&T.g.Ka()&&T.g.Ka().dc),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Th=10;function mu(e){return e.h?!0:e.g?e.g.size>=e.j:!1}function gu(e){return e.h?1:e.g?e.g.size:0}function gs(e,t){return e.h?e.h==t:e.g?e.g.has(t):!1}function Ns(e,t){e.g?e.g.add(t):e.h=t}function pu(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}fu.prototype.cancel=function(){if(this.i=yu(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let e of this.g.values())e.cancel();this.g.clear()}};function yu(e){if(e.h!=null)return e.i.concat(e.h.F);if(e.g!=null&&e.g.size!==0){let t=e.i;for(let n of e.g.values())t=t.concat(n.F);return t}return ws(e.i)}var Ah=class{stringify(e){return T.JSON.stringify(e,void 0)}parse(e){return T.JSON.parse(e,void 0)}};function Sh(){this.g=new Ah}function Rh(e,t,n){let r=n||"";try{uu(e,function(s,i){let o=s;Ye(s)&&(o=Rs(s)),t.push(r+i+"="+encodeURIComponent(o))})}catch(s){throw t.push(r+"type="+encodeURIComponent("_badmap")),s}}function Ph(e,t){let n=new Hn;if(T.Image){let r=new Image;r.onload=Dn(Mn,n,r,"TestLoadImage: loaded",!0,t),r.onerror=Dn(Mn,n,r,"TestLoadImage: error",!1,t),r.onabort=Dn(Mn,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=Dn(Mn,n,r,"TestLoadImage: timeout",!1,t),T.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}function Mn(e,t,n,r,s){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,s(r)}catch{}}function nn(e){this.l=e.ec||null,this.j=e.ob||!1}z(nn,Vs);nn.prototype.g=function(){return new er(this.l,this.j)};nn.prototype.i=function(e){return function(){return e}}({});function er(e,t){$.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=ks,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}z(er,$);var ks=0;p=er.prototype;p.open=function(e,t){if(this.readyState!=ks)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,He(this)};p.send=function(e){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||T).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))};p.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,rn(this)),this.readyState=ks};p.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,He(this)),this.g&&(this.readyState=3,He(this),this.g)))if(this.responseType==="arraybuffer")e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof T.ReadableStream<"u"&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;_u(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))};function _u(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}p.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?rn(this):He(this),this.readyState==3&&_u(this)}};p.Za=function(e){this.g&&(this.response=this.responseText=e,rn(this))};p.Ya=function(e){this.g&&(this.response=e,rn(this))};p.ka=function(){this.g&&rn(this)};function rn(e){e.readyState=4,e.l=null,e.j=null,e.A=null,He(e)}p.setRequestHeader=function(e,t){this.v.append(e,t)};p.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""};p.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join(`\r
`)};function He(e){e.onreadystatechange&&e.onreadystatechange.call(e)}Object.defineProperty(er.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(e){this.m=e?"include":"same-origin"}});var Ch=T.JSON.parse;function M(e){$.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=wu,this.L=this.M=!1}z(M,$);var wu="",xh=/^https?$/i,Vh=["POST","PUT"];p=M.prototype;p.Oa=function(e){this.M=e};p.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():hs.g(),this.C=this.u?Pa(this.u):Pa(hs),this.g.onreadystatechange=Y(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(i){Va(this,i);return}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(let i of r.keys())n.set(i,r.get(i));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(n.keys()).find(i=>i.toLowerCase()=="content-type"),s=T.FormData&&e instanceof T.FormData,!(0<=Fa(Vh,t))||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[i,o]of n)this.g.setRequestHeader(i,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Eu(this),0<this.B&&((this.L=Dh(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Y(this.ua,this)):this.A=xs(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(i){Va(this,i)}};function Dh(e){return le&&typeof e.timeout=="number"&&e.ontimeout!==void 0}p.ua=function(){typeof _s<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,W(this,"timeout"),this.abort(8))};function Va(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,vu(e),nr(e)}function vu(e){e.F||(e.F=!0,W(e,"complete"),W(e,"error"))}p.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,W(this,"complete"),W(this,"abort"),nr(this))};p.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),nr(this,!0)),M.$.N.call(this)};p.La=function(){this.s||(this.G||this.v||this.l?Iu(this):this.kb())};p.kb=function(){Iu(this)};function Iu(e){if(e.h&&typeof _s<"u"&&(!e.C[1]||mt(e)!=4||e.da()!=2)){if(e.v&&mt(e)==4)xs(e.La,0,e);else if(W(e,"readystatechange"),mt(e)==4){e.h=!1;try{let o=e.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break t;default:t=!1}var n;if(!(n=t)){var r;if(r=o===0){var s=String(e.I).match(cu)[1]||null;!s&&T.self&&T.self.location&&(s=T.self.location.protocol.slice(0,-1)),r=!xh.test(s?s.toLowerCase():"")}n=r}if(n)W(e,"complete"),W(e,"success");else{e.m=6;try{var i=2<mt(e)?e.g.statusText:""}catch{i=""}e.j=i+" ["+e.da()+"]",vu(e)}}finally{nr(e)}}}}function nr(e,t){if(e.g){Eu(e);let n=e.g,r=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||W(e,"ready");try{n.onreadystatechange=r}catch{}}}function Eu(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(T.clearTimeout(e.A),e.A=null)}p.isActive=function(){return!!this.g};function mt(e){return e.g?e.g.readyState:0}p.da=function(){try{return 2<mt(this)?this.g.status:-1}catch{return-1}};p.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};p.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&t.indexOf(e)==0&&(t=t.substring(e.length)),Ch(t)}};function Da(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case wu:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch{return null}}function bh(e){let t={};e=(e.g&&2<=mt(e)&&e.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<e.length;r++){if(Ge(e[r]))continue;var n=sh(e[r]);let s=n[0];if(n=n[1],typeof n!="string")continue;n=n.trim();let i=t[s]||[];t[s]=i,i.push(n)}th(t,function(r){return r.join(", ")})}p.Ia=function(){return this.m};p.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function Tu(e){let t="";return Is(e,function(n,r){t+=r,t+=":",t+=n,t+=`\r
`}),t}function Fs(e,t,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=Tu(n),typeof e=="string"?n!=null&&encodeURIComponent(String(n)):k(e,t,n))}function Oe(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Au(e){this.Ga=0,this.j=[],this.l=new Hn,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Oe("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Oe("baseRetryDelayMs",5e3,e),this.hb=Oe("retryDelaySeedMs",1e4,e),this.eb=Oe("forwardChannelMaxRetries",2,e),this.xa=Oe("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new fu(e&&e.concurrentRequestLimit),this.Ja=new Sh,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}p=Au.prototype;p.ra=8;p.H=1;function Ms(e){if(Su(e),e.H==3){var t=e.W++,n=Rt(e.I);if(k(n,"SID",e.K),k(n,"RID",t),k(n,"TYPE","terminate"),sn(e,n),t=new tn(e,e.l,t),t.L=2,t.A=tr(Rt(n)),n=!1,T.navigator&&T.navigator.sendBeacon)try{n=T.navigator.sendBeacon(t.A.toString(),"")}catch{}!n&&T.Image&&(new Image().src=t.A,n=!0),n||(t.g=Nu(t.l,null),t.g.ha(t.A)),t.G=Date.now(),en(t)}Du(e)}function rr(e){e.g&&(Ls(e),e.g.cancel(),e.g=null)}function Su(e){rr(e),e.u&&(T.clearTimeout(e.u),e.u=null),Bn(e),e.i.cancel(),e.m&&(typeof e.m=="number"&&T.clearTimeout(e.m),e.m=null)}function sr(e){if(!mu(e.i)&&!e.m){e.m=!0;var t=e.Na;ze||Qa(),je||(ze(),je=!0),Ps.add(t,e),e.C=0}}function Nh(e,t){return gu(e.i)>=e.i.j-(e.m?1:0)?!1:e.m?(e.j=t.F.concat(e.j),!0):e.H==1||e.H==2||e.C>=(e.cb?0:e.eb)?!1:(e.m=Xe(Y(e.Na,e,t),Vu(e,e.C)),e.C++,!0)}p.Na=function(e){if(this.m)if(this.m=null,this.H==1){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;let s=new tn(this,this.l,e),i=this.s;if(this.U&&(i?(i=qa(i),Ba(i,this.U)):i=this.U),this.o!==null||this.O||(s.I=i,i=null),this.P)t:{for(var t=0,n=0;n<this.j.length;n++){e:{var r=this.j[n];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break e}r=void 0}if(r===void 0)break;if(t+=r,4096<t){t=n;break t}if(t===4096||n===this.j.length-1){t=n+1;break t}}t=1e3}else t=1e3;t=Ru(this,s,t),n=Rt(this.I),k(n,"RID",e),k(n,"CVER",22),this.F&&k(n,"X-HTTP-Session-Id",this.F),sn(this,n),i&&(this.O?t="headers="+encodeURIComponent(String(Tu(i)))+"&"+t:this.o&&Fs(n,this.o,i)),Ns(this.i,s),this.bb&&k(n,"TYPE","init"),this.P?(k(n,"$req",t),k(n,"SID","null"),s.aa=!0,fs(s,n,null)):fs(s,n,t),this.H=2}}else this.H==3&&(e?ba(this,e):this.j.length==0||mu(this.i)||ba(this))};function ba(e,t){var n;t?n=t.m:n=e.W++;let r=Rt(e.I);k(r,"SID",e.K),k(r,"RID",n),k(r,"AID",e.V),sn(e,r),e.o&&e.s&&Fs(r,e.o,e.s),n=new tn(e,e.l,n,e.C+1),e.o===null&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=Ru(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),Ns(e.i,n),fs(n,r,t)}function sn(e,t){e.na&&Is(e.na,function(n,r){k(t,r,n)}),e.h&&uu({},function(n,r){k(t,r,n)})}function Ru(e,t,n){n=Math.min(e.j.length,n);var r=e.h?Y(e.h.Va,e.h,e):null;t:{var s=e.j;let i=-1;for(;;){let o=["count="+n];i==-1?0<n?(i=s[0].g,o.push("ofs="+i)):i=0:o.push("ofs="+i);let a=!0;for(let u=0;u<n;u++){let c=s[u].g,l=s[u].map;if(c-=i,0>c)i=Math.max(0,s[u].g-100),a=!1;else try{Rh(l,o,"req"+c+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break t}}}return e=e.j.splice(0,n),t.F=e,r}function Pu(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;ze||Qa(),je||(ze(),je=!0),Ps.add(t,e),e.A=0}}function Os(e){return e.g||e.u||3<=e.A?!1:(e.ba++,e.u=Xe(Y(e.Ma,e),Vu(e,e.A)),e.A++,!0)}p.Ma=function(){if(this.u=null,Cu(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=Xe(Y(this.jb,this),e)}};p.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,tt(10),rr(this),Cu(this))};function Ls(e){e.B!=null&&(T.clearTimeout(e.B),e.B=null)}function Cu(e){e.g=new tn(e,e.l,"rpc",e.ba),e.o===null&&(e.g.I=e.s),e.g.O=0;var t=Rt(e.wa);k(t,"RID","rpc"),k(t,"SID",e.K),k(t,"AID",e.V),k(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&k(t,"TO",e.qa),k(t,"TYPE","xmlhttp"),sn(e,t),e.o&&e.s&&Fs(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.A=tr(Rt(t)),n.u=null,n.S=!0,su(n,e)}p.ib=function(){this.v!=null&&(this.v=null,rr(this),Os(this),tt(19))};function Bn(e){e.v!=null&&(T.clearTimeout(e.v),e.v=null)}function xu(e,t){var n=null;if(e.g==t){Bn(e),Ls(e),e.g=null;var r=2}else if(gs(e.i,t))n=t.F,pu(e.i,t),r=1;else return;if(e.H!=0){if(t.i)if(r==1){n=t.u?t.u.length:0,t=Date.now()-t.G;var s=e.C;r=Yn(),W(r,new Za(r,n)),sr(e)}else Pu(e);else if(s=t.s,s==3||s==0&&0<t.ca||!(r==1&&Nh(e,t)||r==2&&Os(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),s){case 1:Ut(e,5);break;case 4:Ut(e,10);break;case 3:Ut(e,6);break;default:Ut(e,2)}}}function Vu(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function Ut(e,t){if(e.l.info("Error code "+t),t==2){var n=null;e.h&&(n=null);var r=Y(e.pb,e);n||(n=new Gt("//www.google.com/images/cleardot.gif"),T.location&&T.location.protocol=="http"||Ln(n,"https"),tr(n)),Ph(n.toString(),r)}else tt(2);e.H=0,e.h&&e.h.za(t),Du(e),Su(e)}p.pb=function(e){e?(this.l.info("Successfully pinged google.com"),tt(2)):(this.l.info("Failed to ping google.com"),tt(1))};function Du(e){if(e.H=0,e.ma=[],e.h){let t=yu(e.i);(t.length!=0||e.j.length!=0)&&(Ta(e.ma,t),Ta(e.ma,e.j),e.i.i.length=0,ws(e.j),e.j.length=0),e.h.ya()}}function bu(e,t,n){var r=n instanceof Gt?Rt(n):new Gt(n);if(r.g!="")t&&(r.g=t+"."+r.g),qn(r,r.m);else{var s=T.location;r=s.protocol,t=t?t+"."+s.hostname:s.hostname,s=+s.port;var i=new Gt(null);r&&Ln(i,r),t&&(i.g=t),s&&qn(i,s),n&&(i.l=n),r=i}return n=e.F,t=e.Da,n&&t&&k(r,n,t),k(r,"VER",e.ra),sn(e,r),r}function Nu(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return t=e.Ha&&!e.va?new M(new nn({ob:n})):new M(e.va),t.Oa(e.J),t}p.isActive=function(){return!!this.h&&this.h.isActive(this)};function ku(){}p=ku.prototype;p.Ba=function(){};p.Aa=function(){};p.za=function(){};p.ya=function(){};p.isActive=function(){return!0};p.Va=function(){};function Un(){if(le&&!(10<=Number(Yl)))throw Error("Environmental error: no available transport.")}Un.prototype.g=function(e,t){return new st(e,t)};function st(e,t){$.call(this),this.g=new Au(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!Ge(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Ge(t)&&(this.g.F=t,e=this.h,e!==null&&t in e&&(e=this.h,t in e&&delete e[t])),this.j=new de(this)}z(st,$);st.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;tt(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=bu(e,null,e.Y),sr(e)};st.prototype.close=function(){Ms(this.g)};st.prototype.u=function(e){var t=this.g;if(typeof e=="string"){var n={};n.__data__=e,e=n}else this.v&&(n={},n.__data__=Rs(e),e=n);t.j.push(new Eh(t.fb++,e)),t.H==3&&sr(t)};st.prototype.N=function(){this.g.h=null,delete this.j,Ms(this.g),delete this.g,st.$.N.call(this)};function Fu(e){Ds.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){t:{for(let n in t){e=n;break t}e=void 0}(this.i=e)&&(e=this.i,t=t!==null&&e in t?t[e]:void 0),this.data=t}else this.data=e}z(Fu,Ds);function Mu(){bs.call(this),this.status=1}z(Mu,bs);function de(e){this.g=e}z(de,ku);de.prototype.Ba=function(){W(this.g,"a")};de.prototype.Aa=function(e){W(this.g,new Fu(e))};de.prototype.za=function(e){W(this.g,new Mu)};de.prototype.ya=function(){W(this.g,"b")};function kh(){this.blockSize=-1}function ut(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}z(ut,kh);ut.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function es(e,t,n){n||(n=0);var r=Array(16);if(typeof t=="string")for(var s=0;16>s;++s)r[s]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(s=0;16>s;++s)r[s]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],s=e.g[2];var i=e.g[3],o=t+(i^n&(s^i))+r[0]+3614090360&4294967295;t=n+(o<<7&4294967295|o>>>25),o=i+(s^t&(n^s))+r[1]+3905402710&4294967295,i=t+(o<<12&4294967295|o>>>20),o=s+(n^i&(t^n))+r[2]+606105819&4294967295,s=i+(o<<17&4294967295|o>>>15),o=n+(t^s&(i^t))+r[3]+3250441966&4294967295,n=s+(o<<22&4294967295|o>>>10),o=t+(i^n&(s^i))+r[4]+4118548399&4294967295,t=n+(o<<7&4294967295|o>>>25),o=i+(s^t&(n^s))+r[5]+1200080426&4294967295,i=t+(o<<12&4294967295|o>>>20),o=s+(n^i&(t^n))+r[6]+2821735955&4294967295,s=i+(o<<17&4294967295|o>>>15),o=n+(t^s&(i^t))+r[7]+4249261313&4294967295,n=s+(o<<22&4294967295|o>>>10),o=t+(i^n&(s^i))+r[8]+1770035416&4294967295,t=n+(o<<7&4294967295|o>>>25),o=i+(s^t&(n^s))+r[9]+2336552879&4294967295,i=t+(o<<12&4294967295|o>>>20),o=s+(n^i&(t^n))+r[10]+4294925233&4294967295,s=i+(o<<17&4294967295|o>>>15),o=n+(t^s&(i^t))+r[11]+2304563134&4294967295,n=s+(o<<22&4294967295|o>>>10),o=t+(i^n&(s^i))+r[12]+1804603682&4294967295,t=n+(o<<7&4294967295|o>>>25),o=i+(s^t&(n^s))+r[13]+4254626195&4294967295,i=t+(o<<12&4294967295|o>>>20),o=s+(n^i&(t^n))+r[14]+2792965006&4294967295,s=i+(o<<17&4294967295|o>>>15),o=n+(t^s&(i^t))+r[15]+1236535329&4294967295,n=s+(o<<22&4294967295|o>>>10),o=t+(s^i&(n^s))+r[1]+4129170786&4294967295,t=n+(o<<5&4294967295|o>>>27),o=i+(n^s&(t^n))+r[6]+3225465664&4294967295,i=t+(o<<9&4294967295|o>>>23),o=s+(t^n&(i^t))+r[11]+643717713&4294967295,s=i+(o<<14&4294967295|o>>>18),o=n+(i^t&(s^i))+r[0]+3921069994&4294967295,n=s+(o<<20&4294967295|o>>>12),o=t+(s^i&(n^s))+r[5]+3593408605&4294967295,t=n+(o<<5&4294967295|o>>>27),o=i+(n^s&(t^n))+r[10]+38016083&4294967295,i=t+(o<<9&4294967295|o>>>23),o=s+(t^n&(i^t))+r[15]+3634488961&4294967295,s=i+(o<<14&4294967295|o>>>18),o=n+(i^t&(s^i))+r[4]+3889429448&4294967295,n=s+(o<<20&4294967295|o>>>12),o=t+(s^i&(n^s))+r[9]+568446438&4294967295,t=n+(o<<5&4294967295|o>>>27),o=i+(n^s&(t^n))+r[14]+3275163606&4294967295,i=t+(o<<9&4294967295|o>>>23),o=s+(t^n&(i^t))+r[3]+4107603335&4294967295,s=i+(o<<14&4294967295|o>>>18),o=n+(i^t&(s^i))+r[8]+1163531501&4294967295,n=s+(o<<20&4294967295|o>>>12),o=t+(s^i&(n^s))+r[13]+2850285829&4294967295,t=n+(o<<5&4294967295|o>>>27),o=i+(n^s&(t^n))+r[2]+4243563512&4294967295,i=t+(o<<9&4294967295|o>>>23),o=s+(t^n&(i^t))+r[7]+1735328473&4294967295,s=i+(o<<14&4294967295|o>>>18),o=n+(i^t&(s^i))+r[12]+2368359562&4294967295,n=s+(o<<20&4294967295|o>>>12),o=t+(n^s^i)+r[5]+4294588738&4294967295,t=n+(o<<4&4294967295|o>>>28),o=i+(t^n^s)+r[8]+2272392833&4294967295,i=t+(o<<11&4294967295|o>>>21),o=s+(i^t^n)+r[11]+1839030562&4294967295,s=i+(o<<16&4294967295|o>>>16),o=n+(s^i^t)+r[14]+4259657740&4294967295,n=s+(o<<23&4294967295|o>>>9),o=t+(n^s^i)+r[1]+2763975236&4294967295,t=n+(o<<4&4294967295|o>>>28),o=i+(t^n^s)+r[4]+1272893353&4294967295,i=t+(o<<11&4294967295|o>>>21),o=s+(i^t^n)+r[7]+4139469664&4294967295,s=i+(o<<16&4294967295|o>>>16),o=n+(s^i^t)+r[10]+3200236656&4294967295,n=s+(o<<23&4294967295|o>>>9),o=t+(n^s^i)+r[13]+681279174&4294967295,t=n+(o<<4&4294967295|o>>>28),o=i+(t^n^s)+r[0]+3936430074&4294967295,i=t+(o<<11&4294967295|o>>>21),o=s+(i^t^n)+r[3]+3572445317&4294967295,s=i+(o<<16&4294967295|o>>>16),o=n+(s^i^t)+r[6]+76029189&4294967295,n=s+(o<<23&4294967295|o>>>9),o=t+(n^s^i)+r[9]+3654602809&4294967295,t=n+(o<<4&4294967295|o>>>28),o=i+(t^n^s)+r[12]+3873151461&4294967295,i=t+(o<<11&4294967295|o>>>21),o=s+(i^t^n)+r[15]+530742520&4294967295,s=i+(o<<16&4294967295|o>>>16),o=n+(s^i^t)+r[2]+3299628645&4294967295,n=s+(o<<23&4294967295|o>>>9),o=t+(s^(n|~i))+r[0]+4096336452&4294967295,t=n+(o<<6&4294967295|o>>>26),o=i+(n^(t|~s))+r[7]+1126891415&4294967295,i=t+(o<<10&4294967295|o>>>22),o=s+(t^(i|~n))+r[14]+2878612391&4294967295,s=i+(o<<15&4294967295|o>>>17),o=n+(i^(s|~t))+r[5]+4237533241&4294967295,n=s+(o<<21&4294967295|o>>>11),o=t+(s^(n|~i))+r[12]+1700485571&4294967295,t=n+(o<<6&4294967295|o>>>26),o=i+(n^(t|~s))+r[3]+2399980690&4294967295,i=t+(o<<10&4294967295|o>>>22),o=s+(t^(i|~n))+r[10]+4293915773&4294967295,s=i+(o<<15&4294967295|o>>>17),o=n+(i^(s|~t))+r[1]+2240044497&4294967295,n=s+(o<<21&4294967295|o>>>11),o=t+(s^(n|~i))+r[8]+1873313359&4294967295,t=n+(o<<6&4294967295|o>>>26),o=i+(n^(t|~s))+r[15]+4264355552&4294967295,i=t+(o<<10&4294967295|o>>>22),o=s+(t^(i|~n))+r[6]+2734768916&4294967295,s=i+(o<<15&4294967295|o>>>17),o=n+(i^(s|~t))+r[13]+1309151649&4294967295,n=s+(o<<21&4294967295|o>>>11),o=t+(s^(n|~i))+r[4]+4149444226&4294967295,t=n+(o<<6&4294967295|o>>>26),o=i+(n^(t|~s))+r[11]+3174756917&4294967295,i=t+(o<<10&4294967295|o>>>22),o=s+(t^(i|~n))+r[2]+718787259&4294967295,s=i+(o<<15&4294967295|o>>>17),o=n+(i^(s|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(s+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+s&4294967295,e.g[3]=e.g[3]+i&4294967295}ut.prototype.j=function(e,t){t===void 0&&(t=e.length);for(var n=t-this.blockSize,r=this.m,s=this.h,i=0;i<t;){if(s==0)for(;i<=n;)es(this,e,i),i+=this.blockSize;if(typeof e=="string"){for(;i<t;)if(r[s++]=e.charCodeAt(i++),s==this.blockSize){es(this,r),s=0;break}}else for(;i<t;)if(r[s++]=e[i++],s==this.blockSize){es(this,r),s=0;break}}this.h=s,this.i+=t};ut.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=n&255,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};function D(e,t){this.h=t;for(var n=[],r=!0,s=e.length-1;0<=s;s--){var i=e[s]|0;r&&i==t||(n[s]=i,r=!1)}this.g=n}var Fh={};function qs(e){return-128<=e&&128>e?Ql(e,function(t){return new D([t|0],0>t?-1:0)}):new D([e|0],0>e?-1:0)}function gt(e){if(isNaN(e)||!isFinite(e))return ce;if(0>e)return Q(gt(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=ps;return new D(t,0)}function Ou(e,t){if(e.length==0)throw Error("number format error: empty string");if(t=t||10,2>t||36<t)throw Error("radix out of range: "+t);if(e.charAt(0)=="-")return Q(Ou(e.substring(1),t));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var n=gt(Math.pow(t,8)),r=ce,s=0;s<e.length;s+=8){var i=Math.min(8,e.length-s),o=parseInt(e.substring(s,s+i),t);8>i?(i=gt(Math.pow(t,i)),r=r.R(i).add(gt(o))):(r=r.R(n),r=r.add(gt(o)))}return r}var ps=4294967296,ce=qs(0),ys=qs(1),Na=qs(16777216);p=D.prototype;p.ea=function(){if(at(this))return-Q(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:ps+r)*t,t*=ps}return e};p.toString=function(e){if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(St(this))return"0";if(at(this))return"-"+Q(this).toString(e);for(var t=gt(Math.pow(e,6)),n=this,r="";;){var s=$n(n,t).g;n=Gn(n,s.R(t));var i=((0<n.g.length?n.g[0]:n.h)>>>0).toString(e);if(n=s,St(n))return i+r;for(;6>i.length;)i="0"+i;r=i+r}};p.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h};function St(e){if(e.h!=0)return!1;for(var t=0;t<e.g.length;t++)if(e.g[t]!=0)return!1;return!0}function at(e){return e.h==-1}p.X=function(e){return e=Gn(this,e),at(e)?-1:St(e)?0:1};function Q(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new D(n,~e.h).add(ys)}p.abs=function(){return at(this)?Q(this):this};p.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,s=0;s<=t;s++){var i=r+(this.D(s)&65535)+(e.D(s)&65535),o=(i>>>16)+(this.D(s)>>>16)+(e.D(s)>>>16);r=o>>>16,i&=65535,o&=65535,n[s]=o<<16|i}return new D(n,n[n.length-1]&-2147483648?-1:0)};function Gn(e,t){return e.add(Q(t))}p.R=function(e){if(St(this)||St(e))return ce;if(at(this))return at(e)?Q(this).R(Q(e)):Q(Q(this).R(e));if(at(e))return Q(this.R(Q(e)));if(0>this.X(Na)&&0>e.X(Na))return gt(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var s=0;s<e.g.length;s++){var i=this.D(r)>>>16,o=this.D(r)&65535,a=e.D(s)>>>16,u=e.D(s)&65535;n[2*r+2*s]+=o*u,On(n,2*r+2*s),n[2*r+2*s+1]+=i*u,On(n,2*r+2*s+1),n[2*r+2*s+1]+=o*a,On(n,2*r+2*s+1),n[2*r+2*s+2]+=i*a,On(n,2*r+2*s+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new D(n,0)};function On(e,t){for(;(e[t]&65535)!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function Le(e,t){this.g=e,this.h=t}function $n(e,t){if(St(t))throw Error("division by zero");if(St(e))return new Le(ce,ce);if(at(e))return t=$n(Q(e),t),new Le(Q(t.g),Q(t.h));if(at(t))return t=$n(e,Q(t)),new Le(Q(t.g),t.h);if(30<e.g.length){if(at(e)||at(t))throw Error("slowDivide_ only works with positive integers.");for(var n=ys,r=t;0>=r.X(e);)n=ka(n),r=ka(r);var s=ae(n,1),i=ae(r,1);for(r=ae(r,2),n=ae(n,2);!St(r);){var o=i.add(r);0>=o.X(e)&&(s=s.add(n),i=o),r=ae(r,1),n=ae(n,1)}return t=Gn(e,s.R(t)),new Le(s,t)}for(s=ce;0<=e.X(t);){for(n=Math.max(1,Math.floor(e.ea()/t.ea())),r=Math.ceil(Math.log(n)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),i=gt(n),o=i.R(t);at(o)||0<o.X(e);)n-=r,i=gt(n),o=i.R(t);St(i)&&(i=ys),s=s.add(i),e=Gn(e,o)}return new Le(s,e)}p.gb=function(e){return $n(this,e).h};p.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new D(n,this.h&e.h)};p.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new D(n,this.h|e.h)};p.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new D(n,this.h^e.h)};function ka(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new D(n,e.h)}function ae(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,s=[],i=0;i<r;i++)s[i]=0<t?e.D(i+n)>>>t|e.D(i+n+1)<<32-t:e.D(i+n);return new D(s,e.h)}Un.prototype.createWebChannel=Un.prototype.g;st.prototype.send=st.prototype.u;st.prototype.open=st.prototype.m;st.prototype.close=st.prototype.close;Jn.NO_ERROR=0;Jn.TIMEOUT=8;Jn.HTTP_ERROR=6;tu.COMPLETE="complete";eu.EventType=Ze;Ze.OPEN="a";Ze.CLOSE="b";Ze.ERROR="c";Ze.MESSAGE="d";$.prototype.listen=$.prototype.O;M.prototype.listenOnce=M.prototype.P;M.prototype.getLastError=M.prototype.Sa;M.prototype.getLastErrorCode=M.prototype.Ia;M.prototype.getStatus=M.prototype.da;M.prototype.getResponseJson=M.prototype.Wa;M.prototype.getResponseText=M.prototype.ja;M.prototype.send=M.prototype.ha;M.prototype.setWithCredentials=M.prototype.Oa;ut.prototype.digest=ut.prototype.l;ut.prototype.reset=ut.prototype.reset;ut.prototype.update=ut.prototype.j;D.prototype.add=D.prototype.add;D.prototype.multiply=D.prototype.R;D.prototype.modulo=D.prototype.gb;D.prototype.compare=D.prototype.X;D.prototype.toNumber=D.prototype.ea;D.prototype.toString=D.prototype.toString;D.prototype.getBits=D.prototype.D;D.fromNumber=gt;D.fromString=Ou;var Lu=ct.createWebChannelTransport=function(){return new Un},qu=ct.getStatEventTarget=function(){return Yn()},ir=ct.ErrorCode=Jn,Bu=ct.EventType=tu,Uu=ct.Event=$t,Bs=ct.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Ff=ct.FetchXmlHttpFactory=nn,on=ct.WebChannel=eu,Gu=ct.XhrIo=M,$u=ct.Md5=ut,zt=ct.Integer=D;var zu="@firebase/firestore";var j=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};j.UNAUTHENTICATED=new j(null),j.GOOGLE_CREDENTIALS=new j("google-credentials-uid"),j.FIRST_PARTY=new j("first-party-uid"),j.MOCK_USER=new j("mock-user");var De="10.11.0";var Jt=new la("@firebase/firestore");function an(){return Jt.logLevel}function y(e,...t){if(Jt.logLevel<=At.DEBUG){let n=t.map(Vo);Jt.debug(`Firestore (${De}): ${e}`,...n)}}function Et(e,...t){if(Jt.logLevel<=At.ERROR){let n=t.map(Vo);Jt.error(`Firestore (${De}): ${e}`,...n)}}function we(e,...t){if(Jt.logLevel<=At.WARN){let n=t.map(Vo);Jt.warn(`Firestore (${De}): ${e}`,...n)}}function Vo(e){if(typeof e=="string")return e;try{return function(n){return JSON.stringify(n)}(e)}catch{return e}}function E(e="Unexpected state"){let t=`FIRESTORE (${De}) INTERNAL ASSERTION FAILED: `+e;throw Et(t),new Error(t)}function N(e,t){e||E()}function A(e,t){return e}var d={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},_=class extends ua{constructor(t,n){super(t,n),this.code=t,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var _t=class{constructor(){this.promise=new Promise((t,n)=>{this.resolve=t,this.reject=n})}};var lr=class{constructor(t,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},js=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,n){t.enqueueRetryable(()=>n(j.UNAUTHENTICATED))}shutdown(){}},Ks=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,n){this.changeListener=n,t.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}},Qs=class{constructor(t){this.t=t,this.currentUser=j.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,n){let r=this.i,s=u=>this.i!==r?(r=this.i,n(u)):Promise.resolve(),i=new _t;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new _t,t.enqueueRetryable(()=>s(this.currentUser))};let o=()=>{let u=i;t.enqueueRetryable(()=>w(this,null,function*(){yield u.promise,yield s(this.currentUser)}))},a=u=>{y("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(u=>a(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?a(u):(y("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new _t)}},0),o()}getToken(){let t=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==t?(y("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(N(typeof r.accessToken=="string"),new lr(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let t=this.auth&&this.auth.getUid();return N(t===null||typeof t=="string"),new j(t)}},Ws=class{constructor(t,n,r){this.l=t,this.h=n,this.P=r,this.type="FirstParty",this.user=j.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Hs=class{constructor(t,n,r){this.l=t,this.h=n,this.P=r}getToken(){return Promise.resolve(new Ws(this.l,this.h,this.P))}start(t,n){t.enqueueRetryable(()=>n(j.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Ys=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Js=class{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,n){let r=i=>{i.error!=null&&y("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);let o=i.token!==this.R;return this.R=i.token,y("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(i.token):Promise.resolve()};this.o=i=>{t.enqueueRetryable(()=>r(i))};let s=i=>{y("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){let i=this.A.getImmediate({optional:!0});i?s(i):y("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(n=>n?(N(typeof n.token=="string"),this.R=n.token,new Ys(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function Mh(e){let t=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}var hr=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length,r="";for(;r.length<20;){let s=Mh(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<n&&(r+=t.charAt(s[i]%t.length))}return r}};function V(e,t){return e<t?-1:e>t?1:0}function ve(e,t,n){return e.length===t.length&&e.every((r,s)=>n(r,t[s]))}var H=class e{constructor(t,n){if(this.seconds=t,this.nanoseconds=n,n<0)throw new _(d.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new _(d.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(t<-62135596800)throw new _(d.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new _(d.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return e.fromMillis(Date.now())}static fromDate(t){return e.fromMillis(t.getTime())}static fromMillis(t){let n=Math.floor(t/1e3),r=Math.floor(1e6*(t-1e3*n));return new e(n,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?V(this.nanoseconds,t.nanoseconds):V(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var R=class e{constructor(t){this.timestamp=t}static fromTimestamp(t){return new e(t)}static min(){return new e(new H(0,0))}static max(){return new e(new H(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var dr=class e{constructor(t,n,r){n===void 0?n=0:n>t.length&&E(),r===void 0?r=t.length-n:r>t.length-n&&E(),this.segments=t,this.offset=n,this.len=r}get length(){return this.len}isEqual(t){return e.comparator(this,t)===0}child(t){let n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach(r=>{n.push(r)}):n.push(t),this.construct(n)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==t.get(n))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==t.get(n))return!1;return!0}forEach(t){for(let n=this.offset,r=this.limit();n<r;n++)t(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,n){let r=Math.min(t.length,n.length);for(let s=0;s<r;s++){let i=t.get(s),o=n.get(s);if(i<o)return-1;if(i>o)return 1}return t.length<n.length?-1:t.length>n.length?1:0}},F=class e extends dr{construct(t,n,r){return new e(t,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let n=[];for(let r of t){if(r.indexOf("//")>=0)throw new _(d.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(s=>s.length>0))}return new e(n)}static emptyPath(){return new e([])}},Oh=/^[_a-zA-Z][_a-zA-Z0-9]*$/,it=class e extends dr{construct(t,n,r){return new e(t,n,r)}static isValidIdentifier(t){return Oh.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new e(["__name__"])}static fromServerFormat(t){let n=[],r="",s=0,i=()=>{if(r.length===0)throw new _(d.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""},o=!1;for(;s<t.length;){let a=t[s];if(a==="\\"){if(s+1===t.length)throw new _(d.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let u=t[s+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new _(d.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new _(d.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)}static emptyPath(){return new e([])}};var I=class e{constructor(t){this.path=t}static fromPath(t){return new e(F.fromString(t))}static fromName(t){return new e(F.fromString(t).popFirst(5))}static empty(){return new e(F.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&F.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,n){return F.comparator(t.path,n.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new e(new F(t.slice()))}};var Xs=class{constructor(t,n,r,s){this.indexId=t,this.collectionGroup=n,this.fields=r,this.indexState=s}};Xs.UNKNOWN_ID=-1;function Lh(e,t){let n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,s=R.fromTimestamp(r===1e9?new H(n+1,0):new H(n,r));return new Xt(s,I.empty(),t)}function qh(e){return new Xt(e.readTime,e.key,-1)}var Xt=class e{constructor(t,n,r){this.readTime=t,this.documentKey=n,this.largestBatchId=r}static min(){return new e(R.min(),I.empty(),-1)}static max(){return new e(R.max(),I.empty(),-1)}};function Bh(e,t){let n=e.readTime.compareTo(t.readTime);return n!==0?n:(n=I.comparator(e.documentKey,t.documentKey),n!==0?n:V(e.largestBatchId,t.largestBatchId))}var Uh="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Zs=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function Sn(e){return w(this,null,function*(){if(e.code!==d.FAILED_PRECONDITION||e.message!==Uh)throw e;y("LocalStore","Unexpectedly lost primary lease")})}var m=class e{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(t){return this.next(void 0,t)}next(t,n){return this.callbackAttached&&E(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new e((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(t,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(n,i).next(r,s)}})}toPromise(){return new Promise((t,n)=>{this.next(t,n)})}wrapUserFunction(t){try{let n=t();return n instanceof e?n:e.resolve(n)}catch(n){return e.reject(n)}}wrapSuccess(t,n){return t?this.wrapUserFunction(()=>t(n)):e.resolve(n)}wrapFailure(t,n){return t?this.wrapUserFunction(()=>t(n)):e.reject(n)}static resolve(t){return new e((n,r)=>{n(t)})}static reject(t){return new e((n,r)=>{r(t)})}static waitFor(t){return new e((n,r)=>{let s=0,i=0,o=!1;t.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&n()},u=>r(u))}),o=!0,i===s&&n()})}static or(t){let n=e.resolve(!1);for(let r of t)n=n.next(s=>s?e.resolve(s):r());return n}static forEach(t,n){let r=[];return t.forEach((s,i)=>{r.push(n.call(this,s,i))}),this.waitFor(r)}static mapArray(t,n){return new e((r,s)=>{let i=t.length,o=new Array(i),a=0;for(let u=0;u<i;u++){let c=u;n(t[c]).next(l=>{o[c]=l,++a,a===i&&r(o)},l=>s(l))}})}static doWhile(t,n){return new e((r,s)=>{let i=()=>{t()===!0?n().next(()=>{i()},s):r()};i()})}};var ti=class e{constructor(t,n){this.action=t,this.transaction=n,this.aborted=!1,this.V=new _t,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{n.error?this.V.reject(new Ht(t,n.error)):this.V.resolve()},this.transaction.onerror=r=>{let s=Do(r.target.error);this.V.reject(new Ht(t,s))}}static open(t,n,r,s){try{return new e(n,t.transaction(s,r))}catch(i){throw new Ht(n,i)}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(y("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){let n=this.transaction.objectStore(t);return new ni(n)}},fr=class e{constructor(t,n,r){this.name=t,this.version=n,this.p=r,e.S(Fe())===12.2&&Et("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return y("SimpleDb","Removing database:",t),jt(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!aa())return!1;if(e.C())return!0;let t=Fe(),n=e.S(t),r=0<n&&n<10,s=e.v(t),i=0<s&&s<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||i)}static C(){var t;return typeof process<"u"&&((t=process.__PRIVATE_env)===null||t===void 0?void 0:t.F)==="YES"}static M(t,n){return t.store(n)}static S(t){let n=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=n?n[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static v(t){let n=t.match(/Android ([\d.]+)/i),r=n?n[1].split(".").slice(0,2).join("."):"-1";return Number(r)}O(t){return w(this,null,function*(){return this.db||(y("SimpleDb","Opening database:",this.name),this.db=yield new Promise((n,r)=>{let s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{let o=i.target.result;n(o)},s.onblocked=()=>{r(new Ht(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{let o=i.target.error;o.name==="VersionError"?r(new _(d.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new _(d.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Ht(t,o))},s.onupgradeneeded=i=>{y("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);let o=i.target.result;this.p.N(o,s.transaction,i.oldVersion,this.version).next(()=>{y("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.L&&(this.db.onversionchange=n=>this.L(n)),this.db})}B(t){this.L=t,this.db&&(this.db.onversionchange=n=>t(n))}runTransaction(t,n,r,s){return w(this,null,function*(){let i=n==="readonly",o=0;for(;;){++o;try{this.db=yield this.O(t);let a=ti.open(this.db,t,i?"readonly":"readwrite",r),u=s(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),m.reject(c))).toPromise();return u.catch(()=>{}),yield a.m,u}catch(a){let u=a,c=u.name!=="FirebaseError"&&o<3;if(y("SimpleDb","Transaction failed with error:",u.message,"Retrying:",c),this.close(),!c)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}},ei=class{constructor(t){this.k=t,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(t){this.k=t}done(){this.q=!0}U(t){this.K=t}delete(){return jt(this.k.delete())}},Ht=class extends _{constructor(t,n){super(d.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${n}`),this.name="IndexedDbTransactionError"}};function Rn(e){return e.name==="IndexedDbTransactionError"}var ni=class{constructor(t){this.store=t}put(t,n){let r;return n!==void 0?(y("SimpleDb","PUT",this.store.name,t,n),r=this.store.put(n,t)):(y("SimpleDb","PUT",this.store.name,"<auto-key>",t),r=this.store.put(t)),jt(r)}add(t){return y("SimpleDb","ADD",this.store.name,t,t),jt(this.store.add(t))}get(t){return jt(this.store.get(t)).next(n=>(n===void 0&&(n=null),y("SimpleDb","GET",this.store.name,t,n),n))}delete(t){return y("SimpleDb","DELETE",this.store.name,t),jt(this.store.delete(t))}count(){return y("SimpleDb","COUNT",this.store.name),jt(this.store.count())}W(t,n){let r=this.options(t,n),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){let i=s.getAll(r.range);return new m((o,a)=>{i.onerror=u=>{a(u.target.error)},i.onsuccess=u=>{o(u.target.result)}})}{let i=this.cursor(r),o=[];return this.G(i,(a,u)=>{o.push(u)}).next(()=>o)}}j(t,n){let r=this.store.getAll(t,n===null?void 0:n);return new m((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}H(t,n){y("SimpleDb","DELETE ALL",this.store.name);let r=this.options(t,n);r.J=!1;let s=this.cursor(r);return this.G(s,(i,o,a)=>a.delete())}Y(t,n){let r;n?r=t:(r={},n=t);let s=this.cursor(r);return this.G(s,n)}Z(t){let n=this.cursor({});return new m((r,s)=>{n.onerror=i=>{let o=Do(i.target.error);s(o)},n.onsuccess=i=>{let o=i.target.result;o?t(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}G(t,n){let r=[];return new m((s,i)=>{t.onerror=o=>{i(o.target.error)},t.onsuccess=o=>{let a=o.target.result;if(!a)return void s();let u=new ei(a),c=n(a.primaryKey,a.value,u);if(c instanceof m){let l=c.catch(h=>(u.done(),m.reject(h)));r.push(l)}u.isDone?s():u.$===null?a.continue():a.continue(u.$)}}).next(()=>m.waitFor(r))}options(t,n){let r;return t!==void 0&&(typeof t=="string"?r=t:n=t),{index:r,range:n}}cursor(t){let n="next";if(t.reverse&&(n="prev"),t.index){let r=this.store.index(t.index);return t.J?r.openKeyCursor(t.range,n):r.openCursor(t.range,n)}return this.store.openCursor(t.range,n)}};function jt(e){return new m((t,n)=>{e.onsuccess=r=>{let s=r.target.result;t(s)},e.onerror=r=>{let s=Do(r.target.error);n(s)}})}var ju=!1;function Do(e){let t=fr.S(Fe());if(t>=12.2&&t<13){let n="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(n)>=0){let r=new _("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${n}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ju||(ju=!0,setTimeout(()=>{throw r},0)),r}}return e}var Ac=(()=>{class e{constructor(n,r){this.previousValue=n,r&&(r.sequenceNumberHandler=s=>this.se(s),this.oe=s=>r.writeSequenceNumber(s))}se(n){return this.previousValue=Math.max(n,this.previousValue),this.previousValue}next(){let n=++this.previousValue;return this.oe&&this.oe(n),n}}return e._e=-1,e})();function Gr(e){return e==null}function mn(e){return e===0&&1/e==-1/0}function Gh(e){return typeof e=="number"&&Number.isInteger(e)&&!mn(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}var $h=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Qf=[...$h,"documentOverlays"],zh=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],jh=zh,Wf=[...jh,"indexConfiguration","indexState","indexEntries"];function Ku(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function be(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Sc(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}var L=class e{constructor(t,n){this.comparator=t,this.root=n||wt.EMPTY}insert(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,wt.BLACK,null,null))}remove(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,wt.BLACK,null,null))}get(t){let n=this.root;for(;!n.isEmpty();){let r=this.comparator(t,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(t){let n=0,r=this.root;for(;!r.isEmpty();){let s=this.comparator(t,r.key);if(s===0)return n+r.left.size;s<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((n,r)=>(t(n,r),!1))}toString(){let t=[];return this.inorderTraversal((n,r)=>(t.push(`${n}:${r}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new pe(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new pe(this.root,t,this.comparator,!1)}getReverseIterator(){return new pe(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new pe(this.root,t,this.comparator,!0)}},pe=class{constructor(t,n,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=n?r(t.key,n):1,n&&s&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(i===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),n={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},wt=class e{constructor(t,n,r,s,i){this.key=t,this.value=n,this.color=r??e.RED,this.left=s??e.EMPTY,this.right=i??e.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,n,r,s,i){return new e(t??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,n,r){let s=this,i=r(t,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(t,n,r),null):i===0?s.copy(null,n,null,null,null):s.copy(null,null,null,null,s.right.insert(t,n,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return e.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,n){let r,s=this;if(n(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,n),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),n(t,s.key)===0){if(s.right.isEmpty())return e.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,n))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,n)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw E();let t=this.left.check();if(t!==this.right.check())throw E();return t+(this.isRed()?0:1)}};wt.EMPTY=null,wt.RED=!0,wt.BLACK=!1;wt.EMPTY=new class{constructor(){this.size=0}get key(){throw E()}get value(){throw E()}get color(){throw E()}get left(){throw E()}get right(){throw E()}copy(t,n,r,s,i){return this}insert(t,n,r){return new wt(t,n)}remove(t,n){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var Z=class e{constructor(t){this.comparator=t,this.data=new L(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((n,r)=>(t(n),!1))}forEachInRange(t,n){let r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){let s=r.getNext();if(this.comparator(s.key,t[1])>=0)return;n(s.key)}}forEachWhile(t,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){let n=this.data.getIteratorFrom(t);return n.hasNext()?n.getNext().key:null}getIterator(){return new mr(this.data.getIterator())}getIteratorFrom(t){return new mr(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let n=this;return n.size<t.size&&(n=t,t=this),t.forEach(r=>{n=n.add(r)}),n}isEqual(t){if(!(t instanceof e)||this.size!==t.size)return!1;let n=this.data.getIterator(),r=t.data.getIterator();for(;n.hasNext();){let s=n.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(n=>{t.push(n)}),t}toString(){let t=[];return this.forEach(n=>t.push(n)),"SortedSet("+t.toString()+")"}copy(t){let n=new e(this.comparator);return n.data=t,n}},mr=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};var yt=class e{constructor(t){this.fields=t,t.sort(it.comparator)}static empty(){return new e([])}unionWith(t){let n=new Z(it.comparator);for(let r of this.fields)n=n.add(r);for(let r of t)n=n.add(r);return new e(n.toArray())}covers(t){for(let n of this.fields)if(n.isPrefixOf(t))return!0;return!1}isEqual(t){return ve(this.fields,t.fields,(n,r)=>n.isEqual(r))}};var gr=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var et=class e{constructor(t){this.binaryString=t}static fromBase64String(t){let n=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new gr("Invalid base64 string: "+i):i}}(t);return new e(n)}static fromUint8Array(t){let n=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(t);return new e(n)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){let r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return V(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};et.EMPTY_BYTE_STRING=new et("");var Kh=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Pt(e){if(N(!!e),typeof e=="string"){let t=0,n=Kh.exec(e);if(N(!!n),n[1]){let s=n[1];s=(s+"000000000").substr(0,9),t=Number(s)}let r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:O(e.seconds),nanos:O(e.nanos)}}function O(e){return typeof e=="number"?e:typeof e=="string"?Number(e):0}function kt(e){return typeof e=="string"?et.fromBase64String(e):et.fromUint8Array(e)}function bo(e){var t,n;return((n=(((t=e?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function No(e){let t=e.mapValue.fields.__previous_value__;return bo(t)?No(t):t}function gn(e){let t=Pt(e.mapValue.fields.__local_write_time__.timestampValue);return new H(t.seconds,t.nanos)}var ri=class{constructor(t,n,r,s,i,o,a,u,c){this.databaseId=t,this.appId=n,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}},pr=class e{constructor(t,n){this.projectId=t,this.database=n||"(default)"}static empty(){return new e("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database}};var or={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Zt(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?bo(e)?4:Rc(e)?9007199254740991:10:E()}function Tt(e,t){if(e===t)return!0;let n=Zt(e);if(n!==Zt(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return gn(e).isEqual(gn(t));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;let o=Pt(s.timestampValue),a=Pt(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(s,i){return kt(s.bytesValue).isEqual(kt(i.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(s,i){return O(s.geoPointValue.latitude)===O(i.geoPointValue.latitude)&&O(s.geoPointValue.longitude)===O(i.geoPointValue.longitude)}(e,t);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return O(s.integerValue)===O(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){let o=O(s.doubleValue),a=O(i.doubleValue);return o===a?mn(o)===mn(a):isNaN(o)&&isNaN(a)}return!1}(e,t);case 9:return ve(e.arrayValue.values||[],t.arrayValue.values||[],Tt);case 10:return function(s,i){let o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(Ku(o)!==Ku(a))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(a[u]===void 0||!Tt(o[u],a[u])))return!1;return!0}(e,t);default:return E()}}function pn(e,t){return(e.values||[]).find(n=>Tt(n,t))!==void 0}function Ie(e,t){if(e===t)return 0;let n=Zt(e),r=Zt(t);if(n!==r)return V(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return V(e.booleanValue,t.booleanValue);case 2:return function(i,o){let a=O(i.integerValue||i.doubleValue),u=O(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(e,t);case 3:return Qu(e.timestampValue,t.timestampValue);case 4:return Qu(gn(e),gn(t));case 5:return V(e.stringValue,t.stringValue);case 6:return function(i,o){let a=kt(i),u=kt(o);return a.compareTo(u)}(e.bytesValue,t.bytesValue);case 7:return function(i,o){let a=i.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){let l=V(a[c],u[c]);if(l!==0)return l}return V(a.length,u.length)}(e.referenceValue,t.referenceValue);case 8:return function(i,o){let a=V(O(i.latitude),O(o.latitude));return a!==0?a:V(O(i.longitude),O(o.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(i,o){let a=i.values||[],u=o.values||[];for(let c=0;c<a.length&&c<u.length;++c){let l=Ie(a[c],u[c]);if(l)return l}return V(a.length,u.length)}(e.arrayValue,t.arrayValue);case 10:return function(i,o){if(i===or.mapValue&&o===or.mapValue)return 0;if(i===or.mapValue)return 1;if(o===or.mapValue)return-1;let a=i.fields||{},u=Object.keys(a),c=o.fields||{},l=Object.keys(c);u.sort(),l.sort();for(let h=0;h<u.length&&h<l.length;++h){let f=V(u[h],l[h]);if(f!==0)return f;let g=Ie(a[u[h]],c[l[h]]);if(g!==0)return g}return V(u.length,l.length)}(e.mapValue,t.mapValue);default:throw E()}}function Qu(e,t){if(typeof e=="string"&&typeof t=="string"&&e.length===t.length)return V(e,t);let n=Pt(e),r=Pt(t),s=V(n.seconds,r.seconds);return s!==0?s:V(n.nanos,r.nanos)}function Ee(e){return si(e)}function si(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(n){let r=Pt(n);return`time(${r.seconds},${r.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(n){return kt(n).toBase64()}(e.bytesValue):"referenceValue"in e?function(n){return I.fromName(n).toString()}(e.referenceValue):"geoPointValue"in e?function(n){return`geo(${n.latitude},${n.longitude})`}(e.geoPointValue):"arrayValue"in e?function(n){let r="[",s=!0;for(let i of n.values||[])s?s=!1:r+=",",r+=si(i);return r+"]"}(e.arrayValue):"mapValue"in e?function(n){let r=Object.keys(n.fields||{}).sort(),s="{",i=!0;for(let o of r)i?i=!1:s+=",",s+=`${o}:${si(n.fields[o])}`;return s+"}"}(e.mapValue):E()}function Wu(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function ii(e){return!!e&&"integerValue"in e}function ko(e){return!!e&&"arrayValue"in e}function Hu(e){return!!e&&"nullValue"in e}function Yu(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function ur(e){return!!e&&"mapValue"in e}function cn(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&typeof e.timestampValue=="object")return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return be(e.mapValue.fields,(n,r)=>t.mapValue.fields[n]=cn(r)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=cn(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Rc(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var lt=class e{constructor(t){this.value=t}static empty(){return new e({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let n=this.value;for(let r=0;r<t.length-1;++r)if(n=(n.mapValue.fields||{})[t.get(r)],!ur(n))return null;return n=(n.mapValue.fields||{})[t.lastSegment()],n||null}}set(t,n){this.getFieldsMap(t.popLast())[t.lastSegment()]=cn(n)}setAll(t){let n=it.emptyPath(),r={},s=[];t.forEach((o,a)=>{if(!n.isImmediateParentOf(a)){let u=this.getFieldsMap(n);this.applyChanges(u,r,s),r={},s=[],n=a.popLast()}o?r[a.lastSegment()]=cn(o):s.push(a.lastSegment())});let i=this.getFieldsMap(n);this.applyChanges(i,r,s)}delete(t){let n=this.field(t.popLast());ur(n)&&n.mapValue.fields&&delete n.mapValue.fields[t.lastSegment()]}isEqual(t){return Tt(this.value,t.value)}getFieldsMap(t){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<t.length;++r){let s=n.mapValue.fields[t.get(r)];ur(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},n.mapValue.fields[t.get(r)]=s),n=s}return n.mapValue.fields}applyChanges(t,n,r){be(n,(s,i)=>t[s]=i);for(let s of r)delete t[s]}clone(){return new e(cn(this.value))}};function Pc(e){let t=[];return be(e.fields,(n,r)=>{let s=new it([n]);if(ur(r)){let i=Pc(r.mapValue).fields;if(i.length===0)t.push(s);else for(let o of i)t.push(s.child(o))}else t.push(s)}),new yt(t)}var ht=class e{constructor(t,n,r,s,i,o,a){this.key=t,this.documentType=n,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(t){return new e(t,0,R.min(),R.min(),R.min(),lt.empty(),0)}static newFoundDocument(t,n,r,s){return new e(t,1,n,R.min(),r,s,0)}static newNoDocument(t,n){return new e(t,2,n,R.min(),R.min(),lt.empty(),0)}static newUnknownDocument(t,n){return new e(t,3,n,R.min(),R.min(),lt.empty(),2)}convertToFoundDocument(t,n){return!this.createTime.isEqual(R.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=lt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=lt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=R.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new e(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Te=class{constructor(t,n){this.position=t,this.inclusive=n}};function Ju(e,t,n){let r=0;for(let s=0;s<e.position.length;s++){let i=t[s],o=e.position[s];if(i.field.isKeyField()?r=I.comparator(I.fromName(o.referenceValue),n.key):r=Ie(o,n.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function Xu(e,t){if(e===null)return t===null;if(t===null||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Tt(e.position[n],t.position[n]))return!1;return!0}var te=class{constructor(t,n="asc"){this.field=t,this.dir=n}};function Qh(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}var yr=class{},G=class e extends yr{constructor(t,n,r){super(),this.field=t,this.op=n,this.value=r}static create(t,n,r){return t.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(t,n,r):new ai(t,n,r):n==="array-contains"?new li(t,r):n==="in"?new hi(t,r):n==="not-in"?new di(t,r):n==="array-contains-any"?new fi(t,r):new e(t,n,r)}static createKeyFieldInFilter(t,n,r){return n==="in"?new ui(t,r):new ci(t,r)}matches(t){let n=t.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(Ie(n,this.value)):n!==null&&Zt(this.value)===Zt(n)&&this.matchesComparison(Ie(n,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return E()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},dt=class e extends yr{constructor(t,n){super(),this.filters=t,this.op=n,this.ue=null}static create(t,n){return new e(t,n)}matches(t){return Cc(this)?this.filters.find(n=>!n.matches(t))===void 0:this.filters.find(n=>n.matches(t))!==void 0}getFlattenedFilters(){return this.ue!==null||(this.ue=this.filters.reduce((t,n)=>t.concat(n.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}};function Cc(e){return e.op==="and"}function xc(e){return Wh(e)&&Cc(e)}function Wh(e){for(let t of e.filters)if(t instanceof dt)return!1;return!0}function oi(e){if(e instanceof G)return e.field.canonicalString()+e.op.toString()+Ee(e.value);if(xc(e))return e.filters.map(t=>oi(t)).join(",");{let t=e.filters.map(n=>oi(n)).join(",");return`${e.op}(${t})`}}function Vc(e,t){return e instanceof G?function(r,s){return s instanceof G&&r.op===s.op&&r.field.isEqual(s.field)&&Tt(r.value,s.value)}(e,t):e instanceof dt?function(r,s){return s instanceof dt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&Vc(o,s.filters[a]),!0):!1}(e,t):void E()}function Dc(e){return e instanceof G?function(n){return`${n.field.canonicalString()} ${n.op} ${Ee(n.value)}`}(e):e instanceof dt?function(n){return n.op.toString()+" {"+n.getFilters().map(Dc).join(" ,")+"}"}(e):"Filter"}var ai=class extends G{constructor(t,n,r){super(t,n,r),this.key=I.fromName(r.referenceValue)}matches(t){let n=I.comparator(t.key,this.key);return this.matchesComparison(n)}},ui=class extends G{constructor(t,n){super(t,"in",n),this.keys=bc("in",n)}matches(t){return this.keys.some(n=>n.isEqual(t.key))}},ci=class extends G{constructor(t,n){super(t,"not-in",n),this.keys=bc("not-in",n)}matches(t){return!this.keys.some(n=>n.isEqual(t.key))}};function bc(e,t){var n;return(((n=t.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>I.fromName(r.referenceValue))}var li=class extends G{constructor(t,n){super(t,"array-contains",n)}matches(t){let n=t.data.field(this.field);return ko(n)&&pn(n.arrayValue,this.value)}},hi=class extends G{constructor(t,n){super(t,"in",n)}matches(t){let n=t.data.field(this.field);return n!==null&&pn(this.value.arrayValue,n)}},di=class extends G{constructor(t,n){super(t,"not-in",n)}matches(t){if(pn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let n=t.data.field(this.field);return n!==null&&!pn(this.value.arrayValue,n)}},fi=class extends G{constructor(t,n){super(t,"array-contains-any",n)}matches(t){let n=t.data.field(this.field);return!(!ko(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>pn(this.value.arrayValue,r))}};var mi=class{constructor(t,n=null,r=[],s=[],i=null,o=null,a=null){this.path=t,this.collectionGroup=n,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ce=null}};function Zu(e,t=null,n=[],r=[],s=null,i=null,o=null){return new mi(e,t,n,r,s,i,o)}function Fo(e){let t=A(e);if(t.ce===null){let n=t.path.canonicalString();t.collectionGroup!==null&&(n+="|cg:"+t.collectionGroup),n+="|f:",n+=t.filters.map(r=>oi(r)).join(","),n+="|ob:",n+=t.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Gr(t.limit)||(n+="|l:",n+=t.limit),t.startAt&&(n+="|lb:",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(r=>Ee(r)).join(",")),t.endAt&&(n+="|ub:",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(r=>Ee(r)).join(",")),t.ce=n}return t.ce}function Mo(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Qh(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Vc(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Xu(e.startAt,t.startAt)&&Xu(e.endAt,t.endAt)}function gi(e){return I.isDocumentKey(e.path)&&e.collectionGroup===null&&e.filters.length===0}var Ft=class{constructor(t,n=null,r=[],s=[],i=null,o="F",a=null,u=null){this.path=t,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=u,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}};function Hh(e,t,n,r,s,i,o,a){return new Ft(e,t,n,r,s,i,o,a)}function Oo(e){return new Ft(e)}function tc(e){return e.filters.length===0&&e.limit===null&&e.startAt==null&&e.endAt==null&&(e.explicitOrderBy.length===0||e.explicitOrderBy.length===1&&e.explicitOrderBy[0].field.isKeyField())}function Nc(e){return e.collectionGroup!==null}function ln(e){let t=A(e);if(t.le===null){t.le=[];let n=new Set;for(let i of t.explicitOrderBy)t.le.push(i),n.add(i.field.canonicalString());let r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Z(it.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(t).forEach(i=>{n.has(i.canonicalString())||i.isKeyField()||t.le.push(new te(i,r))}),n.has(it.keyField().canonicalString())||t.le.push(new te(it.keyField(),r))}return t.le}function vt(e){let t=A(e);return t.he||(t.he=Yh(t,ln(e))),t.he}function Yh(e,t){if(e.limitType==="F")return Zu(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(s=>{let i=s.dir==="desc"?"asc":"desc";return new te(s.field,i)});let n=e.endAt?new Te(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new Te(e.startAt.position,e.startAt.inclusive):null;return Zu(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function pi(e,t){let n=e.filters.concat([t]);return new Ft(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function yi(e,t,n){return new Ft(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function $r(e,t){return Mo(vt(e),vt(t))&&e.limitType===t.limitType}function kc(e){return`${Fo(vt(e))}|lt:${e.limitType}`}function fe(e){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(s=>Dc(s)).join(", ")}]`),Gr(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(s=>Ee(s)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(s=>Ee(s)).join(",")),`Target(${r})`}(vt(e))}; limitType=${e.limitType})`}function zr(e,t){return t.isFoundDocument()&&function(r,s){let i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):I.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(e,t)&&function(r,s){for(let i of ln(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(e,t)&&function(r,s){for(let i of r.filters)if(!i.matches(s))return!1;return!0}(e,t)&&function(r,s){return!(r.startAt&&!function(o,a,u){let c=Ju(o,a,u);return o.inclusive?c<=0:c<0}(r.startAt,ln(r),s)||r.endAt&&!function(o,a,u){let c=Ju(o,a,u);return o.inclusive?c>=0:c>0}(r.endAt,ln(r),s))}(e,t)}function Jh(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Fc(e){return(t,n)=>{let r=!1;for(let s of ln(e)){let i=Xh(s,t,n);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function Xh(e,t,n){let r=e.field.isKeyField()?I.comparator(t.key,n.key):function(i,o,a){let u=o.data.field(i),c=a.data.field(i);return u!==null&&c!==null?Ie(u,c):E()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return E()}}var Mt=class{constructor(t,n){this.mapKeyFn=t,this.equalsFn=n,this.inner={},this.innerSize=0}get(t){let n=this.mapKeyFn(t),r=this.inner[n];if(r!==void 0){for(let[s,i]of r)if(this.equalsFn(s,t))return i}}has(t){return this.get(t)!==void 0}set(t,n){let r=this.mapKeyFn(t),s=this.inner[r];if(s===void 0)return this.inner[r]=[[t,n]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],t))return void(s[i]=[t,n]);s.push([t,n]),this.innerSize++}delete(t){let n=this.mapKeyFn(t),r=this.inner[n];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],t))return r.length===1?delete this.inner[n]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(t){be(this.inner,(n,r)=>{for(let[s,i]of r)t(s,i)})}isEmpty(){return Sc(this.inner)}size(){return this.innerSize}};var Zh=new L(I.comparator);function Ct(){return Zh}var Mc=new L(I.comparator);function un(...e){let t=Mc;for(let n of e)t=t.insert(n.key,n);return t}function Oc(e){let t=Mc;return e.forEach((n,r)=>t=t.insert(n,r.overlayedDocument)),t}function Kt(){return hn()}function Lc(){return hn()}function hn(){return new Mt(e=>e.toString(),(e,t)=>e.isEqual(t))}var td=new L(I.comparator),ed=new Z(I.comparator);function C(...e){let t=ed;for(let n of e)t=t.add(n);return t}var nd=new Z(V);function rd(){return nd}function qc(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:mn(t)?"-0":t}}function Bc(e){return{integerValue:""+e}}function sd(e,t){return Gh(t)?Bc(t):qc(e,t)}var Ae=class{constructor(){this._=void 0}};function id(e,t,n){return e instanceof Se?function(s,i){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&bo(i)&&(i=No(i)),i&&(o.fields.__previous_value__=i),{mapValue:o}}(n,t):e instanceof ee?Gc(e,t):e instanceof ne?$c(e,t):function(s,i){let o=Uc(s,i),a=ec(o)+ec(s.Ie);return ii(o)&&ii(s.Ie)?Bc(a):qc(s.serializer,a)}(e,t)}function od(e,t,n){return e instanceof ee?Gc(e,t):e instanceof ne?$c(e,t):n}function Uc(e,t){return e instanceof Re?function(r){return ii(r)||function(i){return!!i&&"doubleValue"in i}(r)}(t)?t:{integerValue:0}:null}var Se=class extends Ae{},ee=class extends Ae{constructor(t){super(),this.elements=t}};function Gc(e,t){let n=zc(t);for(let r of e.elements)n.some(s=>Tt(s,r))||n.push(r);return{arrayValue:{values:n}}}var ne=class extends Ae{constructor(t){super(),this.elements=t}};function $c(e,t){let n=zc(t);for(let r of e.elements)n=n.filter(s=>!Tt(s,r));return{arrayValue:{values:n}}}var Re=class extends Ae{constructor(t,n){super(),this.serializer=t,this.Ie=n}};function ec(e){return O(e.integerValue||e.doubleValue)}function zc(e){return ko(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}function ad(e,t){return e.field.isEqual(t.field)&&function(r,s){return r instanceof ee&&s instanceof ee||r instanceof ne&&s instanceof ne?ve(r.elements,s.elements,Tt):r instanceof Re&&s instanceof Re?Tt(r.Ie,s.Ie):r instanceof Se&&s instanceof Se}(e.transform,t.transform)}var _i=class{constructor(t,n){this.version=t,this.transformResults=n}},Yt=class e{constructor(t,n){this.updateTime=t,this.exists=n}static none(){return new e}static exists(t){return new e(void 0,t)}static updateTime(t){return new e(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function cr(e,t){return e.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(e.updateTime):e.exists===void 0||e.exists===t.isFoundDocument()}var Pe=class{};function jc(e,t){if(!e.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return e.isNoDocument()?new _r(e.key,Yt.none()):new re(e.key,e.data,Yt.none());{let n=e.data,r=lt.empty(),s=new Z(it.comparator);for(let i of t.fields)if(!s.has(i)){let o=n.field(i);o===null&&i.length>1&&(i=i.popLast(),o=n.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new xt(e.key,r,new yt(s.toArray()),Yt.none())}}function ud(e,t,n){e instanceof re?function(s,i,o){let a=s.value.clone(),u=rc(s.fieldTransforms,i,o.transformResults);a.setAll(u),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(e,t,n):e instanceof xt?function(s,i,o){if(!cr(s.precondition,i))return void i.convertToUnknownDocument(o.version);let a=rc(s.fieldTransforms,i,o.transformResults),u=i.data;u.setAll(Kc(s)),u.setAll(a),i.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(e,t,n):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,t,n)}function dn(e,t,n,r){return e instanceof re?function(i,o,a,u){if(!cr(i.precondition,o))return a;let c=i.value.clone(),l=sc(i.fieldTransforms,u,o);return c.setAll(l),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(e,t,n,r):e instanceof xt?function(i,o,a,u){if(!cr(i.precondition,o))return a;let c=sc(i.fieldTransforms,u,o),l=o.data;return l.setAll(Kc(i)),l.setAll(c),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(h=>h.field))}(e,t,n,r):function(i,o,a){return cr(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(e,t,n)}function cd(e,t){let n=null;for(let r of e.fieldTransforms){let s=t.data.field(r.field),i=Uc(r.transform,s||null);i!=null&&(n===null&&(n=lt.empty()),n.set(r.field,i))}return n||null}function nc(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&ve(r,s,(i,o)=>ad(i,o))}(e.fieldTransforms,t.fieldTransforms)&&(e.type===0?e.value.isEqual(t.value):e.type!==1||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}var re=class extends Pe{constructor(t,n,r,s=[]){super(),this.key=t,this.value=n,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}},xt=class extends Pe{constructor(t,n,r,s,i=[]){super(),this.key=t,this.data=n,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}};function Kc(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function rc(e,t,n){let r=new Map;N(e.length===n.length);for(let s=0;s<n.length;s++){let i=e[s],o=i.transform,a=t.data.field(i.field);r.set(i.field,od(o,a,n[s]))}return r}function sc(e,t,n){let r=new Map;for(let s of e){let i=s.transform,o=n.data.field(s.field);r.set(s.field,id(i,o,t))}return r}var _r=class extends Pe{constructor(t,n){super(),this.key=t,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},wi=class extends Pe{constructor(t,n){super(),this.key=t,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var vi=class{constructor(t,n,r,s){this.batchId=t,this.localWriteTime=n,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(t,n){let r=n.mutationResults;for(let s=0;s<this.mutations.length;s++){let i=this.mutations[s];i.key.isEqual(t.key)&&ud(i,t,r[s])}}applyToLocalView(t,n){for(let r of this.baseMutations)r.key.isEqual(t.key)&&(n=dn(r,t,n,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(t.key)&&(n=dn(r,t,n,this.localWriteTime));return n}applyToLocalDocumentSet(t,n){let r=Lc();return this.mutations.forEach(s=>{let i=t.get(s.key),o=i.overlayedDocument,a=this.applyToLocalView(o,i.mutatedFields);a=n.has(s.key)?null:a;let u=jc(o,a);u!==null&&r.set(s.key,u),o.isValidDocument()||o.convertToNoDocument(R.min())}),r}keys(){return this.mutations.reduce((t,n)=>t.add(n.key),C())}isEqual(t){return this.batchId===t.batchId&&ve(this.mutations,t.mutations,(n,r)=>nc(n,r))&&ve(this.baseMutations,t.baseMutations,(n,r)=>nc(n,r))}},Ii=class e{constructor(t,n,r,s){this.batch=t,this.commitVersion=n,this.mutationResults=r,this.docVersions=s}static from(t,n,r){N(t.mutations.length===r.length);let s=function(){return td}(),i=t.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new e(t,n,r,s)}};var Ei=class{constructor(t,n){this.largestBatchId=t,this.mutation=n}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Ti=class{constructor(t,n){this.count=t,this.unchangedNames=n}};var B,x;function ld(e){switch(e){default:return E();case d.CANCELLED:case d.UNKNOWN:case d.DEADLINE_EXCEEDED:case d.RESOURCE_EXHAUSTED:case d.INTERNAL:case d.UNAVAILABLE:case d.UNAUTHENTICATED:return!1;case d.INVALID_ARGUMENT:case d.NOT_FOUND:case d.ALREADY_EXISTS:case d.PERMISSION_DENIED:case d.FAILED_PRECONDITION:case d.ABORTED:case d.OUT_OF_RANGE:case d.UNIMPLEMENTED:case d.DATA_LOSS:return!0}}function Qc(e){if(e===void 0)return Et("GRPC error has no .code"),d.UNKNOWN;switch(e){case B.OK:return d.OK;case B.CANCELLED:return d.CANCELLED;case B.UNKNOWN:return d.UNKNOWN;case B.DEADLINE_EXCEEDED:return d.DEADLINE_EXCEEDED;case B.RESOURCE_EXHAUSTED:return d.RESOURCE_EXHAUSTED;case B.INTERNAL:return d.INTERNAL;case B.UNAVAILABLE:return d.UNAVAILABLE;case B.UNAUTHENTICATED:return d.UNAUTHENTICATED;case B.INVALID_ARGUMENT:return d.INVALID_ARGUMENT;case B.NOT_FOUND:return d.NOT_FOUND;case B.ALREADY_EXISTS:return d.ALREADY_EXISTS;case B.PERMISSION_DENIED:return d.PERMISSION_DENIED;case B.FAILED_PRECONDITION:return d.FAILED_PRECONDITION;case B.ABORTED:return d.ABORTED;case B.OUT_OF_RANGE:return d.OUT_OF_RANGE;case B.UNIMPLEMENTED:return d.UNIMPLEMENTED;case B.DATA_LOSS:return d.DATA_LOSS;default:return E()}}(x=B||(B={}))[x.OK=0]="OK",x[x.CANCELLED=1]="CANCELLED",x[x.UNKNOWN=2]="UNKNOWN",x[x.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",x[x.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",x[x.NOT_FOUND=5]="NOT_FOUND",x[x.ALREADY_EXISTS=6]="ALREADY_EXISTS",x[x.PERMISSION_DENIED=7]="PERMISSION_DENIED",x[x.UNAUTHENTICATED=16]="UNAUTHENTICATED",x[x.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",x[x.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",x[x.ABORTED=10]="ABORTED",x[x.OUT_OF_RANGE=11]="OUT_OF_RANGE",x[x.UNIMPLEMENTED=12]="UNIMPLEMENTED",x[x.INTERNAL=13]="INTERNAL",x[x.UNAVAILABLE=14]="UNAVAILABLE",x[x.DATA_LOSS=15]="DATA_LOSS";var ic=null;function hd(){return new TextEncoder}var dd=new zt([4294967295,4294967295],0);function oc(e){let t=hd().encode(e),n=new $u;return n.update(t),new Uint8Array(n.digest())}function ac(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),s=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new zt([n,r],0),new zt([s,i],0)]}var Ai=class e{constructor(t,n,r){if(this.bitmap=t,this.padding=n,this.hashCount=r,n<0||n>=8)throw new Qt(`Invalid padding: ${n}`);if(r<0)throw new Qt(`Invalid hash count: ${r}`);if(t.length>0&&this.hashCount===0)throw new Qt(`Invalid hash count: ${r}`);if(t.length===0&&n!==0)throw new Qt(`Invalid padding when bitmap length is 0: ${n}`);this.Te=8*t.length-n,this.Ee=zt.fromNumber(this.Te)}de(t,n,r){let s=t.add(n.multiply(zt.fromNumber(r)));return s.compare(dd)===1&&(s=new zt([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Ee).toNumber()}Ae(t){return(this.bitmap[Math.floor(t/8)]&1<<t%8)!=0}mightContain(t){if(this.Te===0)return!1;let n=oc(t),[r,s]=ac(n);for(let i=0;i<this.hashCount;i++){let o=this.de(r,s,i);if(!this.Ae(o))return!1}return!0}static create(t,n,r){let s=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),o=new e(i,s,n);return r.forEach(a=>o.insert(a)),o}insert(t){if(this.Te===0)return;let n=oc(t),[r,s]=ac(n);for(let i=0;i<this.hashCount;i++){let o=this.de(r,s,i);this.Re(o)}}Re(t){let n=Math.floor(t/8),r=t%8;this.bitmap[n]|=1<<r}},Qt=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var wr=class e{constructor(t,n,r,s,i){this.snapshotVersion=t,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,n,r){let s=new Map;return s.set(t,yn.createSynthesizedTargetChangeForCurrentChange(t,n,r)),new e(R.min(),s,new L(V),Ct(),C())}},yn=class e{constructor(t,n,r,s,i){this.resumeToken=t,this.current=n,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,n,r){return new e(r,n,C(),C(),C())}};var ye=class{constructor(t,n,r,s){this.Ve=t,this.removedTargetIds=n,this.key=r,this.me=s}},vr=class{constructor(t,n){this.targetId=t,this.fe=n}},Ir=class{constructor(t,n,r=et.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=n,this.resumeToken=r,this.cause=s}},Er=class{constructor(){this.ge=0,this.pe=cc(),this.ye=et.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return this.ge!==0}get De(){return this.Se}Ce(t){t.approximateByteSize()>0&&(this.Se=!0,this.ye=t)}ve(){let t=C(),n=C(),r=C();return this.pe.forEach((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:n=n.add(s);break;case 1:r=r.add(s);break;default:E()}}),new yn(this.ye,this.we,t,n,r)}Fe(){this.Se=!1,this.pe=cc()}Me(t,n){this.Se=!0,this.pe=this.pe.insert(t,n)}xe(t){this.Se=!0,this.pe=this.pe.remove(t)}Oe(){this.ge+=1}Ne(){this.ge-=1,N(this.ge>=0)}Le(){this.Se=!0,this.we=!0}},Si=class{constructor(t){this.Be=t,this.ke=new Map,this.qe=Ct(),this.Qe=uc(),this.Ke=new L(V)}$e(t){for(let n of t.Ve)t.me&&t.me.isFoundDocument()?this.Ue(n,t.me):this.We(n,t.key,t.me);for(let n of t.removedTargetIds)this.We(n,t.key,t.me)}Ge(t){this.forEachTarget(t,n=>{let r=this.ze(n);switch(t.state){case 0:this.je(n)&&r.Ce(t.resumeToken);break;case 1:r.Ne(),r.be||r.Fe(),r.Ce(t.resumeToken);break;case 2:r.Ne(),r.be||this.removeTarget(n);break;case 3:this.je(n)&&(r.Le(),r.Ce(t.resumeToken));break;case 4:this.je(n)&&(this.He(n),r.Ce(t.resumeToken));break;default:E()}})}forEachTarget(t,n){t.targetIds.length>0?t.targetIds.forEach(n):this.ke.forEach((r,s)=>{this.je(s)&&n(s)})}Je(t){let n=t.targetId,r=t.fe.count,s=this.Ye(n);if(s){let i=s.target;if(gi(i))if(r===0){let o=new I(i.path);this.We(n,o,ht.newNoDocument(o,R.min()))}else N(r===1);else{let o=this.Ze(n);if(o!==r){let a=this.Xe(t),u=a?this.et(a,t,o):1;if(u!==0){this.He(n);let c=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(n,c)}ic?.tt(function(l,h,f,g,P){var S,v,b,q,K,rt;let Lt={localCacheCount:l,existenceFilterCount:h.count,databaseId:f.database,projectId:f.projectId},nt=h.unchangedNames;return nt&&(Lt.bloomFilter={applied:P===0,hashCount:(S=nt?.hashCount)!==null&&S!==void 0?S:0,bitmapLength:(q=(b=(v=nt?.bits)===null||v===void 0?void 0:v.bitmap)===null||b===void 0?void 0:b.length)!==null&&q!==void 0?q:0,padding:(rt=(K=nt?.bits)===null||K===void 0?void 0:K.padding)!==null&&rt!==void 0?rt:0,mightContain:oe=>{var Vn;return(Vn=g?.mightContain(oe))!==null&&Vn!==void 0&&Vn}}),Lt}(o,t.fe,this.Be.nt(),a,u))}}}}Xe(t){let n=t.fe.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=n,o,a;try{o=kt(r).toUint8Array()}catch(u){if(u instanceof gr)return we("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new Ai(o,s,i)}catch(u){return we(u instanceof Qt?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return a.Te===0?null:a}et(t,n,r){return n.fe.count===r-this.rt(t,n.targetId)?0:2}rt(t,n){let r=this.Be.getRemoteKeysForTarget(n),s=0;return r.forEach(i=>{let o=this.Be.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;t.mightContain(a)||(this.We(n,i,null),s++)}),s}it(t){let n=new Map;this.ke.forEach((i,o)=>{let a=this.Ye(o);if(a){if(i.current&&gi(a.target)){let u=new I(a.target.path);this.qe.get(u)!==null||this.st(o,u)||this.We(o,u,ht.newNoDocument(u,t))}i.De&&(n.set(o,i.ve()),i.Fe())}});let r=C();this.Qe.forEach((i,o)=>{let a=!0;o.forEachWhile(u=>{let c=this.Ye(u);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.qe.forEach((i,o)=>o.setReadTime(t));let s=new wr(t,n,this.Ke,this.qe,r);return this.qe=Ct(),this.Qe=uc(),this.Ke=new L(V),s}Ue(t,n){if(!this.je(t))return;let r=this.st(t,n.key)?2:0;this.ze(t).Me(n.key,r),this.qe=this.qe.insert(n.key,n),this.Qe=this.Qe.insert(n.key,this.ot(n.key).add(t))}We(t,n,r){if(!this.je(t))return;let s=this.ze(t);this.st(t,n)?s.Me(n,1):s.xe(n),this.Qe=this.Qe.insert(n,this.ot(n).delete(t)),r&&(this.qe=this.qe.insert(n,r))}removeTarget(t){this.ke.delete(t)}Ze(t){let n=this.ze(t).ve();return this.Be.getRemoteKeysForTarget(t).size+n.addedDocuments.size-n.removedDocuments.size}Oe(t){this.ze(t).Oe()}ze(t){let n=this.ke.get(t);return n||(n=new Er,this.ke.set(t,n)),n}ot(t){let n=this.Qe.get(t);return n||(n=new Z(V),this.Qe=this.Qe.insert(t,n)),n}je(t){let n=this.Ye(t)!==null;return n||y("WatchChangeAggregator","Detected inactive target",t),n}Ye(t){let n=this.ke.get(t);return n&&n.be?null:this.Be._t(t)}He(t){this.ke.set(t,new Er),this.Be.getRemoteKeysForTarget(t).forEach(n=>{this.We(t,n,null)})}st(t,n){return this.Be.getRemoteKeysForTarget(t).has(n)}};function uc(){return new L(I.comparator)}function cc(){return new L(I.comparator)}var fd={asc:"ASCENDING",desc:"DESCENDING"},md={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},gd={and:"AND",or:"OR"},Ri=class{constructor(t,n){this.databaseId=t,this.useProto3Json=n}};function Pi(e,t){return e.useProto3Json||Gr(t)?t:{value:t}}function Tr(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Wc(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function pd(e,t){return Tr(e,t.toTimestamp())}function It(e){return N(!!e),R.fromTimestamp(function(n){let r=Pt(n);return new H(r.seconds,r.nanos)}(e))}function Lo(e,t){return Ci(e,t).canonicalString()}function Ci(e,t){let n=function(s){return new F(["projects",s.projectId,"databases",s.database])}(e).child("documents");return t===void 0?n:n.child(t)}function Hc(e){let t=F.fromString(e);return N(tl(t)),t}function xi(e,t){return Lo(e.databaseId,t.path)}function Us(e,t){let n=Hc(t);if(n.get(1)!==e.databaseId.projectId)throw new _(d.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new _(d.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new I(Jc(n))}function Yc(e,t){return Lo(e.databaseId,t)}function yd(e){let t=Hc(e);return t.length===4?F.emptyPath():Jc(t)}function Vi(e){return new F(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Jc(e){return N(e.length>4&&e.get(4)==="documents"),e.popFirst(5)}function lc(e,t,n){return{name:xi(e,t),fields:n.value.mapValue.fields}}function _d(e,t){let n;if("targetChange"in t){t.targetChange;let r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:E()}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],i=function(c,l){return c.useProto3Json?(N(l===void 0||typeof l=="string"),et.fromBase64String(l||"")):(N(l===void 0||l instanceof Buffer||l instanceof Uint8Array),et.fromUint8Array(l||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(c){let l=c.code===void 0?d.UNKNOWN:Qc(c.code);return new _(l,c.message||"")}(o);n=new Ir(r,s,i,a||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let s=Us(e,r.document.name),i=It(r.document.updateTime),o=r.document.createTime?It(r.document.createTime):R.min(),a=new lt({mapValue:{fields:r.document.fields}}),u=ht.newFoundDocument(s,i,o,a),c=r.targetIds||[],l=r.removedTargetIds||[];n=new ye(c,l,u.key,u)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let s=Us(e,r.document),i=r.readTime?It(r.readTime):R.min(),o=ht.newNoDocument(s,i),a=r.removedTargetIds||[];n=new ye([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let s=Us(e,r.document),i=r.removedTargetIds||[];n=new ye([],i,s,null)}else{if(!("filter"in t))return E();{t.filter;let r=t.filter;r.targetId;let{count:s=0,unchangedNames:i}=r,o=new Ti(s,i),a=r.targetId;n=new vr(a,o)}}return n}function wd(e,t){let n;if(t instanceof re)n={update:lc(e,t.key,t.value)};else if(t instanceof _r)n={delete:xi(e,t.key)};else if(t instanceof xt)n={update:lc(e,t.key,t.data),updateMask:Cd(t.fieldMask)};else{if(!(t instanceof wi))return E();n={verify:xi(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(r=>function(i,o){let a=o.transform;if(a instanceof Se)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof ee)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof ne)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Re)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw E()}(0,r))),t.precondition.isNone||(n.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:pd(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:E()}(e,t.precondition)),n}function vd(e,t){return e&&e.length>0?(N(t!==void 0),e.map(n=>function(s,i){let o=s.updateTime?It(s.updateTime):It(i);return o.isEqual(R.min())&&(o=It(i)),new _i(o,s.transformResults||[])}(n,t))):[]}function Id(e,t){return{documents:[Yc(e,t.path)]}}function Ed(e,t){let n={structuredQuery:{}},r=t.path,s;t.collectionGroup!==null?(s=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Yc(e,s);let i=function(c){if(c.length!==0)return Zc(dt.create(c,"and"))}(t.filters);i&&(n.structuredQuery.where=i);let o=function(c){if(c.length!==0)return c.map(l=>function(f){return{field:me(f.field),direction:Sd(f.dir)}}(l))}(t.orderBy);o&&(n.structuredQuery.orderBy=o);let a=Pi(e,t.limit);return a!==null&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(t.endAt)),{ut:n,parent:s}}function Td(e){let t=yd(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,s=null;if(r>0){N(r===1);let l=n.from[0];l.allDescendants?s=l.collectionId:t=t.child(l.collectionId)}let i=[];n.where&&(i=function(h){let f=Xc(h);return f instanceof dt&&xc(f)?f.getFilters():[f]}(n.where));let o=[];n.orderBy&&(o=function(h){return h.map(f=>function(P){return new te(ge(P.field),function(v){switch(v){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(P.direction))}(f))}(n.orderBy));let a=null;n.limit&&(a=function(h){let f;return f=typeof h=="object"?h.value:h,Gr(f)?null:f}(n.limit));let u=null;n.startAt&&(u=function(h){let f=!!h.before,g=h.values||[];return new Te(g,f)}(n.startAt));let c=null;return n.endAt&&(c=function(h){let f=!h.before,g=h.values||[];return new Te(g,f)}(n.endAt)),Hh(t,s,o,i,a,"F",u,c)}function Ad(e,t){let n=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return E()}}(t.purpose);return n==null?null:{"goog-listen-tags":n}}function Xc(e){return e.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":let r=ge(n.unaryFilter.field);return G.create(r,"==",{doubleValue:NaN});case"IS_NULL":let s=ge(n.unaryFilter.field);return G.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let i=ge(n.unaryFilter.field);return G.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=ge(n.unaryFilter.field);return G.create(o,"!=",{nullValue:"NULL_VALUE"});default:return E()}}(e):e.fieldFilter!==void 0?function(n){return G.create(ge(n.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return E()}}(n.fieldFilter.op),n.fieldFilter.value)}(e):e.compositeFilter!==void 0?function(n){return dt.create(n.compositeFilter.filters.map(r=>Xc(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return E()}}(n.compositeFilter.op))}(e):E()}function Sd(e){return fd[e]}function Rd(e){return md[e]}function Pd(e){return gd[e]}function me(e){return{fieldPath:e.canonicalString()}}function ge(e){return it.fromServerFormat(e.fieldPath)}function Zc(e){return e instanceof G?function(n){if(n.op==="=="){if(Yu(n.value))return{unaryFilter:{field:me(n.field),op:"IS_NAN"}};if(Hu(n.value))return{unaryFilter:{field:me(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(Yu(n.value))return{unaryFilter:{field:me(n.field),op:"IS_NOT_NAN"}};if(Hu(n.value))return{unaryFilter:{field:me(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:me(n.field),op:Rd(n.op),value:n.value}}}(e):e instanceof dt?function(n){let r=n.getFilters().map(s=>Zc(s));return r.length===1?r[0]:{compositeFilter:{op:Pd(n.op),filters:r}}}(e):E()}function Cd(e){let t=[];return e.fields.forEach(n=>t.push(n.canonicalString())),{fieldPaths:t}}function tl(e){return e.length>=4&&e.get(0)==="projects"&&e.get(2)==="databases"}var _n=class e{constructor(t,n,r,s,i=R.min(),o=R.min(),a=et.EMPTY_BYTE_STRING,u=null){this.target=t,this.targetId=n,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,n){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var Di=class{constructor(t){this.ct=t}};function xd(e){let t=Td({parent:e.parent,structuredQuery:e.structuredQuery});return e.limitType==="LAST"?yi(t,t.limit,"L"):t}var Ar=class{constructor(){}Pt(t,n){this.It(t,n),n.Tt()}It(t,n){if("nullValue"in t)this.Et(n,5);else if("booleanValue"in t)this.Et(n,10),n.dt(t.booleanValue?1:0);else if("integerValue"in t)this.Et(n,15),n.dt(O(t.integerValue));else if("doubleValue"in t){let r=O(t.doubleValue);isNaN(r)?this.Et(n,13):(this.Et(n,15),mn(r)?n.dt(0):n.dt(r))}else if("timestampValue"in t){let r=t.timestampValue;this.Et(n,20),typeof r=="string"&&(r=Pt(r)),n.At(`${r.seconds||""}`),n.dt(r.nanos||0)}else if("stringValue"in t)this.Rt(t.stringValue,n),this.Vt(n);else if("bytesValue"in t)this.Et(n,30),n.ft(kt(t.bytesValue)),this.Vt(n);else if("referenceValue"in t)this.gt(t.referenceValue,n);else if("geoPointValue"in t){let r=t.geoPointValue;this.Et(n,45),n.dt(r.latitude||0),n.dt(r.longitude||0)}else"mapValue"in t?Rc(t)?this.Et(n,Number.MAX_SAFE_INTEGER):(this.yt(t.mapValue,n),this.Vt(n)):"arrayValue"in t?(this.wt(t.arrayValue,n),this.Vt(n)):E()}Rt(t,n){this.Et(n,25),this.St(t,n)}St(t,n){n.At(t)}yt(t,n){let r=t.fields||{};this.Et(n,55);for(let s of Object.keys(r))this.Rt(s,n),this.It(r[s],n)}wt(t,n){let r=t.values||[];this.Et(n,50);for(let s of r)this.It(s,n)}gt(t,n){this.Et(n,37),I.fromName(t).path.forEach(r=>{this.Et(n,60),this.St(r,n)})}Et(t,n){t.dt(n)}Vt(t){t.dt(2)}};Ar.bt=new Ar;var bi=class{constructor(){this._n=new Ni}addToCollectionParentIndex(t,n){return this._n.add(n),m.resolve()}getCollectionParents(t,n){return m.resolve(this._n.getEntries(n))}addFieldIndex(t,n){return m.resolve()}deleteFieldIndex(t,n){return m.resolve()}deleteAllFieldIndexes(t){return m.resolve()}createTargetIndexes(t,n){return m.resolve()}getDocumentsMatchingTarget(t,n){return m.resolve(null)}getIndexType(t,n){return m.resolve(0)}getFieldIndexes(t,n){return m.resolve([])}getNextCollectionGroupToUpdate(t){return m.resolve(null)}getMinOffset(t,n){return m.resolve(Xt.min())}getMinOffsetFromCollectionGroup(t,n){return m.resolve(Xt.min())}updateCollectionGroup(t,n,r){return m.resolve()}updateIndexEntries(t,n){return m.resolve()}},Ni=class{constructor(){this.index={}}add(t){let n=t.lastSegment(),r=t.popLast(),s=this.index[n]||new Z(F.comparator),i=!s.has(r);return this.index[n]=s.add(r),i}has(t){let n=t.lastSegment(),r=t.popLast(),s=this.index[n];return s&&s.has(r)}getEntries(t){return(this.index[t]||new Z(F.comparator)).toArray()}};var Yf=new Uint8Array(0);var pt=class e{constructor(t,n,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}static withCacheSize(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};pt.DEFAULT_COLLECTION_PERCENTILE=10,pt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,pt.DEFAULT=new pt(41943040,pt.DEFAULT_COLLECTION_PERCENTILE,pt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),pt.DISABLED=new pt(-1,0,0);var wn=class e{constructor(t){this.On=t}next(){return this.On+=2,this.On}static Nn(){return new e(0)}static Ln(){return new e(-1)}};var ki=class{constructor(){this.changes=new Mt(t=>t.toString(),(t,n)=>t.isEqual(n)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,n){this.assertNotApplied(),this.changes.set(t,ht.newInvalidDocument(t).setReadTime(n))}getEntry(t,n){this.assertNotApplied();let r=this.changes.get(n);return r!==void 0?m.resolve(r):this.getFromCache(t,n)}getEntries(t,n){return this.getAllFromCache(t,n)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var Fi=class{constructor(t,n){this.overlayedDocument=t,this.mutatedFields=n}};var Mi=class{constructor(t,n,r,s){this.remoteDocumentCache=t,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=s}getDocument(t,n){let r=null;return this.documentOverlayCache.getOverlay(t,n).next(s=>(r=s,this.remoteDocumentCache.getEntry(t,n))).next(s=>(r!==null&&dn(r.mutation,s,yt.empty(),H.now()),s))}getDocuments(t,n){return this.remoteDocumentCache.getEntries(t,n).next(r=>this.getLocalViewOfDocuments(t,r,C()).next(()=>r))}getLocalViewOfDocuments(t,n,r=C()){let s=Kt();return this.populateOverlays(t,s,n).next(()=>this.computeViews(t,n,s,r).next(i=>{let o=un();return i.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(t,n){let r=Kt();return this.populateOverlays(t,r,n).next(()=>this.computeViews(t,n,r,C()))}populateOverlays(t,n,r){let s=[];return r.forEach(i=>{n.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(t,s).next(i=>{i.forEach((o,a)=>{n.set(o,a)})})}computeViews(t,n,r,s){let i=Ct(),o=hn(),a=function(){return hn()}();return n.forEach((u,c)=>{let l=r.get(c.key);s.has(c.key)&&(l===void 0||l.mutation instanceof xt)?i=i.insert(c.key,c):l!==void 0?(o.set(c.key,l.mutation.getFieldMask()),dn(l.mutation,c,l.mutation.getFieldMask(),H.now())):o.set(c.key,yt.empty())}),this.recalculateAndSaveOverlays(t,i).next(u=>(u.forEach((c,l)=>o.set(c,l)),n.forEach((c,l)=>{var h;return a.set(c,new Fi(l,(h=o.get(c))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(t,n){let r=hn(),s=new L((o,a)=>o-a),i=C();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,n).next(o=>{for(let a of o)a.keys().forEach(u=>{let c=n.get(u);if(c===null)return;let l=r.get(u)||yt.empty();l=a.applyToLocalView(c,l),r.set(u,l);let h=(s.get(a.batchId)||C()).add(u);s=s.insert(a.batchId,h)})}).next(()=>{let o=[],a=s.getReverseIterator();for(;a.hasNext();){let u=a.getNext(),c=u.key,l=u.value,h=Lc();l.forEach(f=>{if(!i.has(f)){let g=jc(n.get(f),r.get(f));g!==null&&h.set(f,g),i=i.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(t,c,h))}return m.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(t,n){return this.remoteDocumentCache.getEntries(t,n).next(r=>this.recalculateAndSaveOverlays(t,r))}getDocumentsMatchingQuery(t,n,r,s){return function(o){return I.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(t,n.path):Nc(n)?this.getDocumentsMatchingCollectionGroupQuery(t,n,r,s):this.getDocumentsMatchingCollectionQuery(t,n,r,s)}getNextDocuments(t,n,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,n,r,s).next(i=>{let o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,n,r.largestBatchId,s-i.size):m.resolve(Kt()),a=-1,u=i;return o.next(c=>m.forEach(c,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),i.get(l)?m.resolve():this.remoteDocumentCache.getEntry(t,l).next(f=>{u=u.insert(l,f)}))).next(()=>this.populateOverlays(t,c,i)).next(()=>this.computeViews(t,u,c,C())).next(l=>({batchId:a,changes:Oc(l)})))})}getDocumentsMatchingDocumentQuery(t,n){return this.getDocument(t,new I(n)).next(r=>{let s=un();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(t,n,r,s){let i=n.collectionGroup,o=un();return this.indexManager.getCollectionParents(t,i).next(a=>m.forEach(a,u=>{let c=function(h,f){return new Ft(f,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(n,u.child(i));return this.getDocumentsMatchingCollectionQuery(t,c,r,s).next(l=>{l.forEach((h,f)=>{o=o.insert(h,f)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(t,n,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(t,n.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(t,n,r,i,s))).next(o=>{i.forEach((u,c)=>{let l=c.getKey();o.get(l)===null&&(o=o.insert(l,ht.newInvalidDocument(l)))});let a=un();return o.forEach((u,c)=>{let l=i.get(u);l!==void 0&&dn(l.mutation,c,yt.empty(),H.now()),zr(n,c)&&(a=a.insert(u,c))}),a})}};var Oi=class{constructor(t){this.serializer=t,this.cr=new Map,this.lr=new Map}getBundleMetadata(t,n){return m.resolve(this.cr.get(n))}saveBundleMetadata(t,n){return this.cr.set(n.id,function(s){return{id:s.id,version:s.version,createTime:It(s.createTime)}}(n)),m.resolve()}getNamedQuery(t,n){return m.resolve(this.lr.get(n))}saveNamedQuery(t,n){return this.lr.set(n.name,function(s){return{name:s.name,query:xd(s.bundledQuery),readTime:It(s.readTime)}}(n)),m.resolve()}};var Li=class{constructor(){this.overlays=new L(I.comparator),this.hr=new Map}getOverlay(t,n){return m.resolve(this.overlays.get(n))}getOverlays(t,n){let r=Kt();return m.forEach(n,s=>this.getOverlay(t,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(t,n,r){return r.forEach((s,i)=>{this.ht(t,n,i)}),m.resolve()}removeOverlaysForBatchId(t,n,r){let s=this.hr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.hr.delete(r)),m.resolve()}getOverlaysForCollection(t,n,r){let s=Kt(),i=n.length+1,o=new I(n.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let u=a.getNext().value,c=u.getKey();if(!n.isPrefixOf(c.path))break;c.path.length===i&&u.largestBatchId>r&&s.set(u.getKey(),u)}return m.resolve(s)}getOverlaysForCollectionGroup(t,n,r,s){let i=new L((c,l)=>c-l),o=this.overlays.getIterator();for(;o.hasNext();){let c=o.getNext().value;if(c.getKey().getCollectionGroup()===n&&c.largestBatchId>r){let l=i.get(c.largestBatchId);l===null&&(l=Kt(),i=i.insert(c.largestBatchId,l)),l.set(c.getKey(),c)}}let a=Kt(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,l)=>a.set(c,l)),!(a.size()>=s)););return m.resolve(a)}ht(t,n,r){let s=this.overlays.get(r.key);if(s!==null){let o=this.hr.get(s.largestBatchId).delete(r.key);this.hr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Ei(n,r));let i=this.hr.get(n);i===void 0&&(i=C(),this.hr.set(n,i)),this.hr.set(n,i.add(r.key))}};var vn=class{constructor(){this.Pr=new Z(U.Ir),this.Tr=new Z(U.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(t,n){let r=new U(t,n);this.Pr=this.Pr.add(r),this.Tr=this.Tr.add(r)}dr(t,n){t.forEach(r=>this.addReference(r,n))}removeReference(t,n){this.Ar(new U(t,n))}Rr(t,n){t.forEach(r=>this.removeReference(r,n))}Vr(t){let n=new I(new F([])),r=new U(n,t),s=new U(n,t+1),i=[];return this.Tr.forEachInRange([r,s],o=>{this.Ar(o),i.push(o.key)}),i}mr(){this.Pr.forEach(t=>this.Ar(t))}Ar(t){this.Pr=this.Pr.delete(t),this.Tr=this.Tr.delete(t)}gr(t){let n=new I(new F([])),r=new U(n,t),s=new U(n,t+1),i=C();return this.Tr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(t){let n=new U(t,0),r=this.Pr.firstAfterOrEqual(n);return r!==null&&t.isEqual(r.key)}},U=class{constructor(t,n){this.key=t,this.pr=n}static Ir(t,n){return I.comparator(t.key,n.key)||V(t.pr,n.pr)}static Er(t,n){return V(t.pr,n.pr)||I.comparator(t.key,n.key)}};var qi=class{constructor(t,n){this.indexManager=t,this.referenceDelegate=n,this.mutationQueue=[],this.yr=1,this.wr=new Z(U.Ir)}checkEmpty(t){return m.resolve(this.mutationQueue.length===0)}addMutationBatch(t,n,r,s){let i=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new vi(i,n,r,s);this.mutationQueue.push(o);for(let a of s)this.wr=this.wr.add(new U(a.key,i)),this.indexManager.addToCollectionParentIndex(t,a.key.path.popLast());return m.resolve(o)}lookupMutationBatch(t,n){return m.resolve(this.Sr(n))}getNextMutationBatchAfterBatchId(t,n){let r=n+1,s=this.br(r),i=s<0?0:s;return m.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return m.resolve(this.mutationQueue.length===0?-1:this.yr-1)}getAllMutationBatches(t){return m.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,n){let r=new U(n,0),s=new U(n,Number.POSITIVE_INFINITY),i=[];return this.wr.forEachInRange([r,s],o=>{let a=this.Sr(o.pr);i.push(a)}),m.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,n){let r=new Z(V);return n.forEach(s=>{let i=new U(s,0),o=new U(s,Number.POSITIVE_INFINITY);this.wr.forEachInRange([i,o],a=>{r=r.add(a.pr)})}),m.resolve(this.Dr(r))}getAllMutationBatchesAffectingQuery(t,n){let r=n.path,s=r.length+1,i=r;I.isDocumentKey(i)||(i=i.child(""));let o=new U(new I(i),0),a=new Z(V);return this.wr.forEachWhile(u=>{let c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(u.pr)),!0)},o),m.resolve(this.Dr(a))}Dr(t){let n=[];return t.forEach(r=>{let s=this.Sr(r);s!==null&&n.push(s)}),n}removeMutationBatch(t,n){N(this.Cr(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.wr;return m.forEach(n.mutations,s=>{let i=new U(s.key,n.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)}).next(()=>{this.wr=r})}Mn(t){}containsKey(t,n){let r=new U(n,0),s=this.wr.firstAfterOrEqual(r);return m.resolve(n.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,m.resolve()}Cr(t,n){return this.br(t)}br(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Sr(t){let n=this.br(t);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}};var Bi=class{constructor(t){this.vr=t,this.docs=function(){return new L(I.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,n){let r=n.key,s=this.docs.get(r),i=s?s.size:0,o=this.vr(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){let n=this.docs.get(t);n&&(this.docs=this.docs.remove(t),this.size-=n.size)}getEntry(t,n){let r=this.docs.get(n);return m.resolve(r?r.document.mutableCopy():ht.newInvalidDocument(n))}getEntries(t,n){let r=Ct();return n.forEach(s=>{let i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():ht.newInvalidDocument(s))}),m.resolve(r)}getDocumentsMatchingQuery(t,n,r,s){let i=Ct(),o=n.path,a=new I(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){let{key:c,value:{document:l}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Bh(qh(l),r)<=0||(s.has(l.key)||zr(n,l))&&(i=i.insert(l.key,l.mutableCopy()))}return m.resolve(i)}getAllFromCollectionGroup(t,n,r,s){E()}Fr(t,n){return m.forEach(this.docs,r=>n(r))}newChangeBuffer(t){return new Ui(this)}getSize(t){return m.resolve(this.size)}},Ui=class extends ki{constructor(t){super(),this.ar=t}applyChanges(t){let n=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?n.push(this.ar.addEntry(t,s)):this.ar.removeEntry(r)}),m.waitFor(n)}getFromCache(t,n){return this.ar.getEntry(t,n)}getAllFromCache(t,n){return this.ar.getEntries(t,n)}};var Gi=class{constructor(t){this.persistence=t,this.Mr=new Mt(n=>Fo(n),Mo),this.lastRemoteSnapshotVersion=R.min(),this.highestTargetId=0,this.Or=0,this.Nr=new vn,this.targetCount=0,this.Lr=wn.Nn()}forEachTarget(t,n){return this.Mr.forEach((r,s)=>n(s)),m.resolve()}getLastRemoteSnapshotVersion(t){return m.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return m.resolve(this.Or)}allocateTargetId(t){return this.highestTargetId=this.Lr.next(),m.resolve(this.highestTargetId)}setTargetsMetadata(t,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.Or&&(this.Or=n),m.resolve()}qn(t){this.Mr.set(t.target,t);let n=t.targetId;n>this.highestTargetId&&(this.Lr=new wn(n),this.highestTargetId=n),t.sequenceNumber>this.Or&&(this.Or=t.sequenceNumber)}addTargetData(t,n){return this.qn(n),this.targetCount+=1,m.resolve()}updateTargetData(t,n){return this.qn(n),m.resolve()}removeTargetData(t,n){return this.Mr.delete(n.target),this.Nr.Vr(n.targetId),this.targetCount-=1,m.resolve()}removeTargets(t,n,r){let s=0,i=[];return this.Mr.forEach((o,a)=>{a.sequenceNumber<=n&&r.get(a.targetId)===null&&(this.Mr.delete(o),i.push(this.removeMatchingKeysForTargetId(t,a.targetId)),s++)}),m.waitFor(i).next(()=>s)}getTargetCount(t){return m.resolve(this.targetCount)}getTargetData(t,n){let r=this.Mr.get(n)||null;return m.resolve(r)}addMatchingKeys(t,n,r){return this.Nr.dr(n,r),m.resolve()}removeMatchingKeys(t,n,r){this.Nr.Rr(n,r);let s=this.persistence.referenceDelegate,i=[];return s&&n.forEach(o=>{i.push(s.markPotentiallyOrphaned(t,o))}),m.waitFor(i)}removeMatchingKeysForTargetId(t,n){return this.Nr.Vr(n),m.resolve()}getMatchingKeysForTargetId(t,n){let r=this.Nr.gr(n);return m.resolve(r)}containsKey(t,n){return m.resolve(this.Nr.containsKey(n))}};var $i=class{constructor(t,n){this.Br={},this.overlays={},this.kr=new Ac(0),this.qr=!1,this.qr=!0,this.referenceDelegate=t(this),this.Qr=new Gi(this),this.indexManager=new bi,this.remoteDocumentCache=function(s){return new Bi(s)}(r=>this.referenceDelegate.Kr(r)),this.serializer=new Di(n),this.$r=new Oi(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let n=this.overlays[t.toKey()];return n||(n=new Li,this.overlays[t.toKey()]=n),n}getMutationQueue(t,n){let r=this.Br[t.toKey()];return r||(r=new qi(n,this.referenceDelegate),this.Br[t.toKey()]=r),r}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(t,n,r){y("MemoryPersistence","Starting transaction:",t);let s=new zi(this.kr.next());return this.referenceDelegate.Ur(),r(s).next(i=>this.referenceDelegate.Wr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Gr(t,n){return m.or(Object.values(this.Br).map(r=>()=>r.containsKey(t,n)))}},zi=class extends Zs{constructor(t){super(),this.currentSequenceNumber=t}},ji=class e{constructor(t){this.persistence=t,this.zr=new vn,this.jr=null}static Hr(t){return new e(t)}get Jr(){if(this.jr)return this.jr;throw E()}addReference(t,n,r){return this.zr.addReference(r,n),this.Jr.delete(r.toString()),m.resolve()}removeReference(t,n,r){return this.zr.removeReference(r,n),this.Jr.add(r.toString()),m.resolve()}markPotentiallyOrphaned(t,n){return this.Jr.add(n.toString()),m.resolve()}removeTarget(t,n){this.zr.Vr(n.targetId).forEach(s=>this.Jr.add(s.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,n.targetId).next(s=>{s.forEach(i=>this.Jr.add(i.toString()))}).next(()=>r.removeTargetData(t,n))}Ur(){this.jr=new Set}Wr(t){let n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return m.forEach(this.Jr,r=>{let s=I.fromPath(r);return this.Yr(t,s).next(i=>{i||n.removeEntry(s,R.min())})}).next(()=>(this.jr=null,n.apply(t)))}updateLimboDocument(t,n){return this.Yr(t,n).next(r=>{r?this.Jr.delete(n.toString()):this.Jr.add(n.toString())})}Kr(t){return 0}Yr(t,n){return m.or([()=>m.resolve(this.zr.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(t,n),()=>this.persistence.Gr(t,n)])}};var Ki=class e{constructor(t,n,r,s){this.targetId=t,this.fromCache=n,this.qi=r,this.Qi=s}static Ki(t,n){let r=C(),s=C();for(let i of n.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new e(t,n.fromCache,r,s)}};var Qi=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var Wi=class{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){return oa()?8:fr.v(Fe())>0?6:4}()}initialize(t,n){this.zi=t,this.indexManager=n,this.$i=!0}getDocumentsMatchingQuery(t,n,r,s){let i={result:null};return this.ji(t,n).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.Hi(t,n,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;let o=new Qi;return this.Ji(t,n,o).next(a=>{if(i.result=a,this.Ui)return this.Yi(t,n,o,a.size)})}).next(()=>i.result)}Yi(t,n,r,s){return r.documentReadCount<this.Wi?(an()<=At.DEBUG&&y("QueryEngine","SDK will not create cache indexes for query:",fe(n),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),m.resolve()):(an()<=At.DEBUG&&y("QueryEngine","Query:",fe(n),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Gi*s?(an()<=At.DEBUG&&y("QueryEngine","The SDK decides to create cache indexes for query:",fe(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,vt(n))):m.resolve())}ji(t,n){if(tc(n))return m.resolve(null);let r=vt(n);return this.indexManager.getIndexType(t,r).next(s=>s===0?null:(n.limit!==null&&s===1&&(n=yi(n,null,"F"),r=vt(n)),this.indexManager.getDocumentsMatchingTarget(t,r).next(i=>{let o=C(...i);return this.zi.getDocuments(t,o).next(a=>this.indexManager.getMinOffset(t,r).next(u=>{let c=this.Zi(n,a);return this.Xi(n,c,o,u.readTime)?this.ji(t,yi(n,null,"F")):this.es(t,c,n,u)}))})))}Hi(t,n,r,s){return tc(n)||s.isEqual(R.min())?m.resolve(null):this.zi.getDocuments(t,r).next(i=>{let o=this.Zi(n,i);return this.Xi(n,o,r,s)?m.resolve(null):(an()<=At.DEBUG&&y("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),fe(n)),this.es(t,o,n,Lh(s,-1)).next(a=>a))})}Zi(t,n){let r=new Z(Fc(t));return n.forEach((s,i)=>{zr(t,i)&&(r=r.add(i))}),r}Xi(t,n,r,s){if(t.limit===null)return!1;if(r.size!==n.size)return!0;let i=t.limitType==="F"?n.last():n.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ji(t,n,r){return an()<=At.DEBUG&&y("QueryEngine","Using full collection scan to execute query:",fe(n)),this.zi.getDocumentsMatchingQuery(t,n,Xt.min(),r)}es(t,n,r,s){return this.zi.getDocumentsMatchingQuery(t,r,s).next(i=>(n.forEach(o=>{i=i.insert(o.key,o)}),i))}};var Hi=class{constructor(t,n,r,s){this.persistence=t,this.ts=n,this.serializer=s,this.ns=new L(V),this.rs=new Mt(i=>Fo(i),Mo),this.ss=new Map,this.os=t.getRemoteDocumentCache(),this.Qr=t.getTargetCache(),this.$r=t.getBundleCache(),this._s(r)}_s(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Mi(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>t.collect(n,this.ns))}};function Vd(e,t,n,r){return new Hi(e,t,n,r)}function el(e,t){return w(this,null,function*(){let n=A(e);return yield n.persistence.runTransaction("Handle user change","readonly",r=>{let s;return n.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,n._s(t),n.mutationQueue.getAllMutationBatches(r))).next(i=>{let o=[],a=[],u=C();for(let c of s){o.push(c.batchId);for(let l of c.mutations)u=u.add(l.key)}for(let c of i){a.push(c.batchId);for(let l of c.mutations)u=u.add(l.key)}return n.localDocuments.getDocuments(r,u).next(c=>({us:c,removedBatchIds:o,addedBatchIds:a}))})})})}function Dd(e,t){let n=A(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let s=t.batch.keys(),i=n.os.newChangeBuffer({trackRemovals:!0});return function(a,u,c,l){let h=c.batch,f=h.keys(),g=m.resolve();return f.forEach(P=>{g=g.next(()=>l.getEntry(u,P)).next(S=>{let v=c.docVersions.get(P);N(v!==null),S.version.compareTo(v)<0&&(h.applyToRemoteDocument(S,c),S.isValidDocument()&&(S.setReadTime(c.commitVersion),l.addEntry(S)))})}),g.next(()=>a.mutationQueue.removeMutationBatch(u,h))}(n,r,t,i).next(()=>i.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,s,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=C();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(t))).next(()=>n.localDocuments.getDocuments(r,s))})}function nl(e){let t=A(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",n=>t.Qr.getLastRemoteSnapshotVersion(n))}function bd(e,t){let n=A(e),r=t.snapshotVersion,s=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{let o=n.os.newChangeBuffer({trackRemovals:!0});s=n.ns;let a=[];t.targetChanges.forEach((l,h)=>{let f=s.get(h);if(!f)return;a.push(n.Qr.removeMatchingKeys(i,l.removedDocuments,h).next(()=>n.Qr.addMatchingKeys(i,l.addedDocuments,h)));let g=f.withSequenceNumber(i.currentSequenceNumber);t.targetMismatches.get(h)!==null?g=g.withResumeToken(et.EMPTY_BYTE_STRING,R.min()).withLastLimboFreeSnapshotVersion(R.min()):l.resumeToken.approximateByteSize()>0&&(g=g.withResumeToken(l.resumeToken,r)),s=s.insert(h,g),function(S,v,b){return S.resumeToken.approximateByteSize()===0||v.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=3e8?!0:b.addedDocuments.size+b.modifiedDocuments.size+b.removedDocuments.size>0}(f,g,l)&&a.push(n.Qr.updateTargetData(i,g))});let u=Ct(),c=C();if(t.documentUpdates.forEach(l=>{t.resolvedLimboDocuments.has(l)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(i,l))}),a.push(Nd(i,o,t.documentUpdates).next(l=>{u=l.cs,c=l.ls})),!r.isEqual(R.min())){let l=n.Qr.getLastRemoteSnapshotVersion(i).next(h=>n.Qr.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(l)}return m.waitFor(a).next(()=>o.apply(i)).next(()=>n.localDocuments.getLocalViewOfDocuments(i,u,c)).next(()=>u)}).then(i=>(n.ns=s,i))}function Nd(e,t,n){let r=C(),s=C();return n.forEach(i=>r=r.add(i)),t.getEntries(e,r).next(i=>{let o=Ct();return n.forEach((a,u)=>{let c=i.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),u.isNoDocument()&&u.version.isEqual(R.min())?(t.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||u.version.compareTo(c.version)===0&&c.hasPendingWrites?(t.addEntry(u),o=o.insert(a,u)):y("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{cs:o,ls:s}})}function kd(e,t){let n=A(e);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(t===void 0&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}function Fd(e,t){let n=A(e);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return n.Qr.getTargetData(r,t).next(i=>i?(s=i,m.resolve(s)):n.Qr.allocateTargetId(r).next(o=>(s=new _n(t,o,"TargetPurposeListen",r.currentSequenceNumber),n.Qr.addTargetData(r,s).next(()=>s))))}).then(r=>{let s=n.ns.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.ns=n.ns.insert(r.targetId,r),n.rs.set(t,r.targetId)),r})}function Yi(e,t,n){return w(this,null,function*(){let r=A(e),s=r.ns.get(t),i=n?"readwrite":"readwrite-primary";try{n||(yield r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s)))}catch(o){if(!Rn(o))throw o;y("LocalStore",`Failed to update sequence numbers for target ${t}: ${o}`)}r.ns=r.ns.remove(t),r.rs.delete(s.target)})}function hc(e,t,n){let r=A(e),s=R.min(),i=C();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,c,l){let h=A(u),f=h.rs.get(l);return f!==void 0?m.resolve(h.ns.get(f)):h.Qr.getTargetData(c,l)}(r,o,vt(t)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(o,a.targetId).next(u=>{i=u})}).next(()=>r.ts.getDocumentsMatchingQuery(o,t,n?s:R.min(),n?i:C())).next(a=>(Md(r,Jh(t),a),{documents:a,hs:i})))}function Md(e,t,n){let r=e.ss.get(t)||R.min();n.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),e.ss.set(t,r)}var Sr=class{constructor(){this.activeTargetIds=rd()}As(t){this.activeTargetIds=this.activeTargetIds.add(t)}Rs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ds(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}};var Ji=class{constructor(){this.no=new Sr,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,n,r){}addLocalQueryTarget(t){return this.no.As(t),this.ro[t]||"not-current"}updateQueryState(t,n,r){this.ro[t]=n}removeLocalQueryTarget(t){this.no.Rs(t)}isLocalQueryTarget(t){return this.no.activeTargetIds.has(t)}clearQueryState(t){delete this.ro[t]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(t){return this.no.activeTargetIds.has(t)}start(){return this.no=new Sr,Promise.resolve()}handleUserChange(t,n,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var Xi=class{io(t){}shutdown(){}};var Rr=class{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(t){this.uo.push(t)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){y("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let t of this.uo)t(0)}ao(){y("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let t of this.uo)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var ar=null;function Gs(){return ar===null?ar=function(){return 268435456+Math.round(2147483648*Math.random())}():ar++,"0x"+ar.toString(16)}var Od={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var Zi=class{constructor(t){this.lo=t.lo,this.ho=t.ho}Po(t){this.Io=t}To(t){this.Eo=t}onMessage(t){this.Ao=t}close(){this.ho()}send(t){this.lo(t)}Ro(){this.Io()}Vo(t){this.Eo(t)}mo(t){this.Ao(t)}};var X="WebChannelConnection",to=class extends class{constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;let r=n.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.fo=r+"://"+n.host,this.po=`projects/${s}/databases/${i}`,this.yo=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get wo(){return!1}So(n,r,s,i,o){let a=Gs(),u=this.bo(n,r.toUriEncodedString());y("RestConnection",`Sending RPC '${n}' ${a}:`,u,s);let c={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(c,i,o),this.Co(n,u,c,s).then(l=>(y("RestConnection",`Received RPC '${n}' ${a}: `,l),l),l=>{throw we("RestConnection",`RPC '${n}' ${a} failed with error: `,l,"url: ",u,"request:",s),l})}vo(n,r,s,i,o,a){return this.So(n,r,s,i,o)}Do(n,r,s){n["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+De}(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((i,o)=>n[o]=i),s&&s.headers.forEach((i,o)=>n[o]=i)}bo(n,r){let s=Od[n];return`${this.fo}/v1/${r}:${s}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Co(t,n,r,s){let i=Gs();return new Promise((o,a)=>{let u=new Gu;u.setWithCredentials(!0),u.listenOnce(Bu.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case ir.NO_ERROR:let l=u.getResponseJson();y(X,`XHR for RPC '${t}' ${i} received:`,JSON.stringify(l)),o(l);break;case ir.TIMEOUT:y(X,`RPC '${t}' ${i} timed out`),a(new _(d.DEADLINE_EXCEEDED,"Request time out"));break;case ir.HTTP_ERROR:let h=u.getStatus();if(y(X,`RPC '${t}' ${i} failed with status:`,h,"response text:",u.getResponseText()),h>0){let f=u.getResponseJson();Array.isArray(f)&&(f=f[0]);let g=f?.error;if(g&&g.status&&g.message){let P=function(v){let b=v.toLowerCase().replace(/_/g,"-");return Object.values(d).indexOf(b)>=0?b:d.UNKNOWN}(g.status);a(new _(P,g.message))}else a(new _(d.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new _(d.UNAVAILABLE,"Connection failed."));break;default:E()}}finally{y(X,`RPC '${t}' ${i} completed.`)}});let c=JSON.stringify(s);y(X,`RPC '${t}' ${i} sending request:`,s),u.send(n,"POST",c,r,15)})}Fo(t,n,r){let s=Gs(),i=[this.fo,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=Lu(),a=qu(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Do(u.initMessageHeaders,n,r),u.encodeInitMessageHeaders=!0;let l=i.join("");y(X,`Creating RPC '${t}' stream ${s}: ${l}`,u);let h=o.createWebChannel(l,u),f=!1,g=!1,P=new Zi({lo:v=>{g?y(X,`Not sending because RPC '${t}' stream ${s} is closed:`,v):(f||(y(X,`Opening RPC '${t}' stream ${s} transport.`),h.open(),f=!0),y(X,`RPC '${t}' stream ${s} sending:`,v),h.send(v))},ho:()=>h.close()}),S=(v,b,q)=>{v.listen(b,K=>{try{q(K)}catch(rt){setTimeout(()=>{throw rt},0)}})};return S(h,on.EventType.OPEN,()=>{g||y(X,`RPC '${t}' stream ${s} transport opened.`)}),S(h,on.EventType.CLOSE,()=>{g||(g=!0,y(X,`RPC '${t}' stream ${s} transport closed`),P.Vo())}),S(h,on.EventType.ERROR,v=>{g||(g=!0,we(X,`RPC '${t}' stream ${s} transport errored:`,v),P.Vo(new _(d.UNAVAILABLE,"The operation could not be completed")))}),S(h,on.EventType.MESSAGE,v=>{var b;if(!g){let q=v.data[0];N(!!q);let K=q,rt=K.error||((b=K[0])===null||b===void 0?void 0:b.error);if(rt){y(X,`RPC '${t}' stream ${s} received error:`,rt);let Lt=rt.status,nt=function(ql){let Jo=B[ql];if(Jo!==void 0)return Qc(Jo)}(Lt),oe=rt.message;nt===void 0&&(nt=d.INTERNAL,oe="Unknown error status: "+Lt+" with message "+rt.message),g=!0,P.Vo(new _(nt,oe)),h.close()}else y(X,`RPC '${t}' stream ${s} received:`,q),P.mo(q)}}),S(a,Uu.STAT_EVENT,v=>{v.stat===Bs.PROXY?y(X,`RPC '${t}' stream ${s} detected buffering proxy`):v.stat===Bs.NOPROXY&&y(X,`RPC '${t}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{P.Ro()},0),P}};function $s(){return typeof document<"u"?document:null}function jr(e){return new Ri(e,!0)}var Pr=class{constructor(t,n,r=1e3,s=1.5,i=6e4){this.oi=t,this.timerId=n,this.Mo=r,this.xo=s,this.Oo=i,this.No=0,this.Lo=null,this.Bo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(t){this.cancel();let n=Math.floor(this.No+this.Qo()),r=Math.max(0,Date.now()-this.Bo),s=Math.max(0,n-r);s>0&&y("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.No} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.Lo=this.oi.enqueueAfterDelay(this.timerId,s,()=>(this.Bo=Date.now(),t())),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){this.Lo!==null&&(this.Lo.skipDelay(),this.Lo=null)}cancel(){this.Lo!==null&&(this.Lo.cancel(),this.Lo=null)}Qo(){return(Math.random()-.5)*this.No}};var Cr=class{constructor(t,n,r,s,i,o,a,u){this.oi=t,this.$o=r,this.Uo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new Pr(t,n)}Ho(){return this.state===1||this.state===5||this.Jo()}Jo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Yo()}stop(){return w(this,null,function*(){this.Ho()&&(yield this.close(0))})}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&this.Go===null&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,()=>this.e_()))}t_(t){this.n_(),this.stream.send(t)}e_(){return w(this,null,function*(){if(this.Jo())return this.close(0)})}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}close(t,n){return w(this,null,function*(){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,t!==4?this.jo.reset():n&&n.code===d.RESOURCE_EXHAUSTED?(Et(n.toString()),Et("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):n&&n.code===d.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.i_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.To(n)})}i_(){}auth(){this.state=1;let t=this.s_(this.Wo),n=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Wo===n&&this.o_(r,s)},r=>{t(()=>{let s=new _(d.UNKNOWN,"Fetching auth token failed: "+r.message);return this.__(s)})})}o_(t,n){let r=this.s_(this.Wo);this.stream=this.a_(t,n),this.stream.Po(()=>{r(()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,()=>(this.Jo()&&(this.state=3),Promise.resolve())),this.listener.Po()))}),this.stream.To(s=>{r(()=>this.__(s))}),this.stream.onMessage(s=>{r(()=>this.onMessage(s))})}Yo(){this.state=5,this.jo.qo(()=>w(this,null,function*(){this.state=0,this.start()}))}__(t){return y("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}s_(t){return n=>{this.oi.enqueueAndForget(()=>this.Wo===t?n():(y("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},eo=class extends Cr{constructor(t,n,r,s,i,o){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,s,o),this.serializer=i}a_(t,n){return this.connection.Fo("Listen",t,n)}onMessage(t){this.jo.reset();let n=_d(this.serializer,t),r=function(i){if(!("targetChange"in i))return R.min();let o=i.targetChange;return o.targetIds&&o.targetIds.length?R.min():o.readTime?It(o.readTime):R.min()}(t);return this.listener.u_(n,r)}c_(t){let n={};n.database=Vi(this.serializer),n.addTarget=function(i,o){let a,u=o.target;if(a=gi(u)?{documents:Id(i,u)}:{query:Ed(i,u).ut},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=Wc(i,o.resumeToken);let c=Pi(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(R.min())>0){a.readTime=Tr(i,o.snapshotVersion.toTimestamp());let c=Pi(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,t);let r=Ad(this.serializer,t);r&&(n.labels=r),this.t_(n)}l_(t){let n={};n.database=Vi(this.serializer),n.removeTarget=t,this.t_(n)}},no=class extends Cr{constructor(t,n,r,s,i,o){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,s,o),this.serializer=i,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(t,n){return this.connection.Fo("Write",t,n)}onMessage(t){if(N(!!t.streamToken),this.lastStreamToken=t.streamToken,this.h_){this.jo.reset();let n=vd(t.writeResults,t.commitTime),r=It(t.commitTime);return this.listener.T_(r,n)}return N(!t.writeResults||t.writeResults.length===0),this.h_=!0,this.listener.E_()}d_(){let t={};t.database=Vi(this.serializer),this.t_(t)}I_(t){let n={streamToken:this.lastStreamToken,writes:t.map(r=>wd(this.serializer,r))};this.t_(n)}};var ro=class extends class{}{constructor(t,n,r,s){super(),this.authCredentials=t,this.appCheckCredentials=n,this.connection=r,this.serializer=s,this.A_=!1}R_(){if(this.A_)throw new _(d.FAILED_PRECONDITION,"The client has already been terminated.")}So(t,n,r,s){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.So(t,Ci(n,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===d.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new _(d.UNKNOWN,i.toString())})}vo(t,n,r,s,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.vo(t,Ci(n,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===d.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new _(d.UNKNOWN,o.toString())})}terminate(){this.A_=!0,this.connection.terminate()}};var so=class{constructor(t,n){this.asyncQueue=t,this.onlineStateHandler=n,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){this.m_===0&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve())))}S_(t){this.state==="Online"?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.y_("Offline")))}set(t){this.b_(),this.m_=0,t==="Online"&&(this.g_=!1),this.y_(t)}y_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}w_(t){let n=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(Et(n),this.g_=!1):y("OnlineStateTracker",n)}b_(){this.f_!==null&&(this.f_.cancel(),this.f_=null)}};var io=class{constructor(t,n,r,s,i){this.localStore=t,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=i,this.M_.io(o=>{r.enqueueAndForget(()=>w(this,null,function*(){ie(this)&&(y("RemoteStore","Restarting streams for network reachability change."),yield function(u){return w(this,null,function*(){let c=A(u);c.v_.add(4),yield Pn(c),c.x_.set("Unknown"),c.v_.delete(4),yield Kr(c)})}(this))}))}),this.x_=new so(r,s)}};function Kr(e){return w(this,null,function*(){if(ie(e))for(let t of e.F_)yield t(!0)})}function Pn(e){return w(this,null,function*(){for(let t of e.F_)yield t(!1)})}function rl(e,t){let n=A(e);n.C_.has(t.targetId)||(n.C_.set(t.targetId,t),Go(n)?Uo(n):Ne(n).Jo()&&Bo(n,t))}function qo(e,t){let n=A(e),r=Ne(n);n.C_.delete(t),r.Jo()&&sl(n,t),n.C_.size===0&&(r.Jo()?r.Xo():ie(n)&&n.x_.set("Unknown"))}function Bo(e,t){if(e.O_.Oe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(R.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Ne(e).c_(t)}function sl(e,t){e.O_.Oe(t),Ne(e).l_(t)}function Uo(e){e.O_=new Si({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),_t:t=>e.C_.get(t)||null,nt:()=>e.datastore.serializer.databaseId}),Ne(e).start(),e.x_.p_()}function Go(e){return ie(e)&&!Ne(e).Ho()&&e.C_.size>0}function ie(e){return A(e).v_.size===0}function il(e){e.O_=void 0}function Ld(e){return w(this,null,function*(){e.C_.forEach((t,n)=>{Bo(e,t)})})}function qd(e,t){return w(this,null,function*(){il(e),Go(e)?(e.x_.S_(t),Uo(e)):e.x_.set("Unknown")})}function Bd(e,t,n){return w(this,null,function*(){if(e.x_.set("Online"),t instanceof Ir&&t.state===2&&t.cause)try{yield function(s,i){return w(this,null,function*(){let o=i.cause;for(let a of i.targetIds)s.C_.has(a)&&(yield s.remoteSyncer.rejectListen(a,o),s.C_.delete(a),s.O_.removeTarget(a))})}(e,t)}catch(r){y("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),r),yield xr(e,r)}else if(t instanceof ye?e.O_.$e(t):t instanceof vr?e.O_.Je(t):e.O_.Ge(t),!n.isEqual(R.min()))try{let r=yield nl(e.localStore);n.compareTo(r)>=0&&(yield function(i,o){let a=i.O_.it(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){let l=i.C_.get(c);l&&i.C_.set(c,l.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{let l=i.C_.get(u);if(!l)return;i.C_.set(u,l.withResumeToken(et.EMPTY_BYTE_STRING,l.snapshotVersion)),sl(i,u);let h=new _n(l.target,u,c,l.sequenceNumber);Bo(i,h)}),i.remoteSyncer.applyRemoteEvent(a)}(e,n))}catch(r){y("RemoteStore","Failed to raise snapshot:",r),yield xr(e,r)}})}function xr(e,t,n){return w(this,null,function*(){if(!Rn(t))throw t;e.v_.add(1),yield Pn(e),e.x_.set("Offline"),n||(n=()=>nl(e.localStore)),e.asyncQueue.enqueueRetryable(()=>w(this,null,function*(){y("RemoteStore","Retrying IndexedDB access"),yield n(),e.v_.delete(1),yield Kr(e)}))})}function ol(e,t){return t().catch(n=>xr(e,n,t))}function Qr(e){return w(this,null,function*(){let t=A(e),n=Ot(t),r=t.D_.length>0?t.D_[t.D_.length-1].batchId:-1;for(;Ud(t);)try{let s=yield kd(t.localStore,r);if(s===null){t.D_.length===0&&n.Xo();break}r=s.batchId,Gd(t,s)}catch(s){yield xr(t,s)}al(t)&&ul(t)})}function Ud(e){return ie(e)&&e.D_.length<10}function Gd(e,t){e.D_.push(t);let n=Ot(e);n.Jo()&&n.P_&&n.I_(t.mutations)}function al(e){return ie(e)&&!Ot(e).Ho()&&e.D_.length>0}function ul(e){Ot(e).start()}function $d(e){return w(this,null,function*(){Ot(e).d_()})}function zd(e){return w(this,null,function*(){let t=Ot(e);for(let n of e.D_)t.I_(n.mutations)})}function jd(e,t,n){return w(this,null,function*(){let r=e.D_.shift(),s=Ii.from(r,t,n);yield ol(e,()=>e.remoteSyncer.applySuccessfulWrite(s)),yield Qr(e)})}function Kd(e,t){return w(this,null,function*(){t&&Ot(e).P_&&(yield function(r,s){return w(this,null,function*(){if(function(o){return ld(o)&&o!==d.ABORTED}(s.code)){let i=r.D_.shift();Ot(r).Zo(),yield ol(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),yield Qr(r)}})}(e,t)),al(e)&&ul(e)})}function dc(e,t){return w(this,null,function*(){let n=A(e);n.asyncQueue.verifyOperationInProgress(),y("RemoteStore","RemoteStore received new credentials");let r=ie(n);n.v_.add(3),yield Pn(n),r&&n.x_.set("Unknown"),yield n.remoteSyncer.handleCredentialChange(t),n.v_.delete(3),yield Kr(n)})}function Qd(e,t){return w(this,null,function*(){let n=A(e);t?(n.v_.delete(2),yield Kr(n)):t||(n.v_.add(2),yield Pn(n),n.x_.set("Unknown"))})}function Ne(e){return e.N_||(e.N_=function(n,r,s){let i=A(n);return i.R_(),new eo(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(e.datastore,e.asyncQueue,{Po:Ld.bind(null,e),To:qd.bind(null,e),u_:Bd.bind(null,e)}),e.F_.push(t=>w(this,null,function*(){t?(e.N_.Zo(),Go(e)?Uo(e):e.x_.set("Unknown")):(yield e.N_.stop(),il(e))}))),e.N_}function Ot(e){return e.L_||(e.L_=function(n,r,s){let i=A(n);return i.R_(),new no(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(e.datastore,e.asyncQueue,{Po:$d.bind(null,e),To:Kd.bind(null,e),E_:zd.bind(null,e),T_:jd.bind(null,e)}),e.F_.push(t=>w(this,null,function*(){t?(e.L_.Zo(),yield Qr(e)):(yield e.L_.stop(),e.D_.length>0&&(y("RemoteStore",`Stopping write stream with ${e.D_.length} pending writes`),e.D_=[]))}))),e.L_}var oo=class e{constructor(t,n,r,s,i){this.asyncQueue=t,this.timerId=n,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new _t,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,n,r,s,i){let o=Date.now()+r,a=new e(t,n,o,s,i);return a.start(r),a}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new _(d.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function $o(e,t){if(Et("AsyncQueue",`${t}: ${e}`),Rn(e))return new _(d.UNAVAILABLE,`${t}: ${e}`);throw e}var Vr=class e{constructor(t){this.comparator=t?(n,r)=>t(n,r)||I.comparator(n.key,r.key):(n,r)=>I.comparator(n.key,r.key),this.keyedMap=un(),this.sortedSet=new L(this.comparator)}static emptySet(t){return new e(t.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let n=this.keyedMap.get(t);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((n,r)=>(t(n),!1))}add(t){let n=this.delete(t.key);return n.copy(n.keyedMap.insert(t.key,t),n.sortedSet.insert(t,null))}delete(t){let n=this.get(t);return n?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(n)):this}isEqual(t){if(!(t instanceof e)||this.size!==t.size)return!1;let n=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;n.hasNext();){let s=n.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){let t=[];return this.forEach(n=>{t.push(n.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,n){let r=new e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=n,r}};var Dr=class{constructor(){this.B_=new L(I.comparator)}track(t){let n=t.doc.key,r=this.B_.get(n);r?t.type!==0&&r.type===3?this.B_=this.B_.insert(n,t):t.type===3&&r.type!==1?this.B_=this.B_.insert(n,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.B_=this.B_.insert(n,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.B_=this.B_.insert(n,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.B_=this.B_.remove(n):t.type===1&&r.type===2?this.B_=this.B_.insert(n,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.B_=this.B_.insert(n,{type:2,doc:t.doc}):E():this.B_=this.B_.insert(n,t)}k_(){let t=[];return this.B_.inorderTraversal((n,r)=>{t.push(r)}),t}},Ce=class e{constructor(t,n,r,s,i,o,a,u,c){this.query=t,this.docs=n,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(t,n,r,s,i){let o=[];return n.forEach(a=>{o.push({type:0,doc:a})}),new e(t,n,Vr.emptySet(n),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&$r(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let n=this.docChanges,r=t.docChanges;if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(n[s].type!==r[s].type||!n[s].doc.isEqual(r[s].doc))return!1;return!0}};var ao=class{constructor(){this.q_=void 0,this.Q_=[]}K_(){return this.Q_.some(t=>t.U_())}},uo=class{constructor(){this.queries=new Mt(t=>kc(t),$r),this.onlineState="Unknown",this.W_=new Set}};function Wd(e,t){return w(this,null,function*(){let n=A(e),r=3,s=t.query,i=n.queries.get(s);i?!i.K_()&&t.U_()&&(r=2):(i=new ao,r=t.U_()?0:1);try{switch(r){case 0:i.q_=yield n.onListen(s,!0);break;case 1:i.q_=yield n.onListen(s,!1);break;case 2:yield n.onFirstRemoteStoreListen(s)}}catch(o){let a=$o(o,`Initialization of query '${fe(t.query)}' failed`);return void t.onError(a)}n.queries.set(s,i),i.Q_.push(t),t.G_(n.onlineState),i.q_&&t.z_(i.q_)&&zo(n)})}function Hd(e,t){return w(this,null,function*(){let n=A(e),r=t.query,s=3,i=n.queries.get(r);if(i){let o=i.Q_.indexOf(t);o>=0&&(i.Q_.splice(o,1),i.Q_.length===0?s=t.U_()?0:1:!i.K_()&&t.U_()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}})}function Yd(e,t){let n=A(e),r=!1;for(let s of t){let i=s.query,o=n.queries.get(i);if(o){for(let a of o.Q_)a.z_(s)&&(r=!0);o.q_=s}}r&&zo(n)}function Jd(e,t,n){let r=A(e),s=r.queries.get(t);if(s)for(let i of s.Q_)i.onError(n);r.queries.delete(t)}function zo(e){e.W_.forEach(t=>{t.next()})}var co,fc;(fc=co||(co={})).j_="default",fc.Cache="cache";var lo=class{constructor(t,n,r){this.query=t,this.H_=n,this.J_=!1,this.Y_=null,this.onlineState="Unknown",this.options=r||{}}z_(t){if(!this.options.includeMetadataChanges){let r=[];for(let s of t.docChanges)s.type!==3&&r.push(s);t=new Ce(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let n=!1;return this.J_?this.Z_(t)&&(this.H_.next(t),n=!0):this.X_(t,this.onlineState)&&(this.ea(t),n=!0),this.Y_=t,n}onError(t){this.H_.error(t)}G_(t){this.onlineState=t;let n=!1;return this.Y_&&!this.J_&&this.X_(this.Y_,t)&&(this.ea(this.Y_),n=!0),n}X_(t,n){if(!t.fromCache||!this.U_())return!0;let r=n!=="Offline";return(!this.options.ta||!r)&&(!t.docs.isEmpty()||t.hasCachedResults||n==="Offline")}Z_(t){if(t.docChanges.length>0)return!0;let n=this.Y_&&this.Y_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ea(t){t=Ce.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.J_=!0,this.H_.next(t)}U_(){return this.options.source!==co.Cache}};var br=class{constructor(t){this.key=t}},Nr=class{constructor(t){this.key=t}},ho=class{constructor(t,n){this.query=t,this.ua=n,this.ca=null,this.hasCachedResults=!1,this.current=!1,this.la=C(),this.mutatedKeys=C(),this.ha=Fc(t),this.Pa=new Vr(this.ha)}get Ia(){return this.ua}Ta(t,n){let r=n?n.Ea:new Dr,s=n?n.Pa:this.Pa,i=n?n.mutatedKeys:this.mutatedKeys,o=s,a=!1,u=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal((l,h)=>{let f=s.get(l),g=zr(this.query,h)?h:null,P=!!f&&this.mutatedKeys.has(f.key),S=!!g&&(g.hasLocalMutations||this.mutatedKeys.has(g.key)&&g.hasCommittedMutations),v=!1;f&&g?f.data.isEqual(g.data)?P!==S&&(r.track({type:3,doc:g}),v=!0):this.da(f,g)||(r.track({type:2,doc:g}),v=!0,(u&&this.ha(g,u)>0||c&&this.ha(g,c)<0)&&(a=!0)):!f&&g?(r.track({type:0,doc:g}),v=!0):f&&!g&&(r.track({type:1,doc:f}),v=!0,(u||c)&&(a=!0)),v&&(g?(o=o.add(g),i=S?i.add(l):i.delete(l)):(o=o.delete(l),i=i.delete(l)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let l=this.query.limitType==="F"?o.last():o.first();o=o.delete(l.key),i=i.delete(l.key),r.track({type:1,doc:l})}return{Pa:o,Ea:r,Xi:a,mutatedKeys:i}}da(t,n){return t.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(t,n,r,s){let i=this.Pa;this.Pa=t.Pa,this.mutatedKeys=t.mutatedKeys;let o=t.Ea.k_();o.sort((l,h)=>function(g,P){let S=v=>{switch(v){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return E()}};return S(g)-S(P)}(l.type,h.type)||this.ha(l.doc,h.doc)),this.Aa(r),s=s!=null&&s;let a=n&&!s?this.Ra():[],u=this.la.size===0&&this.current&&!s?1:0,c=u!==this.ca;return this.ca=u,o.length!==0||c?{snapshot:new Ce(this.query,t.Pa,i,o,t.mutatedKeys,u===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),Va:a}:{Va:a}}G_(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({Pa:this.Pa,Ea:new Dr,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{Va:[]}}ma(t){return!this.ua.has(t)&&!!this.Pa.has(t)&&!this.Pa.get(t).hasLocalMutations}Aa(t){t&&(t.addedDocuments.forEach(n=>this.ua=this.ua.add(n)),t.modifiedDocuments.forEach(n=>{}),t.removedDocuments.forEach(n=>this.ua=this.ua.delete(n)),this.current=t.current)}Ra(){if(!this.current)return[];let t=this.la;this.la=C(),this.Pa.forEach(r=>{this.ma(r.key)&&(this.la=this.la.add(r.key))});let n=[];return t.forEach(r=>{this.la.has(r)||n.push(new Nr(r))}),this.la.forEach(r=>{t.has(r)||n.push(new br(r))}),n}fa(t){this.ua=t.hs,this.la=C();let n=this.Ta(t.documents);return this.applyChanges(n,!0)}ga(){return Ce.fromInitialDocuments(this.query,this.Pa,this.mutatedKeys,this.ca===0,this.hasCachedResults)}},fo=class{constructor(t,n,r){this.query=t,this.targetId=n,this.view=r}},mo=class{constructor(t){this.key=t,this.pa=!1}},go=class{constructor(t,n,r,s,i,o){this.localStore=t,this.remoteStore=n,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.ya={},this.wa=new Mt(a=>kc(a),$r),this.Sa=new Map,this.ba=new Set,this.Da=new L(I.comparator),this.Ca=new Map,this.va=new vn,this.Fa={},this.Ma=new Map,this.xa=wn.Ln(),this.onlineState="Unknown",this.Oa=void 0}get isPrimaryClient(){return this.Oa===!0}};function Xd(e,t,n=!0){return w(this,null,function*(){let r=ml(e),s,i=r.wa.get(t);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.ga()):s=yield cl(r,t,n,!0),s})}function Zd(e,t){return w(this,null,function*(){let n=ml(e);yield cl(n,t,!0,!1)})}function cl(e,t,n,r){return w(this,null,function*(){let s=yield Fd(e.localStore,vt(t)),i=s.targetId,o=n?e.sharedClientState.addLocalQueryTarget(i):"not-current",a;return r&&(a=yield tf(e,t,i,o==="current",s.resumeToken)),e.isPrimaryClient&&n&&rl(e.remoteStore,s),a})}function tf(e,t,n,r,s){return w(this,null,function*(){e.Na=(h,f,g)=>function(S,v,b,q){return w(this,null,function*(){let K=v.view.Ta(b);K.Xi&&(K=yield hc(S.localStore,v.query,!1).then(({documents:oe})=>v.view.Ta(oe,K)));let rt=q&&q.targetChanges.get(v.targetId),Lt=q&&q.targetMismatches.get(v.targetId)!=null,nt=v.view.applyChanges(K,S.isPrimaryClient,rt,Lt);return gc(S,v.targetId,nt.Va),nt.snapshot})}(e,h,f,g);let i=yield hc(e.localStore,t,!0),o=new ho(t,i.hs),a=o.Ta(i.documents),u=yn.createSynthesizedTargetChangeForCurrentChange(n,r&&e.onlineState!=="Offline",s),c=o.applyChanges(a,e.isPrimaryClient,u);gc(e,n,c.Va);let l=new fo(t,n,o);return e.wa.set(t,l),e.Sa.has(n)?e.Sa.get(n).push(t):e.Sa.set(n,[t]),c.snapshot})}function ef(e,t,n){return w(this,null,function*(){let r=A(e),s=r.wa.get(t),i=r.Sa.get(s.targetId);if(i.length>1)return r.Sa.set(s.targetId,i.filter(o=>!$r(o,t))),void r.wa.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||(yield Yi(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),n&&qo(r.remoteStore,s.targetId),po(r,s.targetId)}).catch(Sn))):(po(r,s.targetId),yield Yi(r.localStore,s.targetId,!0))})}function nf(e,t){return w(this,null,function*(){let n=A(e),r=n.wa.get(t),s=n.Sa.get(r.targetId);n.isPrimaryClient&&s.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),qo(n.remoteStore,r.targetId))})}function rf(e,t,n){return w(this,null,function*(){let r=hf(e);try{let s=yield function(o,a){let u=A(o),c=H.now(),l=a.reduce((g,P)=>g.add(P.key),C()),h,f;return u.persistence.runTransaction("Locally write mutations","readwrite",g=>{let P=Ct(),S=C();return u.os.getEntries(g,l).next(v=>{P=v,P.forEach((b,q)=>{q.isValidDocument()||(S=S.add(b))})}).next(()=>u.localDocuments.getOverlayedDocuments(g,P)).next(v=>{h=v;let b=[];for(let q of a){let K=cd(q,h.get(q.key).overlayedDocument);K!=null&&b.push(new xt(q.key,K,Pc(K.value.mapValue),Yt.exists(!0)))}return u.mutationQueue.addMutationBatch(g,c,b,a)}).next(v=>{f=v;let b=v.applyToLocalDocumentSet(h,S);return u.documentOverlayCache.saveOverlays(g,v.batchId,b)})}).then(()=>({batchId:f.batchId,changes:Oc(h)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,u){let c=o.Fa[o.currentUser.toKey()];c||(c=new L(V)),c=c.insert(a,u),o.Fa[o.currentUser.toKey()]=c}(r,s.batchId,n),yield Cn(r,s.changes),yield Qr(r.remoteStore)}catch(s){let i=$o(s,"Failed to persist write");n.reject(i)}})}function ll(e,t){return w(this,null,function*(){let n=A(e);try{let r=yield bd(n.localStore,t);t.targetChanges.forEach((s,i)=>{let o=n.Ca.get(i);o&&(N(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.pa=!0:s.modifiedDocuments.size>0?N(o.pa):s.removedDocuments.size>0&&(N(o.pa),o.pa=!1))}),yield Cn(n,r,t)}catch(r){yield Sn(r)}})}function mc(e,t,n){let r=A(e);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){let s=[];r.wa.forEach((i,o)=>{let a=o.view.G_(t);a.snapshot&&s.push(a.snapshot)}),function(o,a){let u=A(o);u.onlineState=a;let c=!1;u.queries.forEach((l,h)=>{for(let f of h.Q_)f.G_(a)&&(c=!0)}),c&&zo(u)}(r.eventManager,t),s.length&&r.ya.u_(s),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function sf(e,t,n){return w(this,null,function*(){let r=A(e);r.sharedClientState.updateQueryState(t,"rejected",n);let s=r.Ca.get(t),i=s&&s.key;if(i){let o=new L(I.comparator);o=o.insert(i,ht.newNoDocument(i,R.min()));let a=C().add(i),u=new wr(R.min(),new Map,new L(V),o,a);yield ll(r,u),r.Da=r.Da.remove(i),r.Ca.delete(t),jo(r)}else yield Yi(r.localStore,t,!1).then(()=>po(r,t,n)).catch(Sn)})}function of(e,t){return w(this,null,function*(){let n=A(e),r=t.batch.batchId;try{let s=yield Dd(n.localStore,t);dl(n,r,null),hl(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),yield Cn(n,s)}catch(s){yield Sn(s)}})}function af(e,t,n){return w(this,null,function*(){let r=A(e);try{let s=yield function(o,a){let u=A(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let l;return u.mutationQueue.lookupMutationBatch(c,a).next(h=>(N(h!==null),l=h.keys(),u.mutationQueue.removeMutationBatch(c,h))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,l,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,l)).next(()=>u.localDocuments.getDocuments(c,l))})}(r.localStore,t);dl(r,t,n),hl(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),yield Cn(r,s)}catch(s){yield Sn(s)}})}function hl(e,t){(e.Ma.get(t)||[]).forEach(n=>{n.resolve()}),e.Ma.delete(t)}function dl(e,t,n){let r=A(e),s=r.Fa[r.currentUser.toKey()];if(s){let i=s.get(t);i&&(n?i.reject(n):i.resolve(),s=s.remove(t)),r.Fa[r.currentUser.toKey()]=s}}function po(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(let r of e.Sa.get(t))e.wa.delete(r),n&&e.ya.La(r,n);e.Sa.delete(t),e.isPrimaryClient&&e.va.Vr(t).forEach(r=>{e.va.containsKey(r)||fl(e,r)})}function fl(e,t){e.ba.delete(t.path.canonicalString());let n=e.Da.get(t);n!==null&&(qo(e.remoteStore,n),e.Da=e.Da.remove(t),e.Ca.delete(n),jo(e))}function gc(e,t,n){for(let r of n)r instanceof br?(e.va.addReference(r.key,t),uf(e,r)):r instanceof Nr?(y("SyncEngine","Document no longer in limbo: "+r.key),e.va.removeReference(r.key,t),e.va.containsKey(r.key)||fl(e,r.key)):E()}function uf(e,t){let n=t.key,r=n.path.canonicalString();e.Da.get(n)||e.ba.has(r)||(y("SyncEngine","New document in limbo: "+n),e.ba.add(r),jo(e))}function jo(e){for(;e.ba.size>0&&e.Da.size<e.maxConcurrentLimboResolutions;){let t=e.ba.values().next().value;e.ba.delete(t);let n=new I(F.fromString(t)),r=e.xa.next();e.Ca.set(r,new mo(n)),e.Da=e.Da.insert(n,r),rl(e.remoteStore,new _n(vt(Oo(n.path)),r,"TargetPurposeLimboResolution",Ac._e))}}function Cn(e,t,n){return w(this,null,function*(){let r=A(e),s=[],i=[],o=[];r.wa.isEmpty()||(r.wa.forEach((a,u)=>{o.push(r.Na(u,t,n).then(c=>{if((c||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,c?.fromCache?"not-current":"current"),c){s.push(c);let l=Ki.Ki(u.targetId,c);i.push(l)}}))}),yield Promise.all(o),r.ya.u_(s),yield function(u,c){return w(this,null,function*(){let l=A(u);try{yield l.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>m.forEach(c,f=>m.forEach(f.qi,g=>l.persistence.referenceDelegate.addReference(h,f.targetId,g)).next(()=>m.forEach(f.Qi,g=>l.persistence.referenceDelegate.removeReference(h,f.targetId,g)))))}catch(h){if(!Rn(h))throw h;y("LocalStore","Failed to update sequence numbers: "+h)}for(let h of c){let f=h.targetId;if(!h.fromCache){let g=l.ns.get(f),P=g.snapshotVersion,S=g.withLastLimboFreeSnapshotVersion(P);l.ns=l.ns.insert(f,S)}}})}(r.localStore,i))})}function cf(e,t){return w(this,null,function*(){let n=A(e);if(!n.currentUser.isEqual(t)){y("SyncEngine","User change. New user:",t.toKey());let r=yield el(n.localStore,t);n.currentUser=t,function(i,o){i.Ma.forEach(a=>{a.forEach(u=>{u.reject(new _(d.CANCELLED,o))})}),i.Ma.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),yield Cn(n,r.us)}})}function lf(e,t){let n=A(e),r=n.Ca.get(t);if(r&&r.pa)return C().add(r.key);{let s=C(),i=n.Sa.get(t);if(!i)return s;for(let o of i){let a=n.wa.get(o);s=s.unionWith(a.view.Ia)}return s}}function ml(e){let t=A(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=ll.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=lf.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=sf.bind(null,t),t.ya.u_=Yd.bind(null,t.eventManager),t.ya.La=Jd.bind(null,t.eventManager),t}function hf(e){let t=A(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=of.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=af.bind(null,t),t}var kr=class{constructor(){this.synchronizeTabs=!1}initialize(t){return w(this,null,function*(){this.serializer=jr(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),yield this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)})}createGarbageCollectionScheduler(t,n){return null}createIndexBackfillerScheduler(t,n){return null}createLocalStore(t){return Vd(this.persistence,new Wi,t.initialUser,this.serializer)}createPersistence(t){return new $i(ji.Hr,this.serializer)}createSharedClientState(t){return new Ji}terminate(){return w(this,null,function*(){var t,n;(t=this.gcScheduler)===null||t===void 0||t.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var yo=class{initialize(t,n){return w(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>mc(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=cf.bind(null,this.syncEngine),yield Qd(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new uo}()}createDatastore(t){let n=jr(t.databaseInfo.databaseId),r=function(i){return new to(i)}(t.databaseInfo);return function(i,o,a,u){return new ro(i,o,a,u)}(t.authCredentials,t.appCheckCredentials,r,n)}createRemoteStore(t){return function(r,s,i,o,a){return new io(r,s,i,o,a)}(this.localStore,this.datastore,t.asyncQueue,n=>mc(this.syncEngine,n,0),function(){return Rr.D()?new Rr:new Xi}())}createSyncEngine(t,n){return function(s,i,o,a,u,c,l){let h=new go(s,i,o,a,u,c);return l&&(h.Oa=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)}terminate(){return w(this,null,function*(){var t;yield function(r){return w(this,null,function*(){let s=A(r);y("RemoteStore","RemoteStore shutting down."),s.v_.add(5),yield Pn(s),s.M_.shutdown(),s.x_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate()})}};var _o=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.qa(this.observer.next,t)}error(t){this.observer.error?this.qa(this.observer.error,t):Et("Uncaught Error in snapshot listener:",t.toString())}Qa(){this.muted=!0}qa(t,n){this.muted||setTimeout(()=>{this.muted||t(n)},0)}};var wo=class{constructor(t,n,r,s){this.authCredentials=t,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=s,this.user=j.UNAUTHENTICATED,this.clientId=hr.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,i=>w(this,null,function*(){y("FirestoreClient","Received user=",i.uid),yield this.authCredentialListener(i),this.user=i})),this.appCheckCredentials.start(r,i=>(y("FirestoreClient","Received new app check token=",i),this.appCheckCredentialListener(i,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new _(d.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let t=new _t;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>w(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(n){let r=$o(n,"Failed to shutdown persistence");t.reject(r)}})),t.promise}};function zs(e,t){return w(this,null,function*(){e.asyncQueue.verifyOperationInProgress(),y("FirestoreClient","Initializing OfflineComponentProvider");let n=e.configuration;yield t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(s=>w(this,null,function*(){r.isEqual(s)||(yield el(t.localStore,s),r=s)})),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t})}function pc(e,t){return w(this,null,function*(){e.asyncQueue.verifyOperationInProgress();let n=yield ff(e);y("FirestoreClient","Initializing OnlineComponentProvider"),yield t.initialize(n,e.configuration),e.setCredentialChangeListener(r=>dc(t.remoteStore,r)),e.setAppCheckTokenChangeListener((r,s)=>dc(t.remoteStore,s)),e._onlineComponents=t})}function df(e){return e.name==="FirebaseError"?e.code===d.FAILED_PRECONDITION||e.code===d.UNIMPLEMENTED:!(typeof DOMException<"u"&&e instanceof DOMException)||e.code===22||e.code===20||e.code===11}function ff(e){return w(this,null,function*(){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){y("FirestoreClient","Using user provided OfflineComponentProvider");try{yield zs(e,e._uninitializedComponentsProvider._offline)}catch(t){let n=t;if(!df(n))throw n;we("Error using user provided cache. Falling back to memory cache: "+n),yield zs(e,new kr)}}else y("FirestoreClient","Using default OfflineComponentProvider"),yield zs(e,new kr);return e._offlineComponents})}function gl(e){return w(this,null,function*(){return e._onlineComponents||(e._uninitializedComponentsProvider?(y("FirestoreClient","Using user provided OnlineComponentProvider"),yield pc(e,e._uninitializedComponentsProvider._online)):(y("FirestoreClient","Using default OnlineComponentProvider"),yield pc(e,new yo))),e._onlineComponents})}function mf(e){return gl(e).then(t=>t.syncEngine)}function yc(e){return w(this,null,function*(){let t=yield gl(e),n=t.eventManager;return n.onListen=Xd.bind(null,t.syncEngine),n.onUnlisten=ef.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=Zd.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=nf.bind(null,t.syncEngine),n})}function pl(e){let t={};return e.timeoutSeconds!==void 0&&(t.timeoutSeconds=e.timeoutSeconds),t}var _c=new Map;function yl(e,t,n){if(!n)throw new _(d.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function gf(e,t,n,r){if(t===!0&&r===!0)throw new _(d.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function wc(e){if(!I.isDocumentKey(e))throw new _(d.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function vc(e){if(I.isDocumentKey(e))throw new _(d.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Wr(e){if(e===void 0)return"undefined";if(e===null)return"null";if(typeof e=="string")return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if(typeof e=="number"||typeof e=="boolean")return""+e;if(typeof e=="object"){if(e instanceof Array)return"an array";{let t=function(r){return r.constructor?r.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return typeof e=="function"?"a function":E()}function fn(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new _(d.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=Wr(e);throw new _(d.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}var Fr=class{constructor(t){var n,r;if(t.host===void 0){if(t.ssl!==void 0)throw new _(d.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(n=t.ssl)===null||n===void 0||n;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new _(d.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}gf("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=pl((r=t.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new _(d.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new _(d.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new _(d.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},xe=class{constructor(t,n,r,s){this._authCredentials=t,this._appCheckCredentials=n,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Fr({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new _(d.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(t){if(this._settingsFrozen)throw new _(d.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Fr(t),t.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new js;switch(r.type){case"firstParty":return new Hs(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new _(d.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){let r=_c.get(n);r&&(y("ComponentProvider","Removing Datastore"),_c.delete(n),r.terminate())}(this),Promise.resolve()}};function _l(e,t,n,r={}){var s;let i=(e=fn(e,xe))._getSettings(),o=`${t}:${n}`;if(i.host!=="firestore.googleapis.com"&&i.host!==o&&we("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,u;if(typeof r.mockUserToken=="string")a=r.mockUserToken,u=j.MOCK_USER;else{a=ia(r.mockUserToken,(s=e._app)===null||s===void 0?void 0:s.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new _(d.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new j(c)}e._authCredentials=new Ks(new lr(a,u))}}var se=class e{constructor(t,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new e(this.firestore,t,this._query)}},ot=class e{constructor(t,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Nt(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new e(this.firestore,t,this._key)}},Nt=class e extends se{constructor(t,n,r){super(t,n,Oo(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new ot(this.firestore,null,new I(t))}withConverter(t){return new e(this.firestore,t,this._path)}};function wl(e,t,...n){if(e=Vt(e),yl("collection","path",t),e instanceof xe){let r=F.fromString(t,...n);return vc(r),new Nt(e,null,r)}{if(!(e instanceof ot||e instanceof Nt))throw new _(d.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(F.fromString(t,...n));return vc(r),new Nt(e.firestore,null,r)}}function vl(e,t,...n){if(e=Vt(e),arguments.length===1&&(t=hr.newId()),yl("doc","path",t),e instanceof xe){let r=F.fromString(t,...n);return wc(r),new ot(e,null,new I(r))}{if(!(e instanceof ot||e instanceof Nt))throw new _(d.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(F.fromString(t,...n));return wc(r),new ot(e.firestore,e instanceof Nt?e.converter:null,new I(r))}}var vo=class{constructor(){this.nu=Promise.resolve(),this.ru=[],this.iu=!1,this.su=[],this.ou=null,this._u=!1,this.au=!1,this.uu=[],this.jo=new Pr(this,"async_queue_retry"),this.cu=()=>{let n=$s();n&&y("AsyncQueue","Visibility state changed to "+n.visibilityState),this.jo.Ko()};let t=$s();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.cu)}get isShuttingDown(){return this.iu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.lu(),this.hu(t)}enterRestrictedMode(t){if(!this.iu){this.iu=!0,this.au=t||!1;let n=$s();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.cu)}}enqueue(t){if(this.lu(),this.iu)return new Promise(()=>{});let n=new _t;return this.hu(()=>this.iu&&this.au?Promise.resolve():(t().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.ru.push(t),this.Pu()))}Pu(){return w(this,null,function*(){if(this.ru.length!==0){try{yield this.ru[0](),this.ru.shift(),this.jo.reset()}catch(t){if(!Rn(t))throw t;y("AsyncQueue","Operation failed with retryable error: "+t)}this.ru.length>0&&this.jo.qo(()=>this.Pu())}})}hu(t){let n=this.nu.then(()=>(this._u=!0,t().catch(r=>{this.ou=r,this._u=!1;let s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw Et("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this._u=!1,r))));return this.nu=n,n}enqueueAfterDelay(t,n,r){this.lu(),this.uu.indexOf(t)>-1&&(n=0);let s=oo.createAndSchedule(this,t,n,r,i=>this.Iu(i));return this.su.push(s),s}lu(){this.ou&&E()}verifyOperationInProgress(){}Tu(){return w(this,null,function*(){let t;do t=this.nu,yield t;while(t!==this.nu)})}Eu(t){for(let n of this.su)if(n.timerId===t)return!0;return!1}du(t){return this.Tu().then(()=>{this.su.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(let n of this.su)if(n.skipDelay(),t!=="all"&&n.timerId===t)break;return this.Tu()})}Au(t){this.uu.push(t)}Iu(t){let n=this.su.indexOf(t);this.su.splice(n,1)}};function Ic(e){return function(n,r){if(typeof n!="object"||n===null)return!1;let s=n;for(let i of r)if(i in s&&typeof s[i]=="function")return!0;return!1}(e,["next","error","complete"])}var Ve=class extends xe{constructor(t,n,r,s){super(t,n,r,s),this.type="firestore",this._queue=function(){return new vo}(),this._persistenceKey=s?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||Tl(this),this._firestoreClient.terminate()}};function Il(e,t){let n=typeof e=="object"?e:ma(),r=typeof e=="string"?e:t||"(default)",s=da(n,"firestore").getImmediate({identifier:r});if(!s._initialized){let i=sa("firestore");i&&_l(s,...i)}return s}function El(e){return e._firestoreClient||Tl(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Tl(e){var t,n,r;let s=e._freezeSettings(),i=function(a,u,c,l){return new ri(a,u,c,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,pl(l.experimentalLongPollingOptions),l.useFetchStreams)}(e._databaseId,((t=e._app)===null||t===void 0?void 0:t.options.appId)||"",e._persistenceKey,s);e._firestoreClient=new wo(e._authCredentials,e._appCheckCredentials,e._queue,i),!((n=s.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.localCache.kind,_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider})}var In=class e{constructor(t){this._byteString=t}static fromBase64String(t){try{return new e(et.fromBase64String(t))}catch(n){throw new _(d.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(t){return new e(et.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}};var En=class{constructor(...t){for(let n=0;n<t.length;++n)if(t[n].length===0)throw new _(d.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new it(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var Mr=class{constructor(t){this._methodName=t}};var Tn=class{constructor(t,n){if(!isFinite(t)||t<-90||t>90)throw new _(d.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(n)||n<-180||n>180)throw new _(d.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=t,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return V(this._lat,t._lat)||V(this._long,t._long)}};var pf=/^__.*__$/,Io=class{constructor(t,n,r){this.data=t,this.fieldMask=n,this.fieldTransforms=r}toMutation(t,n){return this.fieldMask!==null?new xt(t,this.data,this.fieldMask,n,this.fieldTransforms):new re(t,this.data,n,this.fieldTransforms)}};function Al(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw E()}}var Eo=class e{constructor(t,n,r,s,i,o){this.settings=t,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Ru(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Vu(){return this.settings.Vu}mu(t){return new e(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}fu(t){var n;let r=(n=this.path)===null||n===void 0?void 0:n.child(t),s=this.mu({path:r,gu:!1});return s.pu(t),s}yu(t){var n;let r=(n=this.path)===null||n===void 0?void 0:n.child(t),s=this.mu({path:r,gu:!1});return s.Ru(),s}wu(t){return this.mu({path:void 0,gu:!0})}Su(t){return Or(t,this.settings.methodName,this.settings.bu||!1,this.path,this.settings.Du)}contains(t){return this.fieldMask.find(n=>t.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>t.isPrefixOf(n.field))!==void 0}Ru(){if(this.path)for(let t=0;t<this.path.length;t++)this.pu(this.path.get(t))}pu(t){if(t.length===0)throw this.Su("Document fields must not be empty");if(Al(this.Vu)&&pf.test(t))throw this.Su('Document fields cannot begin and end with "__"')}},To=class{constructor(t,n,r){this.databaseId=t,this.ignoreUndefinedProperties=n,this.serializer=r||jr(t)}Cu(t,n,r,s=!1){return new Eo({Vu:t,methodName:n,Du:r,path:it.emptyPath(),gu:!1,bu:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Sl(e){let t=e._freezeSettings(),n=jr(e._databaseId);return new To(e._databaseId,!!t.ignoreUndefinedProperties,n)}function yf(e,t,n,r,s,i={}){let o=e.Cu(i.merge||i.mergeFields?2:0,t,n,s);Cl("Data must be an object, but it was:",o,r);let a=Rl(r,o),u,c;if(i.merge)u=new yt(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){let l=[];for(let h of i.mergeFields){let f=wf(t,h,n);if(!o.contains(f))throw new _(d.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);If(l,f)||l.push(f)}u=new yt(l),c=o.fieldTransforms.filter(h=>u.covers(h.field))}else u=null,c=o.fieldTransforms;return new Io(new lt(a),u,c)}function _f(e,t,n,r=!1){return Ko(n,e.Cu(r?4:3,t))}function Ko(e,t){if(Pl(e=Vt(e)))return Cl("Unsupported field value:",t,e),Rl(e,t);if(e instanceof Mr)return function(r,s){if(!Al(s.Vu))throw s.Su(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Su(`${r._methodName}() is not currently supported inside arrays`);let i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(e,t),null;if(e===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.gu&&t.Vu!==4)throw t.Su("Nested arrays are not supported");return function(r,s){let i=[],o=0;for(let a of r){let u=Ko(a,s.wu(o));u==null&&(u={nullValue:"NULL_VALUE"}),i.push(u),o++}return{arrayValue:{values:i}}}(e,t)}return function(r,s){if((r=Vt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return sd(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let i=H.fromDate(r);return{timestampValue:Tr(s.serializer,i)}}if(r instanceof H){let i=new H(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Tr(s.serializer,i)}}if(r instanceof Tn)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof In)return{bytesValue:Wc(s.serializer,r._byteString)};if(r instanceof ot){let i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Su(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Lo(r.firestore._databaseId||s.databaseId,r._key.path)}}throw s.Su(`Unsupported field value: ${Wr(r)}`)}(e,t)}function Rl(e,t){let n={};return Sc(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):be(e,(r,s)=>{let i=Ko(s,t.fu(r));i!=null&&(n[r]=i)}),{mapValue:{fields:n}}}function Pl(e){return!(typeof e!="object"||e===null||e instanceof Array||e instanceof Date||e instanceof H||e instanceof Tn||e instanceof In||e instanceof ot||e instanceof Mr)}function Cl(e,t,n){if(!Pl(n)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(n)){let r=Wr(n);throw r==="an object"?t.Su(e+" a custom object"):t.Su(e+" "+r)}}function wf(e,t,n){if((t=Vt(t))instanceof En)return t._internalPath;if(typeof t=="string")return xl(e,t);throw Or("Field path arguments must be of type string or ",e,!1,void 0,n)}var vf=new RegExp("[~\\*/\\[\\]]");function xl(e,t,n){if(t.search(vf)>=0)throw Or(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new En(...t.split("."))._internalPath}catch{throw Or(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Or(e,t,n,r,s){let i=r&&!r.isEmpty(),o=s!==void 0,a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(i||o)&&(u+=" (found",i&&(u+=` in field ${r}`),o&&(u+=` in document ${s}`),u+=")"),new _(d.INVALID_ARGUMENT,a+e+u)}function If(e,t){return e.some(n=>n.isEqual(t))}var Lr=class{constructor(t,n,r,s,i){this._firestore=t,this._userDataWriter=n,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new ot(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new Ao(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let n=this._document.data.field(Qo("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n)}}},Ao=class extends Lr{data(){return super.data()}};function Qo(e,t){return typeof t=="string"?xl(e,t):t instanceof En?t._internalPath:t._delegate._internalPath}function Ef(e){if(e.limitType==="L"&&e.explicitOrderBy.length===0)throw new _(d.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var An=class{},qr=class extends An{};function Vl(e,t,...n){let r=[];t instanceof An&&r.push(t),r=r.concat(n),function(i){let o=i.filter(u=>u instanceof Ro).length,a=i.filter(u=>u instanceof So).length;if(o>1||o>0&&a>0)throw new _(d.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let s of r)e=s._apply(e);return e}var So=class e extends qr{constructor(t,n,r){super(),this._field=t,this._op=n,this._value=r,this.type="where"}static _create(t,n,r){return new e(t,n,r)}_apply(t){let n=this._parse(t);return bl(t._query,n),new se(t.firestore,t.converter,pi(t._query,n))}_parse(t){let n=Sl(t.firestore);return function(i,o,a,u,c,l,h){let f;if(c.isKeyField()){if(l==="array-contains"||l==="array-contains-any")throw new _(d.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if(l==="in"||l==="not-in"){Tc(h,l);let g=[];for(let P of h)g.push(Ec(u,i,P));f={arrayValue:{values:g}}}else f=Ec(u,i,h)}else l!=="in"&&l!=="not-in"&&l!=="array-contains-any"||Tc(h,l),f=_f(a,o,h,l==="in"||l==="not-in");return G.create(c,l,f)}(t._query,"where",n,t.firestore._databaseId,this._field,this._op,this._value)}};var Ro=class e extends An{constructor(t,n){super(),this.type=t,this._queryConstraints=n}static _create(t,n){return new e(t,n)}_parse(t){let n=this._queryConstraints.map(r=>r._parse(t)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:dt.create(n,this._getOperator())}_apply(t){let n=this._parse(t);return n.getFilters().length===0?t:(function(s,i){let o=s,a=i.getFlattenedFilters();for(let u of a)bl(o,u),o=pi(o,u)}(t._query,n),new se(t.firestore,t.converter,pi(t._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Po=class e extends qr{constructor(t,n){super(),this._field=t,this._direction=n,this.type="orderBy"}static _create(t,n){return new e(t,n)}_apply(t){let n=function(s,i,o){if(s.startAt!==null)throw new _(d.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new _(d.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new te(i,o)}(t._query,this._field,this._direction);return new se(t.firestore,t.converter,function(s,i){let o=s.explicitOrderBy.concat([i]);return new Ft(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(t._query,n))}};function Dl(e,t="asc"){let n=t,r=Qo("orderBy",e);return Po._create(r,n)}function Ec(e,t,n){if(typeof(n=Vt(n))=="string"){if(n==="")throw new _(d.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Nc(t)&&n.indexOf("/")!==-1)throw new _(d.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let r=t.path.child(F.fromString(n));if(!I.isDocumentKey(r))throw new _(d.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Wu(e,new I(r))}if(n instanceof ot)return Wu(e,n._key);throw new _(d.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Wr(n)}.`)}function Tc(e,t){if(!Array.isArray(e)||e.length===0)throw new _(d.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function bl(e,t){let n=function(s,i){for(let o of s)for(let a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(e.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(n!==null)throw n===t.op?new _(d.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new _(d.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}var Co=class{convertValue(t,n="none"){switch(Zt(t)){case 0:return null;case 1:return t.booleanValue;case 2:return O(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,n);case 5:return t.stringValue;case 6:return this.convertBytes(kt(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,n);case 10:return this.convertObject(t.mapValue,n);default:throw E()}}convertObject(t,n){return this.convertObjectMap(t.fields,n)}convertObjectMap(t,n="none"){let r={};return be(t,(s,i)=>{r[s]=this.convertValue(i,n)}),r}convertGeoPoint(t){return new Tn(O(t.latitude),O(t.longitude))}convertArray(t,n){return(t.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(t,n){switch(n){case"previous":let r=No(t);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(gn(t));default:return null}}convertTimestamp(t){let n=Pt(t);return new H(n.seconds,n.nanos)}convertDocumentKey(t,n){let r=F.fromString(t);N(tl(r));let s=new pr(r.get(1),r.get(3)),i=new I(r.popFirst(5));return s.isEqual(n)||Et(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),i}};function Tf(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}var Wt=class{constructor(t,n){this.hasPendingWrites=t,this.fromCache=n}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},Br=class extends Lr{constructor(t,n,r,s,i,o){super(t,n,r,s,o),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let n=new _e(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,n={}){if(this._document){let r=this._document.data.field(Qo("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}},_e=class extends Br{data(t={}){return super.data(t)}},xo=class{constructor(t,n,r,s){this._firestore=t,this._userDataWriter=n,this._snapshot=s,this.metadata=new Wt(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){let t=[];return this.forEach(n=>t.push(n)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,n){this._snapshot.docs.forEach(r=>{t.call(n,new _e(this._firestore,this._userDataWriter,r.key,r,new Wt(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let n=!!t.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new _(d.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{let u=new _e(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Wt(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{let u=new _e(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Wt(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter),c=-1,l=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:Af(a.type),doc:u,oldIndex:c,newIndex:l}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}};function Af(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return E()}}var Ur=class extends Co{constructor(t){super(),this.firestore=t}convertBytes(t){return new In(t)}convertReference(t){let n=this.convertDocumentKey(t,this.firestore._databaseId);return new ot(this.firestore,null,n)}};function Nl(e,t){let n=fn(e.firestore,Ve),r=vl(e),s=Tf(e.converter,t);return Sf(n,[yf(Sl(e.firestore),"addDoc",r._key,s,e.converter!==null,{}).toMutation(r._key,Yt.exists(!1))]).then(()=>r)}function Wo(e,...t){var n,r,s;e=Vt(e);let i={includeMetadataChanges:!1,source:"default"},o=0;typeof t[o]!="object"||Ic(t[o])||(i=t[o],o++);let a={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Ic(t[o])){let h=t[o];t[o]=(n=h.next)===null||n===void 0?void 0:n.bind(h),t[o+1]=(r=h.error)===null||r===void 0?void 0:r.bind(h),t[o+2]=(s=h.complete)===null||s===void 0?void 0:s.bind(h)}let u,c,l;if(e instanceof ot)c=fn(e.firestore,Ve),l=Oo(e._key.path),u={next:h=>{t[o]&&t[o](Rf(c,e,h))},error:t[o+1],complete:t[o+2]};else{let h=fn(e,se);c=fn(h.firestore,Ve),l=h._query;let f=new Ur(c);u={next:g=>{t[o]&&t[o](new xo(c,f,h,g))},error:t[o+1],complete:t[o+2]},Ef(e._query)}return function(f,g,P,S){let v=new _o(S),b=new lo(g,v,P);return f.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){return Wd(yield yc(f),b)})),()=>{v.Qa(),f.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){return Hd(yield yc(f),b)}))}}(El(c),l,a,u)}function Sf(e,t){return function(r,s){let i=new _t;return r.asyncQueue.enqueueAndForget(()=>w(this,null,function*(){return rf(yield mf(r),s,i)})),i.promise}(El(e),t)}function Rf(e,t,n){let r=n.docs.get(t._key),s=new Ur(e);return new Br(e,s,t._key,r,new Wt(n.hasPendingWrites,n.fromCache),t.converter)}(function(t,n=!0){(function(s){De=s})(fa),ha(new ca("firestore",(r,{instanceIdentifier:s,options:i})=>{let o=r.getProvider("app").getImmediate(),a=new Ve(new Qs(r.getProvider("auth-internal")),new Js(r.getProvider("app-check-internal")),function(c,l){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new _(d.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new pr(c.options.projectId,l)}(o,s),o);return i=Object.assign({useFetchStreams:n},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Me(zu,"4.6.0",t),Me(zu,"4.6.0","esm2017")})();var Hr=function(){return Hr=Object.assign||function(t){for(var n,r=1,s=arguments.length;r<s;r++){n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},Hr.apply(this,arguments)};var xf={includeMetadataChanges:!1};function kl(e,t){return t===void 0&&(t=xf),new Xo(function(n){var r=Wo(e,t,{next:n.next.bind(n),error:n.error.bind(n),complete:n.complete.bind(n)});return{unsubscribe:r}})}function Fl(e,t){var n;t===void 0&&(t={});var r=e.data(t);return!e.exists()||typeof r!="object"||r===null||!t.idField?r:Hr(Hr({},r),(n={},n[t.idField]=e.id,n))}function Ml(e){return kl(e,{includeMetadataChanges:!0}).pipe(Yr(function(t){return t.docs}))}function Ol(e,t){return t===void 0&&(t={}),Ml(e).pipe(Yr(function(n){return n.map(function(r){return Fl(r,t)})}))}var xn=class{constructor(t){return t}},Ll="firestore",Ho=class{constructor(){return ya(Ll)}};var Yo=new ta("angularfire2.firestore-instances");function Vf(e,t){let n=pa(Ll,e,t);return n&&new xn(n)}function Df(e){return(t,n)=>{let r=t.runOutsideAngular(()=>e(n));return new xn(r)}}var bf={provide:Ho,deps:[[new ke,Yo]]},Nf={provide:xn,useFactory:Vf,deps:[[new ke,Yo],va]},kf=(()=>{class e{constructor(){Me("angularfire",ga.full,"fst")}static \u0275fac=function(r){return new(r||e)};static \u0275mod=ea({type:e});static \u0275inj=Zo({providers:[Nf,bf]})}return e})();function kg(e,...t){return{ngModule:kf,providers:[{provide:Yo,useFactory:Df(e),multi:!0,deps:[ra,na,wa,Ia,[new ke,Ea],[new ke,_a],...t]}]}}var Fg=qt(Ol,!0);var Mg=qt(Nl,!0);var Og=qt(wl,!0);var Lg=qt(Il,!0);var qg=qt(Dl,!0);var Bg=qt(Vl,!0);export{xn as a,kg as b,Fg as c,Mg as d,Og as e,Lg as f,qg as g,Bg as h};
